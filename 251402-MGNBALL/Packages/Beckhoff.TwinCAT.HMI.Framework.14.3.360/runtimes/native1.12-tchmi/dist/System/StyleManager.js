import*as StyleProvider from"../API/StyleProvider.js";let StyleManager=(()=>{var _a,_b,_c;let ___onPrevControlsAttached_decorators,___onPrevControlsDetached_decorators,___onControlDestroyed_decorators,_instanceExtraInitializers=[];return class{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;___onPrevControlsAttached_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],___onPrevControlsDetached_decorators=[(_b=TcHmi).CallbackMethod.bind(_b)],___onControlDestroyed_decorators=[(_c=TcHmi).CallbackMethod.bind(_c)],__esDecorate(this,null,___onPrevControlsAttached_decorators,{kind:"method",name:"__onPrevControlsAttached",static:!1,private:!1,access:{has:obj=>"__onPrevControlsAttached"in obj,get:obj=>obj.__onPrevControlsAttached},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onPrevControlsDetached_decorators,{kind:"method",name:"__onPrevControlsDetached",static:!1,private:!1,access:{has:obj=>"__onPrevControlsDetached"in obj,get:obj=>obj.__onPrevControlsDetached},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onControlDestroyed_decorators,{kind:"method",name:"__onControlDestroyed",static:!1,private:!1,access:{has:obj=>"__onControlDestroyed"in obj,get:obj=>obj.__onControlDestroyed},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}__styleOverwriteCache=(__runInitializers(this,_instanceExtraInitializers),new Map);constructor(){}__legacyEventsRegistered=!1;__onPrevControlsAttached(_event,ctrls){this.__styleOverwriteCache.size&&this.writeStylesFromCache(ctrls)}__onPrevControlsDetached(_event,ctrls){this.__styleOverwriteCache.size&&this.removeStylesFromDom(ctrls)}__onControlDestroyed(_event,control){if(!control)return;let styleCacheEntry=this.__styleOverwriteCache.get(control);if(styleCacheEntry){const styleElem=styleCacheEntry[0].elementInHead;null!==styleElem&&document.head.removeChild(styleElem),this.__styleOverwriteCache.delete(control)}}__getElementStyle(element,propertyName,computedStyle=!1){let res={};if(!element||"object"!=typeof element)return res;const htmlSvgElement=window.Symbol.iterator in element?element[window.Symbol.iterator]().next().value:element;if(!htmlSvgElement)return res;let elemStyleDef;if(elemStyleDef=computedStyle?window.getComputedStyle(htmlSvgElement):htmlSvgElement.style,!elemStyleDef||!elemStyleDef.getPropertyValue)return res;if(null!=propertyName){if("string"==typeof propertyName){const value=elemStyleDef.getPropertyValue(propertyName);value&&(res[propertyName]=value)}else if(Array.isArray(propertyName))for(const singleProperty of propertyName){const singleValue=elemStyleDef.getPropertyValue(singleProperty);singleValue&&(res[singleProperty]=singleValue)}}else if(void 0!==elemStyleDef.length&&0!==elemStyleDef.length)for(const styleName of elemStyleDef)res[styleName]=elemStyleDef.getPropertyValue(styleName);return res}__setSimpleElementStyle(element,property,value=null){if(!element||"object"!=typeof element)return;const htmlSvgElements=window.Symbol.iterator in element?element:[element];for(const{style:elemStyleDef}of htmlSvgElements)if(elemStyleDef&&elemStyleDef.removeProperty&&elemStyleDef.setProperty)if("string"==typeof property)if("string"==typeof value&&""!==value)elemStyleDef.setProperty(property,value);else if(Array.isArray(value))for(const singleValue of value)elemStyleDef.setProperty(property,singleValue);else elemStyleDef.removeProperty(property);else if(null!==property)for(const[key,keyProperty]of Object.entries(property))if("string"==typeof keyProperty&&""!==keyProperty)elemStyleDef.setProperty(key,keyProperty);else if(Array.isArray(keyProperty))for(const singleProperty of keyProperty)elemStyleDef.setProperty(key,singleProperty);else elemStyleDef.removeProperty(key)}writeStylesFromCache(ctrls){let df=document.createDocumentFragment();for(let i=0,ii=ctrls.length;i<ii;i++){let control=ctrls[i],styleCacheEntry=this.__styleOverwriteCache.get(control);if(styleCacheEntry)for(let i=0;i<styleCacheEntry.length;i++){if(!styleCacheEntry[i].strCss)continue;let styleElement=document.createElement("style");styleElement.type="text/css",styleElement.className=styleCacheEntry[i].strClass,styleElement.appendChild(document.createTextNode(styleCacheEntry[i].strCss)),df.appendChild(styleElement),styleCacheEntry[i].elementInHead=styleElement}}df.childElementCount&&document.head.appendChild(df)}removeStylesFromDom(ctrls){for(let i=0,ii=ctrls.length;i<ii;i++){let control=ctrls[i],styleCacheEntry=this.__styleOverwriteCache.get(control);if(!styleCacheEntry)continue;let themeOverwrite=styleCacheEntry[0].elementInHead;null!==themeOverwrite&&(document.head.removeChild(themeOverwrite),styleCacheEntry[0].elementInHead=null)}}getExistingStyleOverwrites(controlName){const ctrl=TcHmi.Controls.get(controlName);if(!ctrl)return{};let cssText="";const styleElement=this.__styleOverwriteCache.get(ctrl)||[{strClass:"",strCss:""}];for(let i=0;i<styleElement.length;i++)styleElement[i].strClass.includes("overwrite")&&(cssText+=styleElement[i].strCss);return this.__deserializeCss(cssText)}__deserializeCss(cssText){let result={},index=0,charsetIndex=(cssText=this.__removeComments(cssText.trim())).indexOf("@charset",index);for(;-1!==charsetIndex;){let charsetString=this.__splitOutsideOfBraces(cssText.substring(charsetIndex),";")[0];void 0===result["@-rules"]&&(result["@-rules"]=[]),result["@-rules"].push(charsetString),index=charsetIndex+charsetString.length+1,charsetIndex=cssText.indexOf("@charset",index)}let importIndex=cssText.indexOf("@import",index);for(;-1!==importIndex;){let importString=this.__splitOutsideOfBraces(cssText.substring(importIndex),";")[0];void 0===result["@-rules"]&&(result["@-rules"]=[]),result["@-rules"].push(importString),index=importIndex+importString.length+1,importIndex=cssText.indexOf("@import",index)}let namespaceIndex=cssText.indexOf("@namespace",index);for(;-1!==namespaceIndex;){let namespaceString=this.__splitOutsideOfBraces(cssText.substring(namespaceIndex),";")[0];void 0===result["@-rules"]&&(result["@-rules"]=[]),result["@-rules"].push(namespaceString),index=namespaceIndex+namespaceString.length+1,namespaceIndex=cssText.indexOf("@namespace",index)}function mergeDuplicateSelectors(existingStyles,declarations){for(let property in declarations)if(declarations.hasOwnProperty(property)){let decl=declarations[property];if(void 0===existingStyles[property])existingStyles[property]=decl;else for(let i=0,ii=decl.length;i<ii;i++)existingStyles[property].includes(decl[i])||existingStyles[property].push(decl[i])}return existingStyles}for(;index<cssText.length;){let openBraceIndex=cssText.indexOf("{",index),closeBraceIndex=this.__findMatchingBrace(cssText,openBraceIndex),selector=cssText.substring(index,openBraceIndex).trim(),declarationBlock=cssText.substring(openBraceIndex+1,closeBraceIndex);if(selector.startsWith("@")){let atRuleSets=this.__deserializeCss(declarationBlock);if(void 0===result[selector])result[selector]=atRuleSets;else for(let atSelector in atRuleSets)atRuleSets.hasOwnProperty(atSelector)&&(void 0===result[selector][atSelector]?result[selector][atSelector]=atRuleSets[atSelector]:result[selector][atSelector]=mergeDuplicateSelectors(result[selector][atSelector],atRuleSets[atSelector]))}else{let declarations=this.__getDeclarations(declarationBlock);void 0===result[selector]?result[selector]=declarations:result[selector]=mergeDuplicateSelectors(result[selector],declarations)}index=closeBraceIndex+1}return result}__getDeclarations(declarationBlock){let result={},declarations=this.__splitOutsideOfBraces(declarationBlock,";");for(let i=0,ii=declarations.length;i<ii;i++){let splitIndex=declarations[i].indexOf(":");if(splitIndex>-1){let property=declarations[i].substring(0,splitIndex).trim().toLowerCase(),value=declarations[i].substring(splitIndex+1).trim();void 0===result[property]?result[property]=[value]:result[property].includes(value)||result[property].push(value)}}return result}__removeComments(cssText){if(!cssText.includes("/*"))return cssText;let result="",inComment=!1;function addToResult(s){inComment||(result+=s)}for(let i=0,ii=cssText.length;i<ii;i++){let char=cssText.charAt(i);switch(char){case"/":i+1<ii&&"*"===cssText.charAt(i+1)&&(inComment=!0,i++),addToResult(char);break;case"*":addToResult(char),i+1<ii&&"/"===cssText.charAt(i+1)&&(inComment=!1,i++);break;case'"':case"'":const closeQuoteIndex=this.__findMatchingQuote(cssText,i);closeQuoteIndex>i&&(addToResult(cssText.substring(i,closeQuoteIndex+1)),i=closeQuoteIndex);break;default:addToResult(char)}}return result}__getExistingStyleOverwritesForSelector(existingStyleOverwrites,selector){let rulesets=existingStyleOverwrites;return rulesets[selector]||(rulesets[selector]={}),rulesets[selector]}getStyle(controlName,selector,propertyName){if(!selector){const tco=TcHmi.Controls.get(controlName);if(void 0!==tco&&0!==tco.getElement().length){if(null==propertyName)return;return[StyleProvider.getSimpleElementStyle(tco.getElement(),propertyName)[propertyName]]}}selector=this.expandSelector(selector,controlName);let existingStyles=this.getExistingStyleOverwrites(controlName),existingStylesForSelector=this.__getExistingStyleOverwritesForSelector(existingStyles,selector);if(void 0!==existingStylesForSelector)return null!=propertyName?existingStylesForSelector[propertyName]:existingStylesForSelector}writeStyles(controlName,styles){let cssText=this.__serializeCss(styles),control=TcHmi.Controls.get(controlName);if(!control)return;let cacheEntry=this.__styleOverwriteCache.get(control);if(void 0===cacheEntry)cacheEntry=[{strClass:`tchmi-theme overwrite ${controlName}`,strCss:cssText,elementInHead:null}],this.__styleOverwriteCache.set(control,cacheEntry),this.__legacyEventsRegistered||(TcHmi.EventProvider.register("System.onPrevControlsAttached",this.__onPrevControlsAttached),TcHmi.EventProvider.register("System.onPrevControlsDetached",this.__onPrevControlsDetached),TcHmi.EventProvider.register("onControlDestroyed",this.__onControlDestroyed),this.__legacyEventsRegistered=!0);else{let styleUpdated=!1;for(let i=0;i<cacheEntry.length;i++)if(cacheEntry[i].strClass.includes("overwrite")){cacheEntry[i].strCss=cssText,styleUpdated=!0;break}styleUpdated||cacheEntry.push({strClass:`tchmi-theme overwrite ${controlName}`,strCss:cssText,elementInHead:null})}for(let i=0;i<cacheEntry.length;i++)if(cacheEntry[i].strClass.includes("overwrite"))if(null===cacheEntry[i].elementInHead){if(!control||!control.getIsAttached()||!cacheEntry[i].strClass)continue;let styleElement=document.createElement("style");styleElement.className=cacheEntry[i].strClass,styleElement.appendChild(document.createTextNode(cacheEntry[i].strCss)),document.head.appendChild(styleElement),cacheEntry[i].elementInHead=styleElement}else cacheEntry[i].elementInHead.innerHTML=cacheEntry[i].strCss}__serializeCss(styles){let cssText="";function writeDeclarations(selector,declarations,indent=""){cssText+=indent+selector+" {\n";for(let property in declarations){const decl=declarations[property];if(declarations.hasOwnProperty(property)&&null!=decl&&"@-rules"!==property)if(selector.startsWith("@"))writeDeclarations(property,decl,indent+"\t");else for(let i=0,ii=decl.length;i<ii;i++)void 0!==decl[i]&&null!==decl[i]&&""!==decl[i]&&(cssText+=indent+"\t"+property+": "+decl[i]+";\n")}cssText+=indent+"}\n\n"}if("@-rules"in styles)for(let i=0,ii=styles["@-rules"].length;i<ii;i++)cssText+=styles["@rules"][i]+";\n";cssText+="\n";for(const[selector,singleStyle]of Object.entries(styles))null!=singleStyle&&"@-rules"!==selector&&0!==Object.keys(singleStyle).length&&writeDeclarations(selector,singleStyle);return cssText=cssText.trim(),cssText}expandSelector(selector,prefix){(prefix=tchmi_css_escape_selector(prefix)).startsWith(".")||prefix.startsWith("#")||(prefix=`#${prefix}`);let selectorParts=this.__splitOutsideOfBraces(selector,",",["(","["]);for(let i=0,ii=selectorParts.length;i<ii;i++)selectorParts[i].includes(prefix)||(selectorParts[i].includes("%id%")?selectorParts[i]=selectorParts[i].replace("%id%",prefix):selectorParts[i]=prefix+" "+selectorParts[i]);return selectorParts.join(", ").trim()}__splitOutsideOfBraces(value,token,openingBraceChars=["("]){let startindex=0,res=[];for(let i=0,ii=value.length;i<ii;i++){let char=value.charAt(i);if(openingBraceChars.includes(char)){let closingBraceIndex=this.__findMatchingBrace(value,i);closingBraceIndex>i&&(i=closingBraceIndex)}else if('"'===char||"'"===char){let closingQuoteIndex=this.__findMatchingQuote(value,i);closingQuoteIndex>i&&(i=closingQuoteIndex)}else char===token&&(i>startindex&&res.push(value.substring(startindex,i).trim()),startindex=i+1)}return(0===value.length||startindex<value.length)&&res.push(value.substring(startindex).trim()),res}__findMatchingBrace(value,openBraceIndex){let openingBrace=value.charAt(openBraceIndex),closingBrace="";switch(openingBrace){case"(":closingBrace=")";break;case"{":closingBrace="}";break;case"[":closingBrace="]";break;case"<":closingBrace=">";break;default:return-1}let braceCounter=0;for(let i=openBraceIndex+1,ii=value.length;i<ii;i++)switch(value.charAt(i)){case openingBrace:braceCounter++;break;case closingBrace:if(0===braceCounter)return i;braceCounter--;break;case'"':case"'":const closingQuoteIndex=this.__findMatchingQuote(value,i);closingQuoteIndex>0&&(i=closingQuoteIndex)}return-1}__findMatchingQuote(value,openQuoteIndex){let quoteChar=value.charAt(openQuoteIndex);for(let i=openQuoteIndex+1,ii=value.length;i<ii;i++)switch(value.charAt(i)){case"\\":i++;break;case quoteChar:return i}return-1}processGenericStyle(controlName,selector,property,value=null){if(!selector){const tco=TcHmi.Controls.get(controlName);if(void 0!==tco&&0!==tco.getElement().length){if(null==property)return;return void StyleProvider.setSimpleElementStyle(tco.getElement(),property,value)}}selector=this.expandSelector(selector,controlName);let existingStyles=this.getExistingStyleOverwrites(controlName),existingStylesForSelector=this.__getExistingStyleOverwritesForSelector(existingStyles,selector);if("string"==typeof property)"string"==typeof value?""===value?delete existingStylesForSelector[property]:existingStylesForSelector[property]=[value]:null===value?delete existingStylesForSelector[property]:existingStylesForSelector[property]=value;else if(null!=property)for(const key in property)if(property.hasOwnProperty(key)){const keyProperty=property[key];"string"==typeof keyProperty?""===keyProperty?delete existingStylesForSelector[key]:existingStylesForSelector[key]=[keyProperty]:null===keyProperty?delete existingStylesForSelector[key]:existingStylesForSelector[key]=keyProperty}this.writeStyles(controlName,existingStyles)}processBackground(element,valueNew){let styles={};if(valueNew){let hasImage=!1,hasGradient=!1,insertImage=()=>{let imageString=null,gradientString=null,existingStyle=StyleProvider.getSimpleElementStyle(element,"background-image")["background-image"],existingImages=[];if(void 0!==existingStyle&&(existingImages=this.__splitOutsideOfBraces(existingStyle,",")),void 0!==valueNew.image?imageString=null!==valueNew.image&&""!==valueNew.image?valueNew.image.includes("'")?`url("${tchmi_path(valueNew.image)}")`:`url('${tchmi_path(valueNew.image)}')`:null:existingImages.length>0&&existingImages[0].startsWith("url(")&&(imageString=existingImages[0]),void 0!==valueNew.color)gradientString=null!==valueNew.color?TcHmi.isLinearGradientColor(valueNew.color)?StyleProvider.resolveLinearGradientColorAsCssValue(valueNew.color):"none":null;else if(existingImages.length>0){let existingGradient=existingImages.length>1?existingImages[1]:existingImages[0];(existingGradient.startsWith("linear-gradient(")||existingGradient.startsWith("radial-gradient("))&&(gradientString=existingGradient)}if(hasImage=null!==imageString,hasGradient=null!==gradientString&&"none"!==gradientString,null===imageString&&null===gradientString)existingImages.length>0&&(styles["background-image"]=null);else{let images=[];hasImage&&images.push(imageString),(hasGradient||"none"===gradientString&&!hasImage&&null!==styles["background-color"])&&images.push(gradientString),styles["background-image"]=images.length>0?images:null}},insertSize=()=>{if(hasImage){let width="auto",height="auto";if(void 0!==valueNew.imageWidth&&null!==valueNew.imageWidth&&(width=valueNew.imageWidth+(valueNew.imageWidthUnit||"px")),void 0!==valueNew.imageHeight&&null!==valueNew.imageHeight&&(height=valueNew.imageHeight+(valueNew.imageHeightUnit||"px")),void 0!==valueNew.imagePadding&&null!==valueNew.imagePadding){if("%"===valueNew.imageWidthUnit&&valueNew.imageWidth){let widthSubtractor="";valueNew.imagePadding.left>0&&(widthSubtractor+=" - "+valueNew.imagePadding.left*(valueNew.imageWidth?valueNew.imageWidth/100:1)+(valueNew.imagePadding.leftUnit||"px")),valueNew.imagePadding.right>0&&(widthSubtractor+=" - "+valueNew.imagePadding.right*(valueNew.imageWidth?valueNew.imageWidth/100:1)+(valueNew.imagePadding.rightUnit||"px")),""!==widthSubtractor&&(width=`calc(${width}${widthSubtractor})`)}if("%"===valueNew.imageHeightUnit&&valueNew.imageHeight){let heightSubtractor="";valueNew.imagePadding.top>0&&(heightSubtractor+=" - "+valueNew.imagePadding.top*(valueNew.imageHeight?valueNew.imageHeight/100:1)+(valueNew.imagePadding.topUnit||"px")),valueNew.imagePadding.bottom>0&&(heightSubtractor+=" - "+valueNew.imagePadding.bottom*(valueNew.imageHeight?valueNew.imageHeight/100:1)+(valueNew.imagePadding.bottomUnit||"px")),""!==heightSubtractor&&(height=`calc(${height}${heightSubtractor})`)}}styles["background-size"]=[width+" "+height],hasGradient&&styles["background-size"].push("auto auto")}else styles["background-size"]=null},insertPosition=()=>{if(hasImage){let posX="50%",posY="50%";switch(valueNew.imageHorizontalAlignment){case"Left":posX="0%";break;case"Center":posX="50%";break;case"Right":posX="100%"}switch(valueNew.imageVerticalAlignment){case"Top":posY="0%";break;case"Center":posY="50%";break;case"Bottom":posY="100%"}if(void 0!==valueNew.imagePadding&&null!==valueNew.imagePadding){let posXModifier="";valueNew.imagePadding.left>0&&"Right"!==valueNew.imageHorizontalAlignment&&(posXModifier+=" + "+valueNew.imagePadding.left*("Center"===valueNew.imageHorizontalAlignment?.5:1)+(valueNew.imagePadding.leftUnit||"px")),valueNew.imagePadding.right>0&&"Left"!==valueNew.imageHorizontalAlignment&&(posXModifier+=" - "+valueNew.imagePadding.right*("Center"===valueNew.imageHorizontalAlignment?.5:1)+(valueNew.imagePadding.rightUnit||"px")),""!==posXModifier&&(posX=`calc(${posX}${posXModifier})`);let posYModifier="";valueNew.imagePadding.top>0&&"Bottom"!==valueNew.imageVerticalAlignment&&(posYModifier+=" + "+valueNew.imagePadding.top*("Center"===valueNew.imageVerticalAlignment?.5:1)+(valueNew.imagePadding.topUnit||"px")),valueNew.imagePadding.bottom>0&&"Top"!==valueNew.imageVerticalAlignment&&(posYModifier+=" - "+valueNew.imagePadding.bottom*("Center"===valueNew.imageVerticalAlignment?.5:1)+(valueNew.imagePadding.bottomUnit||"px")),""!==posYModifier&&(posY=`calc(${posY}${posYModifier})`)}styles["background-position"]=[posX+" "+posY],hasGradient&&styles["background-position"].push("50% 50%")}else styles["background-position"]=null},insertCssImageProp=(name,value)=>{hasImage?(styles[name]=[value],hasGradient&&styles[name].push(value)):styles[name]=null};(()=>{if(valueNew.color)if(TcHmi.isSolidColor(valueNew.color)){let resolvedColor=StyleProvider.resolveSolidColorAsCssValue(valueNew.color);styles["background-color"]=null!==resolvedColor?[resolvedColor]:null}else styles["background-color"]=["transparent"];else styles["background-color"]=null})(),insertImage(),insertSize(),insertPosition(),insertCssImageProp("background-repeat","no-repeat"),insertCssImageProp("background-attachment","scroll"),insertCssImageProp("background-clip","border-box"),insertCssImageProp("background-origin","padding-box")}else{let names=["color","image","size","position","repeat","origin","clip","attachment"];for(let i=0,ii=names.length;i<ii;i++)styles["background-"+names[i]]=null}let stylesToWrite={};for(let key in styles)if(styles.hasOwnProperty(key)){const style=styles[key];stylesToWrite[key]=style?style.join(", "):null}StyleProvider.setSimpleElementStyle(element,stylesToWrite)}processFillColor(element,valueNew){if(!element||"object"!=typeof element)return;const SvgElements=window.Symbol.iterator in element?element:[element];for(const SvgElement of SvgElements){if(!(SvgElement instanceof SvgElement.ownerDocument.defaultView.SVGElement))continue;let defsParent=SvgElement.ownerSVGElement||SvgElement,defs=defsParent.querySelector("defs");if(defs){let oldId="",oldFill=StyleProvider.getSimpleElementStyle(SvgElement,"fill").fill;if(oldFill){oldId=oldFill.replace(/url\('?"?#|'?"?\)/g,"");let currentGradientList=defs.querySelectorAll("linearGradient.tchmi-styleprovider-linear-gradient");for(const currentGradient of currentGradientList)if(oldId===currentGradient.id){currentGradient.parentElement.removeChild(currentGradient);break}}}else TcHmi.isLinearGradientColor(valueNew)&&(defs=SvgElement.ownerDocument.createElementNS("http://www.w3.org/2000/svg","defs"),defsParent.insertBefore(defs,defsParent.firstElementChild));if(valueNew){if(TcHmi.isSolidColor(valueNew))SvgElement.style.fill=StyleProvider.resolveSolidColorAsCssValue(valueNew);else if(TcHmi.isLinearGradientColor(valueNew)){let gradientColor=valueNew,gradient=SvgElement.ownerDocument.createElementNS("http://www.w3.org/2000/svg","linearGradient");gradient.setAttribute("x1","0"),gradient.setAttribute("y1","1"),gradient.setAttribute("x2","0"),gradient.setAttribute("y2","0"),gradient.classList.add("tchmi-styleprovider-linear-gradient"),gradient.id="tchmi-styleprovider-"+tchmi_create_guid(),gradient.setAttribute("gradientTransform","rotate("+gradientColor.angle+", 0.5, 0.5)");for(let i=0,ii=gradientColor.stopPoints.length;i<ii;i++){let stopPoint=gradientColor.stopPoints[i];if(void 0===stopPoint.stop||null===stopPoint.stop)if(0===i)stopPoint.stop="0%";else if(i===ii-1)stopPoint.stop="100%";else{let previous=0;gradientColor.stopPoints[i-1].stop&&(previous=parseFloat(gradientColor.stopPoints[i-1].stop));let j,next=null;for(j=i+1;j<gradientColor.stopPoints.length;j++){let localStop=gradientColor.stopPoints[j].stop;if(null!=localStop){next=parseFloat(localStop);break}}null===next&&(next=100,j--);let unit="";gradientColor.stopPoints[i-1].stop&&(unit=gradientColor.stopPoints[i-1].stop.replace(/[0-9.]/g,"")),stopPoint.stop=previous+(next-previous)/(j-i)+unit}let stop=document.createElementNS("http://www.w3.org/2000/svg","stop");stop.setAttribute("offset",stopPoint.stop),stop.setAttribute("stop-color",stopPoint.color),gradient.appendChild(stop)}defs?.appendChild(gradient),SvgElement.style.fill="url(#"+gradient.id+")"}}else SvgElement.style.fill=""}}processStrokeColor(element,valueNew){TcHmi.isSolidColor(valueNew)?StyleProvider.setSimpleElementStyle(element,"stroke",TcHmi.StyleProvider.resolveSolidColorAsCssValue(valueNew)):StyleProvider.setSimpleElementStyle(element,"stroke",null)}processTextColor(element,valueNew){TcHmi.isSolidColor(valueNew)?StyleProvider.setSimpleElementStyle(element,"color",TcHmi.StyleProvider.resolveSolidColorAsCssValue(valueNew)):StyleProvider.setSimpleElementStyle(element,"color",null)}processBorderColor(element,valueNew){let styles={};if(TcHmi.isSolidColor(valueNew))styles["border-color"]=StyleProvider.resolveSolidColorAsCssValue(valueNew),styles["border-image-source"]=null,styles["border-image-slice"]=null;else if(TcHmi.isLinearGradientColor(valueNew))styles["border-image-source"]=StyleProvider.resolveLinearGradientColorAsCssValue(valueNew),styles["border-image-slice"]="1",styles["border-color"]=null;else{let names=["color","image","image-source","image-slice"];for(let i=0,ii=names.length;i<ii;i++)styles["border-"+names[i]]=null}StyleProvider.setSimpleElementStyle(element,styles)}processBorderWidth(element,valueNew){const sides=["top","right","bottom","left"];let newCss={};for(let i=0,ii=sides.length;i<ii;i++)if(valueNew){let value=valueNew[sides[i]];newCss["border-"+sides[i]+"-width"]=null==value?"":value+"px"}else newCss["border-"+sides[i]+"-width"]="";StyleProvider.setSimpleElementStyle(element,newCss)}processBorderRadius(element,valueNew){const sides=["topLeft","topRight","bottomRight","bottomLeft"],cssSides=["top-left","top-right","bottom-right","bottom-left"];let newCss={};for(let i=0,ii=sides.length;i<ii;i++)if(valueNew){let value=valueNew[sides[i]];const unit=valueNew[sides[i]+"Unit"]??"px";newCss[`border-${cssSides[i]}-radius`]=null==value?"":value+unit}else newCss[`border-${cssSides[i]}-radius`]="";StyleProvider.setSimpleElementStyle(element,newCss)}processBorderStyle(element,valueNew){const sides=["top","right","bottom","left"];let newCss={};for(let i=0,ii=sides.length;i<ii;i++)if(valueNew){let value,originalValue=valueNew[sides[i]];switch(originalValue){case"Solid":case"Dotted":case"Dashed":case"None":value=originalValue.toLowerCase();break;default:value=""}newCss[`border-${sides[i]}-style`]=value}else newCss[`border-${sides[i]}-style`]="";StyleProvider.setSimpleElementStyle(element,newCss)}processBoxShadow(element,valueNew){if(valueNew)if(0===valueNew.length)StyleProvider.setSimpleElementStyle(element,"box-shadow","none");else{let shadows=[];for(let i=0,ii=valueNew.length;i<ii;i++){let shadow="";valueNew[i].inset&&(shadow+="inset "),valueNew[i].offsetX?shadow+=valueNew[i].offsetX+(valueNew[i].offsetXUnit||"px")+" ":shadow+="0px ",valueNew[i].offsetY?shadow+=valueNew[i].offsetY+(valueNew[i].offsetYUnit||"px")+" ":shadow+="0px ",valueNew[i].blur?shadow+=valueNew[i].blur+(valueNew[i].blurUnit||"px")+" ":shadow+="0px ",valueNew[i].spread?shadow+=valueNew[i].spread+(valueNew[i].spreadUnit||"px")+" ":shadow+="0px ",TcHmi.isSolidColor(valueNew[i].color)?shadow+=StyleProvider.resolveSolidColorAsCssValue(valueNew[i].color):shadow+="transparent",shadows.push(shadow)}StyleProvider.setSimpleElementStyle(element,"box-shadow",shadows.join(", "))}else StyleProvider.setSimpleElementStyle(element,"box-shadow",null)}processFontFamily(element,valueNew){StyleProvider.setSimpleElementStyle(element,"font-family",valueNew)}processFontSize(element,valueNew,unitNew){null==valueNew?StyleProvider.setSimpleElementStyle(element,"font-size",null):StyleProvider.setSimpleElementStyle(element,"font-size",valueNew+unitNew)}processFontStyle(element,valueNew){let value;switch(valueNew){case"Normal":case"Italic":case"Oblique":value=valueNew.toLowerCase();break;default:value=null}StyleProvider.setSimpleElementStyle(element,"font-style",value)}processFontWeight(element,valueNew){let value;switch(valueNew){case"Normal":case"Bold":value=valueNew.toLowerCase();break;default:value=null}StyleProvider.setSimpleElementStyle(element,"font-weight",value)}processVisibility(element,valueNew){let newCss={};switch(valueNew){case"Collapsed":newCss.display="none",newCss.visibility="";break;case"Hidden":newCss.display="",newCss.visibility="hidden";break;default:newCss.display="",newCss.visibility=""}StyleProvider.setSimpleElementStyle(element,newCss)}processContentHorizontalAlignment(element,valueNew){let newCss={};switch(valueNew){case"Center":newCss.display="flex",newCss["justify-content"]="center";break;case"Right":newCss.display="flex",newCss["justify-content"]="flex-end";break;case"Left":newCss.display="flex",newCss["justify-content"]="flex-start";break;default:newCss.display="",newCss["justify-content"]=""}StyleProvider.setSimpleElementStyle(element,newCss)}processContentVerticalAlignment(element,valueNew){let newCss={};switch(valueNew){case"Center":newCss.display="flex",newCss["align-items"]="center";break;case"Bottom":newCss.display="flex",newCss["align-items"]="flex-end";break;case"Top":newCss.display="flex",newCss["align-items"]="flex-start";break;default:newCss.display="",newCss["align-items"]=""}StyleProvider.setSimpleElementStyle(element,newCss)}processContentPadding(element,valueNew){const sides=["top","right","bottom","left"];let newCss={};for(let i=0,ii=sides.length;i<ii;i++){const valueToWrite=valueNew?.[sides[i]];if(valueToWrite){let value=valueToWrite,unit=valueNew?.[sides[i]+"Unit"]??"px";newCss[`padding-${sides[i]}`]=null==value?"":value+unit}else newCss[`padding-${sides[i]}`]=""}StyleProvider.setSimpleElementStyle(element,newCss)}processTransform(element,valueNew,order){let newCss={};if(void 0===order&&(newCss={"transform-origin":"",perspective:"","perspective-origin":""}),valueNew){let newTransforms;newTransforms=Array.isArray(valueNew)?valueNew:[valueNew];let newTransformStrings=[];for(let i=0,ii=newTransforms.length;i<ii;i++){let transformString="",newTransform=newTransforms[i];switch(newTransform.transformType){case"Translate":newTransform.x=newTransform.x??0,newTransform.xUnit=newTransform.xUnit??"px",newTransform.y=newTransform.y??0,newTransform.yUnit=newTransform.yUnit??"px",newTransform.z=newTransform.z??0,newTransform.zUnit=newTransform.zUnit??"px",transformString="translate3d("+newTransform.x+newTransform.xUnit+", "+newTransform.y+newTransform.yUnit+", "+newTransform.z+newTransform.zUnit+")";break;case"Rotate":transformString=void 0===newTransform.vector?"rotate(":`rotate3d(${newTransform.vector.x}, ${newTransform.vector.y}, ${newTransform.vector.z}, `,transformString+=newTransform.angle+(newTransform.angleUnit??"deg"),transformString+=")";break;case"Scale":transformString="scale3d(",transformString+=(newTransform.x??1)+", ",transformString+=(newTransform.y??1)+", ",transformString+=newTransform.z??1,transformString+=")";break;case"Skew":const angles=[newTransform.xAngle??0,newTransform.yAngle??0],angleUnits=[newTransform.xAngleUnit,newTransform.xAngleUnit];for(let j=0,jj=angles.length;j<jj;j++)switch(angleUnits[j]){case"grad":angles[j]=angles[j]*(Math.PI/200);break;case"turn":angles[j]=angles[j]*(Math.PI/.5);break;case"rad":break;default:angles[j]=angles[j]*(Math.PI/180)}transformString=`matrix(1, ${Math.tan(angles[1])}, ${Math.tan(angles[0])}, 1, 0, 0)`;break;case"Origin":void 0===newTransform.x&&(newTransform.x=50,newTransform.xUnit="%"),void 0===newTransform.y&&(newTransform.y=50,newTransform.yUnit="%"),void 0===newTransform.z&&(newTransform.z=0,newTransform.zUnit=void 0),newCss["transform-origin"]=newTransform.x+(newTransform.xUnit??"px")+" "+newTransform.y+(newTransform.yUnit??"px")+" "+newTransform.z+(newTransform.zUnit??"px");break;case"Perspective":newCss.perspective=newTransform.distance+(newTransform.distanceUnit??"px"),void 0!==newTransform.origin&&(void 0===newTransform.origin.x&&(newTransform.origin.x=50,newTransform.origin.xUnit="%"),void 0===newTransform.origin.y&&(newTransform.origin.y=50,newTransform.origin.yUnit="%"),newCss["perspective-origin"]=newTransform.origin.x+(newTransform.origin.xUnit??"px")+" "+newTransform.origin.y+(newTransform.origin.yUnit??"px"))}newTransformStrings.push(transformString)}newCss.transform=newTransformStrings.join(" ")}else newCss.transform="";StyleProvider.setSimpleElementStyle(element,newCss)}__measurementCanvas;getTextWidth(text,element){if(!element)return null;this.__measurementCanvas??=document.createElement("canvas");const context=this.__measurementCanvas.getContext("2d",{willReadFrequently:!0});if(!context)return null;const htmlSvgElement=window.Symbol.iterator in element?element[window.Symbol.iterator]().next().value:element;if(!document.contains(htmlSvgElement))return null;const elementStyles=this.__getElementStyle(htmlSvgElement,["font-weight","font-size","font-family"],!0),fontWeight=elementStyles["font-weight"],fontSize=elementStyles["font-size"],fontFamily=elementStyles["font-family"];return context.font=`${fontWeight} ${fontSize} ${fontFamily}`,context.measureText(text).width}}})();export{StyleManager};export const styleManager=new StyleManager;