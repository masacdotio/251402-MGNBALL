import{frameworkLocalization}from"./Locale.js";export class DialogManager{constructor(){this.__dialogOwner=null;let tempDivOverlayDialogContainer=document.createElement("div");tempDivOverlayDialogContainer.innerHTML='<div id="tchmi-overlaysystemdialog-container" class="tchmi-box">\n        <div id="tchmi-overlaysystemdialog-background" class="tchmi-box"></div>\n        <div class="tchmi-overlaysystemdialog-message tchmi-box"></div>\n        <input id="tchmi-overlaysystemdialog-dismissbutton" type="button" value="Close" style="display:none;"></input>\n        </div>',this.__elementOverlayDialogContainer=tempDivOverlayDialogContainer.firstElementChild;const interceptInteraction=function(evt){evt.stopPropagation()};let backgroundElement=this.__elementOverlayDialogContainer.querySelector("#tchmi-overlaysystemdialog-background");if(!backgroundElement)throw new SyntaxError("Internal error. Did not find tchmi-overlaysystemdialog-background element.");let eventOptions={passive:!1,capture:!1};backgroundElement.addEventListener("mousedown",interceptInteraction,eventOptions),backgroundElement.addEventListener("click",interceptInteraction,eventOptions),backgroundElement.addEventListener("mouseup",interceptInteraction,eventOptions),backgroundElement.addEventListener("touchstart",interceptInteraction,eventOptions),backgroundElement.addEventListener("touchend",interceptInteraction,eventOptions);let tempDivWatermarkDialogContainer=document.createElement("div");tempDivWatermarkDialogContainer.innerHTML='<div\n            id="tchmi-watermarksystemdialog-container"\n            class="tchmi-box"\n        >\n            <div id="tchmi-watermarksystemdialog-background" class="tchmi-box"></div>\n            <div class="tchmi-watermarksystemdialog-message tchmi-box"></div>\n        </div>',this.__elementWatermarkDialogContainer=tempDivWatermarkDialogContainer.firstElementChild}__elementOverlayDialogContainer;__elementWatermarkDialogContainer;__dialogOwner;__currentDialogType=0;__currentHtmlContent=null;__currentForceable=!1;showDialog(dialogOwner,bVisibility,dialogType=TcHmi.DialogManager.DialogType.Overlay,options){if(TCHMI_UNITTEST_MODE)return!1;if(null!==dialogOwner&&!(null===this.__dialogOwner||this.__currentForceable||options&&!0===options.force||this.__dialogOwner===dialogOwner))return!1;if(this.__currentForceable=options?.forceable??!1,this.__dialogOwner=dialogOwner,bVisibility)if(this.__currentDialogType=dialogType,dialogType===TcHmi.DialogManager.DialogType.Overlay){const elementDissmissButton=this.__elementOverlayDialogContainer.querySelector("#tchmi-overlaysystemdialog-dismissbutton");options&&!0===options.cancelable?(elementDissmissButton.addEventListener("click",()=>{this.showDialog(null,!1)}),elementDissmissButton.style.display=""):elementDissmissButton.style.display="none",this.__elementWatermarkDialogContainer.parentElement&&this.__elementWatermarkDialogContainer.parentElement.removeChild(this.__elementWatermarkDialogContainer),document.body&&!document.body.contains(this.__elementOverlayDialogContainer)&&document.body.appendChild(this.__elementOverlayDialogContainer)}else dialogType===TcHmi.DialogManager.DialogType.Watermark&&(this.__elementOverlayDialogContainer.parentElement&&this.__elementOverlayDialogContainer.parentElement.removeChild(this.__elementOverlayDialogContainer),document.body&&!document.body.contains(this.__elementWatermarkDialogContainer)&&document.body.appendChild(this.__elementWatermarkDialogContainer));else bVisibility||(this.__elementOverlayDialogContainer.parentElement&&this.__elementOverlayDialogContainer.parentElement.removeChild(this.__elementOverlayDialogContainer),this.__elementWatermarkDialogContainer.parentElement&&this.__elementWatermarkDialogContainer.parentElement.removeChild(this.__elementWatermarkDialogContainer),this.__dialogOwner=null);return!0}updateText(dialogOwner,newHtmlContent,severity=TcHmi.DialogManager.DialogSeverity.Info){return this.updateTextEx(dialogOwner,newHtmlContent,{dialogType:TcHmi.DialogManager.DialogType.Overlay,severity})}updateTextEx(dialogOwner,newHtmlContent,options){if(null!==dialogOwner&&null!==this.__dialogOwner&&this.__dialogOwner!==dialogOwner)return!1;if(this.__dialogOwner=dialogOwner,newHtmlContent===this.__currentHtmlContent)return!1;this.__currentHtmlContent=newHtmlContent;const dialogType=options?.dialogType??TcHmi.DialogManager.DialogType.Overlay,severity=options?.severity??TcHmi.DialogManager.DialogSeverity.Info;if(newHtmlContent&&options?.buttonReload&&(newHtmlContent+=`<br />\n                <br />\n                <input\n                    type="submit"\n                    value="${frameworkLocalization?.getText("Reload",{level:TcHmi.Locale.Level.Engineering,preventHtml:!0})??"Reload"}"\n                    style="padding:10px;"\n                    onclick="window.location.reload()"\n                />`),dialogType===TcHmi.DialogManager.DialogType.Overlay){let elementMessage=this.__elementOverlayDialogContainer.querySelector(".tchmi-overlaysystemdialog-message");elementMessage&&(elementMessage.innerHTML=newHtmlContent),elementMessage.style.display=newHtmlContent?"":"none",this.__elementOverlayDialogContainer.classList.toggle("tchmi-overlaysystemdialog-error",severity===TcHmi.DialogManager.DialogSeverity.Error),this.__elementOverlayDialogContainer.classList.toggle("tchmi-overlaysystemdialog-warning",severity===TcHmi.DialogManager.DialogSeverity.Warning),this.__elementOverlayDialogContainer.classList.toggle("tchmi-overlaysystemdialog-info",severity===TcHmi.DialogManager.DialogSeverity.Info)}else if(dialogType===TcHmi.DialogManager.DialogType.Watermark){let elementMessage=this.__elementWatermarkDialogContainer.querySelector(".tchmi-watermarksystemdialog-message");elementMessage&&(elementMessage.innerHTML=newHtmlContent),elementMessage.style.display=newHtmlContent?"":"none"}return!0}getDialogOwner(){return this.__dialogOwner}}export const dialogManager=new DialogManager;