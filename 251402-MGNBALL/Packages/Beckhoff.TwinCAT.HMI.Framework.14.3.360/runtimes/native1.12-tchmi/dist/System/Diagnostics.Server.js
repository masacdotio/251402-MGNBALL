export let __data;let __cyclicDumpInterval=0;export function start(lazy=!1){lazy&&!TCHMI_DIAGNOSTICS_SERVER||(lazy||(TCHMI_DIAGNOSTICS_SERVER=!0),__data={requestsHistory:new Map,requestsCache:new Map,requestsQueue:new Map,requestsQueuePendingRequest:null,dumps:{lastDumpDate:null,lastDumpTimestamp:0,data:[]}})}export function stop(){TCHMI_DIAGNOSTICS_SERVER=!1}export function requestRegistered(request){if(!TCHMI_DIAGNOSTICS_SERVER)return;if(!__data)return;let requestDiag={message:request.message,timestampRegistered:performance.now()};if(__data.requestsCache.set(request,requestDiag),__data.requestsHistory.size>=TCHMI_DIAGNOSTICS_SERVER_REQUEST_HISTORY_MAX_BUFFER){const[requestHistory]=__data.requestsHistory.keys();__data.requestsHistory.delete(requestHistory)}__data.requestsHistory.set(request,requestDiag)}export function requestQueued(request){if(!TCHMI_DIAGNOSTICS_SERVER)return;let requestDiag=__data?.requestsCache.get(request);requestDiag&&(requestDiag.timestampQueued=performance.now(),__data?.requestsQueue.set(request,requestDiag))}export function requestSent(request){if(TCHMI_DIAGNOSTICS_SERVER&&__data){let requestDiag=__data.requestsCache.get(request);requestDiag&&(requestDiag.timestampSent=performance.now(),request.queuePending&&(__data.requestsQueuePendingRequest&&(__data.requestsQueuePendingRequest.requestDiag.timestampQueuePendingEnd=performance.now()),__data.requestsQueuePendingRequest={request,requestDiag},requestDiag.timestampQueuePendingBegin=performance.now()))}}export function requestReceived(request,response){if(!TCHMI_DIAGNOSTICS_SERVER)return;let requestDiag=__data?.requestsCache.get(request);if(requestDiag){let now=performance.now();if(requestDiag.timestampReceived||(requestDiag.timestampReceived=now),TCHMI_DIAGNOSTICS_SERVER_REQUEST_RESPONSE_HISTORY_MAX_BUFFER>0)if(requestDiag.responseFirst){requestDiag.responsesLast||(requestDiag.responsesLast=[]),requestDiag.responsesLast.length>=TCHMI_DIAGNOSTICS_SERVER_REQUEST_RESPONSE_HISTORY_MAX_BUFFER&&requestDiag.responsesLast.shift();let record={timestampReceived:now};TCHMI_DIAGNOSTICS_SERVER_REQUEST_RESPONSE_HISTORY_MESSAGES&&(record.message=response),requestDiag.responsesLast.push(record)}else requestDiag.responseFirst={timestampReceived:now},TCHMI_DIAGNOSTICS_SERVER_REQUEST_RESPONSE_HISTORY_MESSAGES&&(requestDiag.responseFirst.message=response)}}export function requestUnqueued(request){if(TCHMI_DIAGNOSTICS_SERVER&&__data){let requestDiag=__data.requestsQueue.get(request);requestDiag&&(requestDiag.timestampUnqueued=performance.now(),__data.requestsQueue.delete(request))}}export function requestPendingDone(request){TCHMI_DIAGNOSTICS_SERVER&&__data&&!request.queuePending&&__data.requestsQueuePendingRequest&&__data.requestsQueuePendingRequest.request===request&&(__data.requestsQueuePendingRequest.requestDiag.timestampQueuePendingEnd=performance.now(),__data.requestsQueuePendingRequest=null)}export function requestUnregistered(request){if(!TCHMI_DIAGNOSTICS_SERVER)return;let requestDiag=__data?.requestsCache.get(request);requestDiag&&(requestDiag.timestampUnregistered=performance.now()),__data?.requestsCache.delete(request)}export function clear(){TCHMI_DIAGNOSTICS_SERVER||(__data=void 0)}export function reset(){TCHMI_DIAGNOSTICS_SERVER||(__data={requestsHistory:new Map,requestsCache:new Map,requestsQueue:new Map,requestsQueuePendingRequest:null,dumps:{lastDumpDate:null,lastDumpTimestamp:0,data:[]}})}function evalTimes(requestDiag){requestDiag.timestampUnregistered&&requestDiag.timestampRegistered&&(requestDiag.timeRegistered=requestDiag.timestampUnregistered-requestDiag.timestampRegistered),requestDiag.timestampUnqueued&&requestDiag.timestampQueued&&(requestDiag.timeInQueue=requestDiag.timestampUnqueued-requestDiag.timestampQueued),requestDiag.timestampReceived&&requestDiag.timestampSent&&(requestDiag.timeServer=requestDiag.timestampReceived-requestDiag.timestampSent),requestDiag.timestampQueuePendingBegin&&requestDiag.timestampQueuePendingEnd&&(requestDiag.timeQueuePending=requestDiag.timestampQueuePendingEnd-requestDiag.timestampQueuePendingBegin)}export function dump(){if(!TCHMI_DIAGNOSTICS_SERVER)throw new Error("TcHmi.System.Diagnostics.Server is not active. Either define 'TCHMI_DIAGNOSTICS_SERVER = true;' or call 'TcHmi.System.Diagnostics.Server.start()' before calling this function.");if(!__data)return;let requestsHistoryDiag=[];__data.requestsHistory.forEach(requestDiag=>{let clone=tchmi_clone_object(requestDiag);evalTimes(clone),requestsHistoryDiag.push(clone)});let requestsCacheDiag=[];__data.requestsCache.forEach(requestDiag=>{let clone=tchmi_clone_object(requestDiag);evalTimes(clone),requestsCacheDiag.push(clone)});let requestsQueueDiag=[];__data.requestsQueue.forEach(requestDiag=>{let clone=tchmi_clone_object(requestDiag);evalTimes(clone),requestsQueueDiag.push(clone)});let requestsQueuePendingRequestDiag=tchmi_clone_object(__data.requestsQueuePendingRequest?.requestDiag)??null;requestsQueuePendingRequestDiag&&evalTimes(requestsQueuePendingRequestDiag),__data.dumps.lastDumpDate=(new Date).toISOString(),__data.dumps.lastDumpTimestamp=performance.now(),__data.dumps.data.push({requestsHistory:requestsHistoryDiag,requestsCache:requestsCacheDiag,requestsQueue:requestsQueueDiag,requestsQueuePendingRequest:requestsQueuePendingRequestDiag})}export function cyclicDump(interval){if(!TCHMI_DIAGNOSTICS_SERVER)throw new Error("TcHmi.System.Diagnostics.Server is not active. Either define 'TCHMI_DIAGNOSTICS_SERVER = true;' or call 'TcHmi.System.Diagnostics.Server.start()' before calling this function.");if("number"!=typeof interval)throw new Error("Argument 'interval must be defined and of type 'number'.");__cyclicDumpInterval>0&&clearInterval(__cyclicDumpInterval),__cyclicDumpInterval=setInterval(()=>{dump()},interval)}export function cyclicDumpAbort(){if(!TCHMI_DIAGNOSTICS_SERVER)throw new Error("TcHmi.System.Diagnostics.Server is not active. Either define 'TCHMI_DIAGNOSTICS_SERVER = true;' or call 'TcHmi.System.Diagnostics.Server.start()' before calling this function.");__cyclicDumpInterval>0&&(clearInterval(__cyclicDumpInterval),__cyclicDumpInterval=0)}export function download(){if(!__data)return;const downloaderAElement=document.createElement("a");downloaderAElement.download="TcHmi.System.Diagnostics.Server_"+(new Date).toISOString().replace(/:/g,"_")+".json",downloaderAElement.href="data:application/json;charset=utf8,"+encodeURI(JSON.stringify(__data.dumps)),downloaderAElement.style.display="none",document.body.appendChild(downloaderAElement),downloaderAElement.click(),downloaderAElement.remove()}export function print(){if(!__data||!__data.dumps||!__data.dumps.data)return;let po={lastDumpDate:__data.dumps.lastDumpDate,lastDumpTimestamp:__data.dumps.lastDumpTimestamp,data:[]};__data.dumps.data.forEach(dump=>{let historyRequestsByTime=[],historyRequestsByServerTime=[],historyRequestsByQueueTime=[],historyRequestsByQueuePendingTime=[],historyRequestsSubscriptionResponseTimes=[];dump.requestsHistory.forEach(request=>{if(void 0!==request.timeRegistered&&historyRequestsByTime.push(request),void 0!==request.timeServer&&historyRequestsByServerTime.push(request),void 0!==request.timeInQueue&&historyRequestsByQueueTime.push(request),void 0!==request.timeQueuePending&&historyRequestsByQueuePendingTime.push(request),"Subscription"===request.message?.requestType){let responseTimes=[];if(request.responsesLast){let responseTimestampRecievedLast=0;for(let i=0;i<request.responsesLast.length;i++){let response=request.responsesLast[i],responseTimestampRecieved=response.timestampReceived;if(responseTimestampRecievedLast&&responseTimestampRecieved){let time=responseTimestampRecieved-responseTimestampRecievedLast;responseTimes.push(time)}responseTimestampRecievedLast=response.timestampReceived}}responseTimes.length>0&&historyRequestsSubscriptionResponseTimes.push({request,responseTimes})}}),historyRequestsByTime.sort((a,b)=>a.timeRegistered<b.timeRegistered?1:a.timeRegistered>b.timeRegistered?-1:0),historyRequestsByServerTime.sort((a,b)=>a.timeServer<b.timeServer?1:a.timeServer>b.timeServer?-1:0),historyRequestsByQueueTime.sort((a,b)=>a.timeInQueue<b.timeInQueue?1:a.timeInQueue>b.timeInQueue?-1:0),historyRequestsByQueuePendingTime.sort((a,b)=>a.timeQueuePending<b.timeQueuePending?1:a.timeQueuePending>b.timeQueuePending?-1:0);let cacheRequestsByTime=[],cacheRequestsByServerTime=[],cacheRequestsByQueueTime=[],cacheRequestsByQueuePendingTime=[],cacheRequestsSubscriptionResponseTimes=[];dump.requestsCache.forEach(request=>{if(void 0!==request.timeRegistered&&cacheRequestsByTime.push(request),void 0!==request.timeServer&&cacheRequestsByServerTime.push(request),void 0!==request.timeInQueue&&cacheRequestsByQueueTime.push(request),void 0!==request.timeQueuePending&&cacheRequestsByQueuePendingTime.push(request),"Subscription"===request.message?.requestType){let responseTimes=[];if(request.responsesLast){let responseTimestampRecievedLast=0;for(let i=0;i<request.responsesLast.length;i++){let response=request.responsesLast[i],responseTimestampRecieved=response.timestampReceived;if(responseTimestampRecievedLast&&responseTimestampRecieved){let time=responseTimestampRecieved-responseTimestampRecievedLast;responseTimes.push(time)}responseTimestampRecievedLast=response.timestampReceived}}responseTimes.length>0&&cacheRequestsSubscriptionResponseTimes.push({request,responseTimes})}}),cacheRequestsByTime.sort((a,b)=>a.timeRegistered<b.timeRegistered?1:a.timeRegistered>b.timeRegistered?-1:0),cacheRequestsByServerTime.sort((a,b)=>a.timeServer<b.timeServer?1:a.timeServer>b.timeServer?-1:0),cacheRequestsByQueueTime.sort((a,b)=>a.timeInQueue<b.timeInQueue?1:a.timeInQueue>b.timeInQueue?-1:0),cacheRequestsByQueuePendingTime.sort((a,b)=>a.timeQueuePending<b.timeQueuePending?1:a.timeQueuePending>b.timeQueuePending?-1:0);let clone=tchmi_clone_object(dump);clone&&(clone.eval={requestsHistory:{requestsByTime:historyRequestsByTime,requestsByServerTime:historyRequestsByServerTime,requestsByQueueTime:historyRequestsByQueueTime,requestsByQueuePendingTime:historyRequestsByQueuePendingTime,subscriptionResponseTimes:historyRequestsSubscriptionResponseTimes},requestsCache:{requestsByTime:cacheRequestsByTime,requestsByServerTime:cacheRequestsByServerTime,requestsByQueueTime:cacheRequestsByQueueTime,requestsByQueuePendingTime:cacheRequestsByQueuePendingTime,subscriptionResponseTimes:cacheRequestsSubscriptionResponseTimes}},po.data.push(clone))}),console.log("TcHmi.System.Diagnostics.Server:",po)}