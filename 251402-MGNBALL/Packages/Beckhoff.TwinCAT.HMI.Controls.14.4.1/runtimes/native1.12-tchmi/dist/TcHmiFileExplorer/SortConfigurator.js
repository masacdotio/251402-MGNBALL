var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{Callback}from"Beckhoff.TwinCAT.HMI.Framework/index.esm.js";let SortConfigurator=(()=>{var _a,_b,_c,_d,_e,_f,_g,_h;let ___onHostClick_decorators,___onDocumentClick_decorators,___onPointerDown_decorators,___onPointerMove_decorators,___onPointerUp_decorators,___onPointerCancel_decorators,___onCriterionClick_decorators,___positionDropdown_decorators,_instanceExtraInitializers=[];return class{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;___onHostClick_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],___onDocumentClick_decorators=[(_b=TcHmi).CallbackMethod.bind(_b)],___onPointerDown_decorators=[(_c=TcHmi).CallbackMethod.bind(_c)],___onPointerMove_decorators=[(_d=TcHmi).CallbackMethod.bind(_d)],___onPointerUp_decorators=[(_e=TcHmi).CallbackMethod.bind(_e)],___onPointerCancel_decorators=[(_f=TcHmi).CallbackMethod.bind(_f)],___onCriterionClick_decorators=[(_g=TcHmi).CallbackMethod.bind(_g)],___positionDropdown_decorators=[(_h=TcHmi).CallbackMethod.bind(_h)],__esDecorate(this,null,___onHostClick_decorators,{kind:"method",name:"__onHostClick",static:!1,private:!1,access:{has:obj=>"__onHostClick"in obj,get:obj=>obj.__onHostClick},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onDocumentClick_decorators,{kind:"method",name:"__onDocumentClick",static:!1,private:!1,access:{has:obj=>"__onDocumentClick"in obj,get:obj=>obj.__onDocumentClick},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onPointerDown_decorators,{kind:"method",name:"__onPointerDown",static:!1,private:!1,access:{has:obj=>"__onPointerDown"in obj,get:obj=>obj.__onPointerDown},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onPointerMove_decorators,{kind:"method",name:"__onPointerMove",static:!1,private:!1,access:{has:obj=>"__onPointerMove"in obj,get:obj=>obj.__onPointerMove},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onPointerUp_decorators,{kind:"method",name:"__onPointerUp",static:!1,private:!1,access:{has:obj=>"__onPointerUp"in obj,get:obj=>obj.__onPointerUp},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onPointerCancel_decorators,{kind:"method",name:"__onPointerCancel",static:!1,private:!1,access:{has:obj=>"__onPointerCancel"in obj,get:obj=>obj.__onPointerCancel},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onCriterionClick_decorators,{kind:"method",name:"__onCriterionClick",static:!1,private:!1,access:{has:obj=>"__onCriterionClick"in obj,get:obj=>obj.__onCriterionClick},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___positionDropdown_decorators,{kind:"method",name:"__positionDropdown",static:!1,private:!1,access:{has:obj=>"__positionDropdown"in obj,get:obj=>obj.__positionDropdown},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}__host=__runInitializers(this,_instanceExtraInitializers);__parentControl;__display=document.createElement("span");__dropdown=document.createElement("div");__list=document.createElement("ul");__criterions=new Map;__divider;__attributeValue;__userValue=[];__onValueChangeManager=new Callback.Collection;onValueChange=this.__onValueChangeManager.getManipulators();__localizationReader=null;__destroyers=[];__destroyOnClose=[];__pointerEventDestroyers=[];__isOpen=!1;__dropdownResizeObserver=null;__dragOperations=new Map;__workingCopy=null;__listItemGeometry={height:0,gap:0};constructor(__host,sortingCriterions,__parentControl){this.__host=__host,this.__parentControl=__parentControl,__host.appendChild(this.__display);__host.appendChild(document.createElement("div")).classList.add("open-button"),this.__dropdown.classList.add("TcHmi_Controls_Beckhoff_TcHmiFileExplorer-sort-configurator"),this.__dropdown.appendChild(this.__list),this.__divider=this.__list.appendChild(document.createElement("li")),this.__divider.classList.add("divider");for(const[index,criterion]of sortingCriterions.entries()){const listItem=this.__list.appendChild(document.createElement("li"));listItem.dataset.name=criterion.name,listItem.style.setProperty("--nth-child",(index+1).toString());const label=listItem.appendChild(document.createElement("span"));label.textContent=criterion.localizationKey;listItem.appendChild(document.createElement("div")).classList.add("drag-handle"),this.__criterions.set(criterion.name,{localizationKey:criterion.localizationKey,element:listItem,label})}this.__destroyers.push(TcHmi.EventProvider.registerDomEvent(__host,"click",this.__onHostClick),TcHmi.EventProvider.registerDomEvent(this.__dropdown,"click",this.__onCriterionClick),TcHmi.EventProvider.registerDomEvent(this.__dropdown,"pointerdown",this.__onPointerDown,{passive:!1}));const resetButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",__parentControl.getId()+"_SortConfigurator_ResetButton",{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-text":`%l%Control::${__parentControl.getType()}::Button_Text_Reset%/l%`,"data-tchmi-tooltip":`%l%Control::${__parentControl.getType()}::Button_Tooltip_Reset_Sorting%/l%`},__parentControl),okButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",__parentControl.getId()+"_SortConfigurator_OkButton",{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-text":`%l%Control::${__parentControl.getType()}::Button_Text_OK%/l%`,"data-tchmi-tooltip":`%l%Control::${__parentControl.getType()}::Button_Tooltip_OK_Sorting%/l%`},__parentControl);if(!resetButton||!okButton)throw new Error("Failed to create controls.");this.__destroyers.push(TcHmi.EventProvider.register(resetButton.getId()+".onPressed",()=>this.__setUserValue(this.__attributeValue??[],!1))),this.__destroyers.push(()=>resetButton.destroy()),this.__dropdown.appendChild(resetButton.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(okButton.getId()+".onPressed",()=>this.__close())),this.__destroyers.push(()=>okButton.destroy()),this.__dropdown.appendChild(okButton.getElement()[0]);const localization=new TcHmi.Locale.ControlLocalization(__parentControl.getType());this.__destroyers.push(localization.watch(data=>{if(data.error===TcHmi.Errors.NONE&&data.reader){this.__localizationReader=data.reader;for(const{localizationKey,label}of this.__criterions.values())label.textContent=data.reader.get(localizationKey);this.__updateDisplay()}})),this.__destroyers.push(TcHmi.EventProvider.register(__parentControl.getId()+".onDestroyed",()=>this.destroy()))}destroy(){this.__close();for(const destroy of this.__destroyers)destroy();this.__destroyers=[]}__onHostClick(event){0===event.button&&this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&this.__open()}__onDocumentClick(event){this.__dropdown.contains(event.target)||this.__close()}__onPointerDown(event){if(0!==event.button)return;if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return;const target=event.target;if(!target.classList.contains("drag-handle"))return;const listItem=target.closest("li");if(!listItem)return;if(this.__listItemGeometry.height=parseFloat(getComputedStyle(listItem).getPropertyValue("--li-height")),this.__listItemGeometry.gap=parseFloat(getComputedStyle(listItem).getPropertyValue("--li-gap")),Number.isNaN(this.__listItemGeometry.height)||Number.isNaN(this.__listItemGeometry.gap))return;0===this.__dragOperations.size&&(this.__pointerEventDestroyers.push(TcHmi.EventProvider.registerDomEvent(this.__dropdown,"pointermove",this.__onPointerMove,{passive:!1}),TcHmi.EventProvider.registerDomEvent(this.__dropdown,"pointerup",this.__onPointerUp),TcHmi.EventProvider.registerDomEvent(this.__dropdown,"pointercancel",this.__onPointerCancel)),this.__workingCopy=tchmi_clone_object(this.__userValue));const listTop=this.__list.getBoundingClientRect().top,itemTop=listItem.getBoundingClientRect().top,offset=listTop+(event.clientY-itemTop);let dragOperation=this.__dragOperations.get(listItem);if(!dragOperation){const name=listItem.dataset.name,index=this.__userValue.findIndex(criterion=>criterion.name===name);dragOperation={criterion:-1===index?{name,order:"Ascending"}:this.__userValue[index],currentIndex:index,originalIndex:index,pointers:[]},this.__dragOperations.set(listItem,dragOperation)}dragOperation.pointers.unshift({id:event.pointerId,offset}),target.setPointerCapture(event.pointerId),listItem.classList.add("dragging"),"touch"===event.pointerType&&event.preventDefault()}__onPointerMove(event){if(!this.__parentControl.getIsEnabled())return void this.__onPointerCancel(event);if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return void this.__onPointerCancel(event);if(!this.__workingCopy)return;const listItem=event.target.closest("li");if(!listItem)return;const dragOperation=this.__dragOperations.get(listItem),pointer=dragOperation?.pointers[0];if(!dragOperation||pointer?.id!==event.pointerId)return;const top=event.clientY-pointer.offset;listItem.style.transform=`translateY(${top}px)`;const height=this.__listItemGeometry.height,gap=this.__listItemGeometry.gap;let index=Math.round((top+gap/2)/(height+gap));index>(-1===dragOperation.currentIndex?this.__workingCopy.length:this.__workingCopy.length-1)&&(index=-1),index!==dragOperation.currentIndex&&(-1!==dragOperation.currentIndex&&this.__workingCopy.splice(dragOperation.currentIndex,1),-1!==index&&this.__workingCopy.splice(index,0,dragOperation.criterion),dragOperation.currentIndex=index,this.__updateDropdown(this.__workingCopy)),"touch"===event.pointerType&&event.preventDefault()}__onPointerUp(event){if(!this.__parentControl.getIsEnabled())return void this.__onPointerCancel(event);if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return void this.__onPointerCancel(event);if(!this.__workingCopy)return;const listItem=event.target.closest("li");if(!listItem)return;const dragOperation=this.__dragOperations.get(listItem),pointerIndex=dragOperation?.pointers.findIndex(pointer=>pointer.id===event.pointerId);if(dragOperation&&void 0!==pointerIndex&&-1!==pointerIndex&&(dragOperation.pointers.splice(pointerIndex,1),0===dragOperation.pointers.length&&(listItem.classList.remove("dragging"),listItem.style.transform="",this.__dragOperations.delete(listItem),0===this.__dragOperations.size))){for(const destroy of this.__pointerEventDestroyers)destroy();this.__pointerEventDestroyers=[],this.__setUserValue(this.__workingCopy),this.__workingCopy=null}}__onPointerCancel(event){if(!this.__workingCopy)return;const listItem=event.target.closest("li");if(!listItem)return;listItem.classList.remove("dragging"),listItem.style.transform="";const dragOperation=this.__dragOperations.get(listItem),pointerIndex=dragOperation?.pointers.findIndex(pointer=>pointer.id===event.pointerId);if(dragOperation&&void 0!==pointerIndex&&-1!==pointerIndex&&(dragOperation.pointers.splice(pointerIndex,1),0===dragOperation.pointers.length&&(dragOperation.currentIndex!==dragOperation.originalIndex&&(-1!==dragOperation.currentIndex&&this.__workingCopy.splice(dragOperation.currentIndex,1),-1!==dragOperation.originalIndex&&this.__workingCopy.splice(dragOperation.originalIndex,0,dragOperation.criterion)),this.__dragOperations.delete(listItem),0===this.__dragOperations.size))){for(const destroy of this.__pointerEventDestroyers)destroy();this.__pointerEventDestroyers=[],this.__setUserValue(this.__workingCopy),this.__workingCopy=null}}__onCriterionClick(event){if(0!==event.button)return;if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return;const listItem=event.target;if(!(listItem instanceof HTMLLIElement))return;const name=listItem.dataset.name,sorting=tchmi_clone_object(this.__userValue),criterion=sorting.find(criterion=>criterion.name===name);criterion?"Ascending"===criterion.order?criterion.order="Descending":criterion.order="Ascending":sorting.push({name,order:"Ascending"}),this.__setUserValue(sorting)}__open(){this.__isOpen||(TcHmi.TopMostLayer.add(this.__parentControl,this.__dropdown,{modal:!1,dimBackground:!1}),this.__positionDropdown(),this.__host.classList.add("active"),this.__destroyOnClose.push(TcHmi.EventProvider.registerDomEvent(document,"click",this.__onDocumentClick)),this.__destroyOnClose.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".onResized",this.__positionDropdown)),this.__destroyOnClose.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".onMoved",this.__positionDropdown)),this.__dropdownResizeObserver||(this.__dropdownResizeObserver=new ResizeObserver(this.__positionDropdown)),this.__dropdownResizeObserver.observe(this.__dropdown,{box:"border-box"}),window.requestAnimationFrame(()=>{this.__isOpen=!0}))}__close(){if(this.__isOpen){this.__dropdownResizeObserver?.disconnect(),TcHmi.TopMostLayer.remove(this.__parentControl,this.__dropdown),this.__host.classList.remove("active");for(const destroy of this.__destroyOnClose)destroy();this.__destroyOnClose=[],window.requestAnimationFrame(()=>{this.__isOpen=!1})}}setAttributeValue(value){this.__attributeValue=value,this.__setUserValue(tchmi_clone_object(value),!1)}getAttributeValue(){return this.__attributeValue}setUserValue(value){this.__setUserValue(value)}__setUserValue(value,isUserConfigured=!0){if(tchmi_equal(value,this.__userValue))return;const seenNames=new Set;this.__userValue=[];for(const sortingInfo of value)seenNames.has(sortingInfo.name)||(seenNames.add(sortingInfo.name),this.__userValue.push(sortingInfo));this.__updateDisplay(),this.__updateDropdown(this.__userValue),this.__onValueChangeManager.trigger(value,isUserConfigured)}getUserValue(){return this.__userValue}__updateDisplay(){if(!this.__localizationReader)return void(this.__display.textContent=this.__userValue.map(criterion=>criterion.name).join(", "));const criterions=this.__userValue.map(criterion=>this.__localizationReader.get(this.__criterions.get(criterion.name)?.localizationKey??criterion.name??""));criterions.length>0?this.__display.textContent=tchmi_format_string(this.__localizationReader.get("Label_OrderBy"),criterions.join(", ")):this.__display.textContent=this.__localizationReader.get("Label_OrderBy_Unconfigured")}__updateDropdown(sorting){let positionAvailable=sorting.length;this.__divider.style.setProperty("--position",positionAvailable.toString());for(const[name,{element}]of this.__criterions){const index=sorting.findIndex(criterion=>criterion.name===name);let position;element.classList.remove("ascending","descending"),-1!==index?(position=index,element.classList.add("active",sorting[index].order.toLowerCase())):(position=++positionAvailable,element.classList.remove("active")),element.style.setProperty("--position",position.toString())}}__positionDropdown(){if(!this.__host.isConnected)return;const viewportHeight=TcHmi.View.getViewportElementDimension()?.height??window.innerHeight,viewportWidth=TcHmi.View.getViewportElementDimension()?.width??window.innerWidth,hostBCR=this.__host.getBoundingClientRect(),dropdownBCR=this.__dropdown.getBoundingClientRect();let maxHeight=viewportHeight-hostBCR.bottom;const style={top:hostBCR.top+hostBCR.height+"px",left:hostBCR.right-dropdownBCR.width+"px","max-height":maxHeight+"px"};let dropdownHeight=dropdownBCR.height;viewportHeight-hostBCR.bottom<hostBCR.top&&dropdownHeight>maxHeight?(maxHeight=hostBCR.top,style.top=(hostBCR.top-dropdownHeight>0?hostBCR.top-dropdownHeight:0)+"px",style["max-height"]=maxHeight+"px",this.__dropdown.classList.add("above-host")):this.__dropdown.classList.remove("above-host"),(dropdownBCR.width>hostBCR.width&&hostBCR.right<dropdownBCR.width||dropdownBCR.width<hostBCR.width&&hostBCR.right>viewportWidth)&&(style.left=hostBCR.left+"px"),TcHmi.StyleProvider.setSimpleElementStyle(this.__dropdown,style)}}})();export{SortConfigurator};