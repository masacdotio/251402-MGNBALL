var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{OkCancelPrompt}from"../../Helpers/TcHmiPopups/OkCancelPrompt.js";let FileConflictPrompt=(()=>{var _a;let ___onRadioStateChanged_decorators,_classSuper=OkCancelPrompt,_instanceExtraInitializers=[];return class extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onRadioStateChanged_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],__esDecorate(this,null,___onRadioStateChanged_decorators,{kind:"method",name:"__onRadioStateChanged",static:!1,private:!1,access:{has:obj=>"__onRadioStateChanged"in obj,get:obj=>obj.__onRadioStateChanged},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}__existingNames=__runInitializers(this,_instanceExtraInitializers);__elementLabel;__rows;__doAll=void 0;constructor(conflictingNames,existingNames,parentControl){super(parentControl),this.__existingNames=new Set(existingNames),this.__elementLabel=this.__elementContent.appendChild(document.createElement("span")),this.__elementLabel.className=`${this.__className}-label-block`;const elementScrollContainer=this.__elementContent.appendChild(document.createElement("div"));elementScrollContainer.className=`${this.__className}-scroll-container`,this.__rows=new Map;for(const[name,replaceable]of conflictingNames){const row=this.__buildRow(name,replaceable,this.__onRadioStateChanged);elementScrollContainer.appendChild(row.container),this.__rows.set(name,row.controls)}if(this.__rows.size>1){const row=this.__buildRow("");TcHmi.EventProvider.register(row.controls.skip.getId()+".onRadioStateChanged",this.__getOnAllRadioStateChangedHandler("skip")),TcHmi.EventProvider.register(row.controls.replace.getId()+".onRadioStateChanged",this.__getOnAllRadioStateChangedHandler("replace")),TcHmi.EventProvider.register(row.controls.both.getId()+".onRadioStateChanged",this.__getOnAllRadioStateChangedHandler("both")),this.__elementContent.insertBefore(row.container,elementScrollContainer),this.__doAll={label:row.label,controls:row.controls}}}destroy(force=!1){for(const row of this.__rows.values())TcHmi.Binding.removeEx2(null,"Text",row.skip),TcHmi.Binding.removeEx2(null,"Text",row.replace),TcHmi.Binding.removeEx2(null,"Text",row.both);this.__doAll&&(TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.skip),TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.replace),TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.both)),super.destroy(force)}__buildRow(labelText,replaceable=!0,eventHandler){const container=document.createElement("div");container.className=`${this.__className}-radio-row`;const label=container.appendChild(document.createElement("span"));label.textContent=labelText;const guid=tchmi_create_guid(),[skip,replace,both]=["skip","replace","both"].map(controlName=>{const control=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",`${this.__name}.${controlName}.${guid}`,{"data-tchmi-radio-group":guid,"data-tchmi-is-enabled":"replace"!==controlName||replaceable,"data-tchmi-ignore-escape-sequences":!0},this.__parentControl);if(!control)throw new Error("Could not create controls for FileConflictPrompt");return eventHandler&&TcHmi.EventProvider.register(control.getId()+".onRadioStateChanged",eventHandler),container.appendChild(control.getElement()[0]),this.__childControls.push(control),control});return{container,label,controls:{skip,replace,both}}}__onRadioStateChanged(){let isValid=!0;const allActive={skip:!0,replace:!0,both:!0};for(const controls of this.__rows.values()){let activeRadios=0;for(const[controlName,radio]of Object.entries(controls))"Active"===radio.getRadioState()&&radio.getIsEnabled()?activeRadios++:allActive[controlName]=!1;if(1!==activeRadios){isValid=!1;break}}this.__okButton.setIsEnabled(isValid),this.__doAll&&(this.__doAll.controls.skip.setRadioState(allActive.skip&&isValid?"Active":"Normal"),this.__doAll.controls.replace.setRadioState(allActive.replace&&isValid?"Active":"Normal"),this.__doAll.controls.both.setRadioState(allActive.both&&isValid?"Active":"Normal"))}__getOnAllRadioStateChangedHandler(name){return()=>{for(const controls of this.__rows.values())controls[name].getIsEnabled()&&controls[name].setRadioState("Active")}}__ok(){const answerValue=new Map;for(const[name,controls]of this.__rows)if("Active"===controls.replace.getRadioState())answerValue.set(name,name),this.__existingNames.add(name);else if("Active"===controls.both.getRadioState()){const dotIndex=name.lastIndexOf(".");let rawName=dotIndex>0?name.slice(0,dotIndex):name;const extension=dotIndex>0?name.slice(dotIndex):"",counterEnding=rawName.match(/\((\d+)\)$/);let counter,newName;counterEnding?(counter=parseInt(counterEnding[1],10),rawName=rawName.slice(0,counterEnding.index),Number.isNaN(counter)&&(counter=0)):(counter=0,rawName+=" ");do{counter++,newName=`${rawName}(${counter})${extension}`}while(this.__existingNames.has(newName));answerValue.set(name,newName),this.__existingNames.add(newName)}this.__prompt?.answer({isOk:!0,value:answerValue})}setLocalizations(texts){if(super.setLocalizations(texts),this.__applyTextToElement("headerText",texts.headerText,this.__elementHeader),this.__applyTextToElement("labelText",texts.labelText,this.__elementLabel),this.__doAll&&this.__applyTextToElement("labelDoForAll",texts.labelDoForAll,this.__doAll.label),texts.radioTextSkip)if("string"==typeof texts.radioTextSkip){this.__unwatchLocalization("buttonTextSkip");for(const row of this.__rows.values())TcHmi.Binding.createEx2(texts.radioTextSkip,"Text",row.skip);this.__doAll&&TcHmi.Binding.createEx2(texts.radioTextSkip,"Text",this.__doAll.controls.skip)}else{for(const row of this.__rows.values())TcHmi.Binding.removeEx2(null,"Text",row.skip);this.__doAll&&TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.skip),this.__watchLocalization("buttonTextSkip",texts.radioTextSkip,text=>{for(const row of this.__rows.values())row.skip.setText(text);this.__doAll&&this.__doAll.controls.skip.setText(text)})}if(texts.radioTextReplace)if("string"==typeof texts.radioTextReplace){this.__unwatchLocalization("buttonTextReplace");for(const row of this.__rows.values())TcHmi.Binding.createEx2(texts.radioTextReplace,"Text",row.replace);this.__doAll&&TcHmi.Binding.createEx2(texts.radioTextReplace,"Text",this.__doAll.controls.replace)}else{for(const row of this.__rows.values())TcHmi.Binding.removeEx2(null,"Text",row.replace);this.__doAll&&TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.replace),this.__watchLocalization("buttonTextReplace",texts.radioTextReplace,text=>{for(const row of this.__rows.values())row.replace.setText(text);this.__doAll&&this.__doAll.controls.replace.setText(text)})}if(texts.radioTextKeepBoth)if("string"==typeof texts.radioTextKeepBoth){this.__unwatchLocalization("buttonTextKeepBoth");for(const row of this.__rows.values())TcHmi.Binding.createEx2(texts.radioTextKeepBoth,"Text",row.both);this.__doAll&&TcHmi.Binding.createEx2(texts.radioTextKeepBoth,"Text",this.__doAll.controls.both)}else{for(const row of this.__rows.values())TcHmi.Binding.removeEx2(null,"Text",row.both);this.__doAll&&TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.both),this.__watchLocalization("buttonTextKeepBoth",texts.radioTextKeepBoth,text=>{for(const row of this.__rows.values())row.both.setText(text);this.__doAll&&this.__doAll.controls.both.setText(text)})}}}})();export{FileConflictPrompt};