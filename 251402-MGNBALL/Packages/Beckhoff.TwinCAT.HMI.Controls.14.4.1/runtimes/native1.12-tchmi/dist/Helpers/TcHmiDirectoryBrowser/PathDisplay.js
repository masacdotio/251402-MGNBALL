var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{Display}from"./Display.js";import{DirectoryBrowser}from"./DirectoryBrowser.js";let PathDisplay=(()=>{var _a,_b,_c,_d;let ___onClick_decorators,___onMouseDown_decorators,___onMouseUp_decorators,___onMouseMove_decorators,_classSuper=Display,_instanceExtraInitializers=[];return class extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onClick_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],___onMouseDown_decorators=[(_b=TcHmi).CallbackMethod.bind(_b)],___onMouseUp_decorators=[(_c=TcHmi).CallbackMethod.bind(_c)],___onMouseMove_decorators=[(_d=TcHmi).CallbackMethod.bind(_d)],__esDecorate(this,null,___onClick_decorators,{kind:"method",name:"__onClick",static:!1,private:!1,access:{has:obj=>"__onClick"in obj,get:obj=>obj.__onClick},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onMouseDown_decorators,{kind:"method",name:"__onMouseDown",static:!1,private:!1,access:{has:obj=>"__onMouseDown"in obj,get:obj=>obj.__onMouseDown},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onMouseUp_decorators,{kind:"method",name:"__onMouseUp",static:!1,private:!1,access:{has:obj=>"__onMouseUp"in obj,get:obj=>obj.__onMouseUp},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onMouseMove_decorators,{kind:"method",name:"__onMouseMove",static:!1,private:!1,access:{has:obj=>"__onMouseMove"in obj,get:obj=>obj.__onMouseMove},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}__scrollContainer=__runInitializers(this,_instanceExtraInitializers);__itemListElement;__mouseDragScrolling={startX:0,mouseDown:!1,dragging:!1,ignoreClick:!1};__eventDestroyers=[];constructor(element,parentControl){super(element,parentControl),this.__element.classList.add("TcHmi_Controls_Helpers_DirectoryBrowser-path-display"),this.__scrollContainer=document.createElement("div"),this.__scrollContainer.classList.add("TcHmi_Controls_Helpers_DirectoryBrowser-path-display-scroll-container"),this.__itemListElement=document.createElement("ul"),this.__itemListElement.classList.add("TcHmi_Controls_Helpers_DirectoryBrowser-path-display-item-list"),this.__scrollContainer.appendChild(this.__itemListElement),this.__element.appendChild(this.__scrollContainer)}__onClick(event){if(this.__mouseDragScrolling.ignoreClick)return;if(!this.__directory)return;if(!(event.target instanceof Element))return;if(!this.__parentControl.getIsEnabled()||!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return;const target=event.target.closest("li");if(!target||!this.__itemListElement.contains(target))return;const path=target.dataset.path;this.__directory.setPathAndValidate(path?path.split("::"):[])}__onMouseDown(event){this.__directory&&event.target instanceof Element&&this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"observe")&&(this.__mouseDragScrolling.startX=event.pageX,this.__mouseDragScrolling.mouseDown=!0,this.__mouseDragScrolling.ignoreClick=!1)}__onMouseUp(event){this.__mouseDragScrolling.dragging&&(this.__mouseDragScrolling.ignoreClick=!0),this.__mouseDragScrolling.dragging=!1,this.__mouseDragScrolling.mouseDown=!1}__onMouseMove(event){this.__mouseDragScrolling.mouseDown&&(this.__mouseDragScrolling.dragging?this.__scrollContainer.scrollLeft-=event.movementX:Math.abs(event.pageX-this.__mouseDragScrolling.startX)>=10&&(this.__mouseDragScrolling.dragging=!0,this.__scrollContainer.scrollLeft-=event.pageX-this.__mouseDragScrolling.startX))}suspend(clear=!1){if(!this.__suspended){super.suspend(clear);for(const destroyer of this.__eventDestroyers)destroyer();this.__eventDestroyers=[],clear&&this.__updatePath(null)}}resume(){this.__suspended&&(super.resume(),this.__eventDestroyers.push(TcHmi.EventProvider.registerDomEvent(this.__itemListElement,"click",this.__onClick),TcHmi.EventProvider.registerDomEvent(this.__element,"mousedown",this.__onMouseDown),TcHmi.EventProvider.registerDomEvent(document,"mouseup",this.__onMouseUp),TcHmi.EventProvider.registerDomEvent(document,"mousemove",this.__onMouseMove)),this.__processDirectory())}__processDirectory(){this.__directory&&this.__directory.onPathChange.add(()=>this.__updatePath(this.__directory?.decoratedPath)),this.__updatePath(this.__directory?.decoratedPath)}__updatePath(path){if(!path){for(;this.__itemListElement.firstChild;)this.__itemListElement.firstChild.remove();return}const fragment=document.createDocumentFragment();let currentElement=this.__itemListElement.firstElementChild;for(const item of path)currentElement instanceof HTMLLIElement?this.__createOrUpdateListElement(item,currentElement):(currentElement=this.__createOrUpdateListElement(item),fragment.appendChild(currentElement)),currentElement=currentElement.nextElementSibling;for(;currentElement;){const toRemove=currentElement;currentElement=currentElement.nextElementSibling,toRemove.remove()}fragment.childElementCount>0&&this.__itemListElement.appendChild(fragment),this.__scrollContainer.scroll({left:this.__scrollContainer.scrollWidth,behavior:"smooth"})}__createOrUpdateListElement(item,element){let li,a;li=element instanceof HTMLElement?element:document.createElement("li"),li.firstElementChild?a=li.firstElementChild:(a=document.createElement("a"),li.appendChild(a));const displayName=item.type!==DirectoryBrowser.ItemType.Root?item.name:"/";a.textContent!==displayName&&(a.textContent=displayName);const className=item.type===DirectoryBrowser.ItemType.File?"file":"folder";li.className!==className&&(li.className=className);for(const key in li.dataset)delete li.dataset[key];if(item.metadata)for(const key in item.metadata){const type=typeof item.metadata[key];if("string"===type||"number"===type||"boolean"===type)try{li.dataset["metadata"+key.slice(0,1).toUpperCase()+key.slice(1)]=item.metadata[key]}catch(e){TcHmi.Log.errorEx(`[Source=Control, Module=TcHmi.Controls.Helpers.DirectoryBrowser, ControlId=${this.__parentControl.getId()}] The metadata property "${key}" contains characters that cannot be used in a data-attribute. Please use only letters, numbers, periods, colons and underscores in metadata property names.`)}}return li.dataset.path=DirectoryBrowser.getPath(item).join("::"),li}}})();export{PathDisplay};TcHmi.Controls.Helpers??={},TcHmi.Controls.Helpers.PathDisplay=PathDisplay;