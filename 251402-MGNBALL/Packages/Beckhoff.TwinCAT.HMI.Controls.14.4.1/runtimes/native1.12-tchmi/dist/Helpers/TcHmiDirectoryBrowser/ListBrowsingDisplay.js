var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{Display}from"./Display.js";import{DirectoryBrowser}from"./DirectoryBrowser.js";let ListBrowsingDisplay=(()=>{var _a,_b,_c,_d,_e;let ___onPointerDown_decorators,___onPointerUp_decorators,___onPointerMove_decorators,___onScroll_decorators,___onContextMenu_decorators,_classSuper=Display,_instanceExtraInitializers=[];return class ListBrowsingDisplay extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onPointerDown_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],___onPointerUp_decorators=[(_b=TcHmi).CallbackMethod.bind(_b)],___onPointerMove_decorators=[(_c=TcHmi).CallbackMethod.bind(_c)],___onScroll_decorators=[(_d=TcHmi).CallbackMethod.bind(_d)],___onContextMenu_decorators=[(_e=TcHmi).CallbackMethod.bind(_e)],__esDecorate(this,null,___onPointerDown_decorators,{kind:"method",name:"__onPointerDown",static:!1,private:!1,access:{has:obj=>"__onPointerDown"in obj,get:obj=>obj.__onPointerDown},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onPointerUp_decorators,{kind:"method",name:"__onPointerUp",static:!1,private:!1,access:{has:obj=>"__onPointerUp"in obj,get:obj=>obj.__onPointerUp},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onPointerMove_decorators,{kind:"method",name:"__onPointerMove",static:!1,private:!1,access:{has:obj=>"__onPointerMove"in obj,get:obj=>obj.__onPointerMove},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onScroll_decorators,{kind:"method",name:"__onScroll",static:!1,private:!1,access:{has:obj=>"__onScroll"in obj,get:obj=>obj.__onScroll},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onContextMenu_decorators,{kind:"method",name:"__onContextMenu",static:!1,private:!1,access:{has:obj=>"__onContextMenu"in obj,get:obj=>obj.__onContextMenu},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}__showingParent=(__runInitializers(this,_instanceExtraInitializers),!1);__lastPointerDown={type:"",timestamp:0,doubleClickOnNextUp:!1,ignoreNextUp:!1,target:null,timeoutID:0,coords:{x:0,y:0}};__pointerMultiselect=!1;__formatMetadata=null;__search=null;__sort=null;__defaultSort={sorting:[{name:"type",order:"Descending"},{name:"name",order:"Ascending"}],caseSensitive:!1};__eventDestroyers=[];constructor(element,parentControl){super(element,parentControl),this.__element.classList.add("TcHmi_Controls_Helpers_DirectoryBrowser-browsing-display")}__onPointerDown(event){clearTimeout(this.__lastPointerDown.timeoutID),this.__lastPointerDown.timeoutID=0,this.__lastPointerDown.ignoreNextUp=!1,this.__lastPointerDown.coords.x=event.clientX,this.__lastPointerDown.coords.y=event.clientY;const eventInfo=this.__preprocessPointerEvent(event);if(!eventInfo)return this.__lastPointerDown.target=event.target,void(this.__lastPointerDown.doubleClickOnNextUp=!1);const now=Date.now();this.__lastPointerDown.type===event.pointerType&&this.__lastPointerDown.target===eventInfo.target&&now-this.__lastPointerDown.timestamp<=500&&(this.__lastPointerDown.doubleClickOnNextUp=!0),this.__lastPointerDown.type=event.pointerType,this.__lastPointerDown.timestamp=now,this.__lastPointerDown.target=eventInfo.target,this.__lastPointerDown.timeoutID=setTimeout(()=>{this.__lastPointerDown.timeoutID=0,this.__lastPointerDown.doubleClickOnNextUp=!1,this.__lastPointerDown.ignoreNextUp=!0,this.__pointerMultiselect=!0,this.__select(eventInfo)},500)}__onPointerUp(event){if(clearTimeout(this.__lastPointerDown.timeoutID),this.__lastPointerDown.timeoutID=0,this.__lastPointerDown.ignoreNextUp)return void(this.__lastPointerDown.ignoreNextUp=!1);if(this.__lastPointerDown.type!==event.pointerType)return;const eventInfo=this.__preprocessPointerEvent(event);if(!eventInfo)return this.__lastPointerDown.target===event.target&&(this.__select(null),this.__pointerMultiselect=!1),this.__lastPointerDown.target=null,void(this.__lastPointerDown.doubleClickOnNextUp=!1);this.__lastPointerDown.target===eventInfo.target&&(this.__lastPointerDown.doubleClickOnNextUp?(this.__navigate(eventInfo),this.__lastPointerDown.doubleClickOnNextUp=!1,this.__lastPointerDown.timestamp=0):this.__select(eventInfo))}__onPointerMove(event){if(0===this.__lastPointerDown.timeoutID)return;const deltaX=this.__lastPointerDown.coords.x-event.clientX,deltaY=this.__lastPointerDown.coords.y-event.clientY;deltaX*deltaX+deltaY*deltaY>225&&(clearTimeout(this.__lastPointerDown.timeoutID),this.__lastPointerDown.timeoutID=0)}__onScroll(){clearTimeout(this.__lastPointerDown.timeoutID),this.__lastPointerDown.timeoutID=0}__onContextMenu(event){this.__pointerMultiselect&&event.preventDefault()}__preprocessPointerEvent(event){if(!this.__directory)return!1;if(!(event.target instanceof Element))return!1;if("mouse"===event.pointerType&&0!==event.button)return!1;if(!this.__parentControl.getIsEnabled()||!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return!1;const target=event.target.closest("li");if(!target||!this.__element.contains(target))return!1;const name=target.dataset.name,isParent="true"===target.dataset.isParent;return!(!isParent&&!name)&&{target,item:isParent?{isParent:!0}:{isParent:!1,name},multiselect:event.ctrlKey||this.__pointerMultiselect}}async __select(event){this.__directory&&(event?event.item.isParent||(event.multiselect&&this.__directory.selectedItemNames.has(event.item.name)?(await this.__directory.deselectItem(event.item.name),0===this.__directory.selectedItemNames.size&&(this.__pointerMultiselect=!1)):this.__directory.selectItem(event.item.name,event.multiselect)):this.__directory.clearSelection())}__navigate(event){if(this.__directory)if(this.__showingParent){const path=tchmi_clone_object(this.__directory.path);path.pop(),event.item.isParent?path.pop():path.push(event.item.name),this.__directory.setPathAndValidate(path)}else event.item.isParent?this.__directory.popPath():this.__directory.pushPath(event.item.name)}suspend(clear=!1){if(!this.__suspended){super.suspend(clear);for(const destroyer of this.__eventDestroyers)destroyer();this.__eventDestroyers=[],clear&&this.__updateCurrentItem(null)}}resume(){this.__suspended&&(super.resume(),this.__eventDestroyers.push(TcHmi.EventProvider.registerDomEvent(document,"pointerdown",this.__onPointerDown),TcHmi.EventProvider.registerDomEvent(document,"pointermove",this.__onPointerMove),TcHmi.EventProvider.registerDomEvent(document,"scroll",this.__onScroll),TcHmi.EventProvider.registerDomEvent(this.__element,"pointerup",this.__onPointerUp),TcHmi.EventProvider.registerDomEvent(this.__element,"contextmenu",this.__onContextMenu,{passive:!1})),this.__processDirectory())}showMetadata(metadataFormatter){this.__formatMetadata=metadataFormatter,this.__updateCurrentItem(this.__directory?.currentItem)}hideMetadata(){this.__formatMetadata=null,this.__updateCurrentItem(this.__directory?.currentItem)}search(term,caseSensitive=!1){this.__search=term?{term:caseSensitive?term:term.toLowerCase(),caseSensitive}:null,this.__updateCurrentItem(this.__directory?.currentItem)}sort(sorting,caseSensitive=!1){this.__sort=sorting?{sorting,caseSensitive}:null,this.__updateCurrentItem(this.__directory?.currentItem)}__processDirectory(){this.__directory&&(this.__directory.onPathChange.add(currentItem=>this.__updateCurrentItem(currentItem)),this.__directory.onCurrentItemUpdate.add(currentItem=>this.__updateCurrentItem(currentItem)),this.__directory.onSelectionChange.add(()=>this.__updateSelection())),this.__updateCurrentItem(this.__directory?.currentItem)}__updateCurrentItem(currentItem){if(!currentItem||!this.__directory){for(;this.__element.firstChild;)this.__element.firstChild.remove();return}let currentFolder=currentItem;currentFolder.type===DirectoryBrowser.ItemType.File?(currentFolder=currentFolder.parent,this.__showingParent=!0):this.__showingParent=!1;let directoryItems=Array.from(currentFolder.children.values());this.__search&&(directoryItems=directoryItems.filter(item=>{if(!this.__search)return!0;return(this.__search.caseSensitive?item.name:item.name.toLowerCase()).includes(this.__search.term)})),directoryItems.sort(DirectoryBrowser.compare.bind(this,this.__sort??this.__defaultSort));const fragment=document.createDocumentFragment();let currentElement=this.__element.firstElementChild;currentFolder.type===DirectoryBrowser.ItemType.Folder&&(currentElement instanceof HTMLLIElement?this.__createOrUpdateListElement(currentFolder.parent,ListBrowsingDisplay.ListItemStatus.Parent,currentElement):(currentElement=this.__createOrUpdateListElement(currentFolder.parent,ListBrowsingDisplay.ListItemStatus.Parent),fragment.appendChild(currentElement)),currentElement=currentElement.nextElementSibling);for(const item of directoryItems){let status=ListBrowsingDisplay.ListItemStatus.Default;this.__directory.selectedItemNames.has(item.name)?status=ListBrowsingDisplay.ListItemStatus.Selected:item===currentItem&&(status=ListBrowsingDisplay.ListItemStatus.Current),currentElement instanceof HTMLLIElement?this.__createOrUpdateListElement(item,status,currentElement):(currentElement=this.__createOrUpdateListElement(item,status),fragment.appendChild(currentElement)),currentElement=currentElement.nextElementSibling}for(;currentElement;){const toRemove=currentElement;currentElement=currentElement.nextElementSibling,toRemove.remove()}fragment.childElementCount>0&&this.__element.appendChild(fragment)}__createOrUpdateListElement(item,status=ListBrowsingDisplay.ListItemStatus.Default,element){let li;li=element||document.createElement("li");const displayName=status!==ListBrowsingDisplay.ListItemStatus.Parent&&item.type!==DirectoryBrowser.ItemType.Root?item.name:"..";li.textContent!==displayName&&(li.textContent=displayName);const className=item.type===DirectoryBrowser.ItemType.File?"file":"folder";li.className!==className&&(li.className=className);for(const key in li.dataset)delete li.dataset[key];switch(status){case ListBrowsingDisplay.ListItemStatus.Selected:li.classList.add("selected");break;case ListBrowsingDisplay.ListItemStatus.Current:li.classList.add("current");break;case ListBrowsingDisplay.ListItemStatus.Parent:li.dataset.isParent="true"}if(status!==ListBrowsingDisplay.ListItemStatus.Parent&&item.type!==DirectoryBrowser.ItemType.Root&&(li.dataset.name=item.name),item.metadata)for(const key in item.metadata){const type=typeof item.metadata[key];if("string"===type||"number"===type||"boolean"===type)try{li.dataset["metadata"+key.slice(0,1).toUpperCase()+key.slice(1)]=item.metadata[key]}catch(e){TcHmi.Log.errorEx(`[Source=Control, Module=TcHmi.Controls.Helpers.DirectoryBrowser, ControlId=${this.__parentControl.getId()}] The metadata property "${key}" contains characters that cannot be used in a data-attribute. Please use only letters, numbers, periods, colons and underscores in metadata property names.`)}}let metadataDisplay=li.querySelector("span");return status!==ListBrowsingDisplay.ListItemStatus.Parent&&this.__formatMetadata?(metadataDisplay||(metadataDisplay=li.appendChild(document.createElement("span"))),metadataDisplay.textContent=this.__formatMetadata(item)):metadataDisplay&&metadataDisplay.remove(),li}__updateSelection(){if(this.__directory)for(const child of this.__element.children){if(!(child instanceof HTMLLIElement))continue;const name=child.dataset.name;name&&child.classList.toggle("selected",this.__directory.selectedItemNames.has(name))}}}})();export{ListBrowsingDisplay};!function(ListBrowsingDisplay){let ListItemStatus;!function(ListItemStatus){ListItemStatus[ListItemStatus.Default=0]="Default",ListItemStatus[ListItemStatus.Selected=1]="Selected",ListItemStatus[ListItemStatus.Current=2]="Current",ListItemStatus[ListItemStatus.Parent=3]="Parent"}(ListItemStatus=ListBrowsingDisplay.ListItemStatus||(ListBrowsingDisplay.ListItemStatus={}))}(ListBrowsingDisplay||(ListBrowsingDisplay={})),TcHmi.Controls.Helpers??={},TcHmi.Controls.Helpers.ListBrowsingDisplay=ListBrowsingDisplay;