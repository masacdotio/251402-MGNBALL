var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{Editor}from"../../BaseEditors/Editor.js";import*as SchemaParser from"../../SchemaParser.js";let HistorizedSymbolEditorPane=(()=>{var _a,_b,_c;let ___onHistorizedSymbolsWatch_decorators,___onRowClick_decorators,___onRowDoubleClick_decorators,_classSuper=Editor,_instanceExtraInitializers=[];return class HistorizedSymbolEditorPane extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onHistorizedSymbolsWatch_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],___onRowClick_decorators=[(_b=TcHmi).CallbackMethod.bind(_b)],___onRowDoubleClick_decorators=[(_c=TcHmi).CallbackMethod.bind(_c)],__esDecorate(this,null,___onHistorizedSymbolsWatch_decorators,{kind:"method",name:"__onHistorizedSymbolsWatch",static:!1,private:!1,access:{has:obj=>"__onHistorizedSymbolsWatch"in obj,get:obj=>obj.__onHistorizedSymbolsWatch},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onRowClick_decorators,{kind:"method",name:"__onRowClick",static:!1,private:!1,access:{has:obj=>"__onRowClick"in obj,get:obj=>obj.__onRowClick},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onRowDoubleClick_decorators,{kind:"method",name:"__onRowDoubleClick",static:!1,private:!1,access:{has:obj=>"__onRowDoubleClick"in obj,get:obj=>obj.__onRowDoubleClick},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}static#tchmiFQN="TcHmi.Controls.Helpers."+this.name;__value=(__runInitializers(this,_instanceExtraInitializers),"");__tableHeaders;__tableBody;__historizedSymbols=null;__destroyWatch=null;__localizedCells={yes:{text:"",elements:new Set},no:{text:"",elements:new Set}};constructor(element,editorInfo,factory){super(element,editorInfo,factory);const table=document.createElement("table"),tr=table.appendChild(document.createElement("thead")).appendChild(document.createElement("tr"));this.__tableHeaders={name:tr.appendChild(document.createElement("th")),dataType:tr.appendChild(document.createElement("th")),recording:tr.appendChild(document.createElement("th")),interval:tr.appendChild(document.createElement("th")),maxEntries:tr.appendChild(document.createElement("th"))},this.__tableBody=table.appendChild(document.createElement("tbody")),element.appendChild(table),this.__eventDestroyers.push(TcHmi.EventProvider.registerDomEvent(this.__tableBody,"click",this.__onRowClick),TcHmi.EventProvider.registerDomEvent(this.__tableBody,"dblclick",this.__onRowDoubleClick)),this.__settings.historizedSymbolEditor?.domain&&(this.__historizedSymbols=new TcHmi.Symbol(`%s%${this.__settings.historizedSymbolEditor.domain}.Config::historizedSymbolList%/s%`),this.__destroyWatch=this.__historizedSymbols.watch(this.__onHistorizedSymbolsWatch))}destroy(){super.destroy(),this.__destroyWatch?.(),this.__destroyWatch=null,this.__historizedSymbols?.destroy(),this.__historizedSymbols=null}setValue(value){if(this.__value!==(value??"")){this.__value=value??"",this.__onChangeManager.trigger(this,this.getState());const row=this.__tableBody.querySelector(`tr[data-name="${value}"]`);this.__select(row)}}getRawValue(){return this.__value}__processEditorInfo(){}__processIsReadOnly(){this.__element.classList.toggle("read-only",this.__isReadOnly)}__onHistorizedSymbolsWatch(data){if(data.error)return void(this.__parentControl?TcHmi.Log.Controls.error(this.__parentControl,HistorizedSymbolEditorPane.#tchmiFQN,{SymbolExpression:data.expression?.toString()},TcHmi.Log.buildMessage(data.details)):TcHmi.Log.errorEx(`[Source=Control, Module=Beckhoff.TwinCAT.HMI.Controls, Origin=${HistorizedSymbolEditorPane.#tchmiFQN}, TcHmi.SymbolExpression=${data.expression?.toString()}] `+TcHmi.Log.buildMessage(data.details)));const historizedSymbols=data.value??{};let currentRow=this.__tableBody.firstElementChild;const rowsToAdd=document.createDocumentFragment();for(const[name,info]of Object.entries(historizedSymbols)){currentRow||(currentRow=rowsToAdd.appendChild(document.createElement("tr")));const cells={};let currentCell=currentRow.firstElementChild;for(const name of Object.keys(this.__tableHeaders))cells[name]=currentCell??currentRow.appendChild(document.createElement("td")),cells[name].dataset.name=name,currentCell=currentCell?.nextElementSibling??null;cells.name.textContent=name,info.recordingEnabled?(this.__localizedCells.no.elements.delete(cells.recording),this.__localizedCells.yes.elements.add(cells.recording),cells.recording.textContent=this.__localizedCells.yes.text):(this.__localizedCells.yes.elements.delete(cells.recording),this.__localizedCells.no.elements.add(cells.recording),cells.recording.textContent=this.__localizedCells.no.text),cells.interval.textContent=info.interval,cells.maxEntries.textContent=info.maxEntries.toString(10),TcHmi.Symbol.resolveSchema(`%s%${name}%/s%`,data=>{data.schema&&(cells.dataType.textContent=SchemaParser.generateName(data.schema))}),currentRow.dataset.name=name,currentRow.classList.toggle("selected",name===this.__value),currentRow=currentRow.nextElementSibling}for(;currentRow;){const next=currentRow.nextElementSibling;currentRow.remove(),currentRow=next}this.__tableBody.appendChild(rowsToAdd)}__onRowClick(event){if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}if(this.__isReadOnly)return;const row=event.target.closest("tr");row&&this.__select(row)}__onRowDoubleClick(event){if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}if(this.__isReadOnly)return;if(!event.target.closest("tr"))return;const state=this.getState();state.isValid&&this.__onConfirmManager.trigger(this,state)}__select(row){this.__tableBody.querySelector("tr.selected")?.classList.remove("selected"),row&&(row.classList.add("selected"),this.__value!==(row.dataset.name??"")&&(this.__value=row.dataset.name??"",this.__onChangeManager.trigger(this,this.getState())))}setSettings(settings){const update=settings.historizedSymbolEditor?.domain!==this.__settings.historizedSymbolEditor?.domain;super.setSettings(settings),update&&(this.__destroyWatch?.(),this.__historizedSymbols?.destroy(),this.__settings.historizedSymbolEditor?.domain?(this.__historizedSymbols=new TcHmi.Symbol(`%s%${this.__settings.historizedSymbolEditor.domain}.Config::historizedSymbolList%/s%`),this.__destroyWatch=this.__historizedSymbols.watch(this.__onHistorizedSymbolsWatch)):(this.__destroyWatch=null,this.__historizedSymbols=null))}setLocalizations(texts){super.setLocalizations(texts),this.__localizations?.historizedSymbolEditor?.nameColumnHeader&&this.__watchLocalization("nameColumnHeader","string"==typeof this.__localizations.historizedSymbolEditor.nameColumnHeader?{symbolExpression:this.__localizations.historizedSymbolEditor.nameColumnHeader,formatValues:[]}:this.__localizations.historizedSymbolEditor.nameColumnHeader,text=>{this.__tableHeaders.name.textContent=text}),this.__localizations?.historizedSymbolEditor?.dataTypeColumnHeader&&this.__watchLocalization("dataTypeColumnHeader","string"==typeof this.__localizations.historizedSymbolEditor.dataTypeColumnHeader?{symbolExpression:this.__localizations.historizedSymbolEditor.dataTypeColumnHeader,formatValues:[]}:this.__localizations.historizedSymbolEditor.dataTypeColumnHeader,text=>{this.__tableHeaders.dataType.textContent=text}),this.__localizations?.historizedSymbolEditor?.recordingColumnHeader&&this.__watchLocalization("recordingColumnHeader","string"==typeof this.__localizations.historizedSymbolEditor.recordingColumnHeader?{symbolExpression:this.__localizations.historizedSymbolEditor.recordingColumnHeader,formatValues:[]}:this.__localizations.historizedSymbolEditor.recordingColumnHeader,text=>{this.__tableHeaders.recording.textContent=text}),this.__localizations?.historizedSymbolEditor?.intervalColumnHeader&&this.__watchLocalization("intervalColumnHeader","string"==typeof this.__localizations.historizedSymbolEditor.intervalColumnHeader?{symbolExpression:this.__localizations.historizedSymbolEditor.intervalColumnHeader,formatValues:[]}:this.__localizations.historizedSymbolEditor.intervalColumnHeader,text=>{this.__tableHeaders.interval.textContent=text}),this.__localizations?.historizedSymbolEditor?.maxEntriesColumnHeader&&this.__watchLocalization("maxEntriesColumnHeader","string"==typeof this.__localizations.historizedSymbolEditor.maxEntriesColumnHeader?{symbolExpression:this.__localizations.historizedSymbolEditor.maxEntriesColumnHeader,formatValues:[]}:this.__localizations.historizedSymbolEditor.maxEntriesColumnHeader,text=>{this.__tableHeaders.maxEntries.textContent=text}),this.__localizations?.historizedSymbolEditor?.yesText&&this.__watchLocalization("yesText","string"==typeof this.__localizations.historizedSymbolEditor.yesText?{symbolExpression:this.__localizations.historizedSymbolEditor.yesText,formatValues:[]}:this.__localizations.historizedSymbolEditor.yesText,text=>{this.__localizedCells.yes.text=text;for(const cell of this.__localizedCells.yes.elements)cell.textContent=text}),this.__localizations?.historizedSymbolEditor?.noText&&this.__watchLocalization("noText","string"==typeof this.__localizations.historizedSymbolEditor.noText?{symbolExpression:this.__localizations.historizedSymbolEditor.noText,formatValues:[]}:this.__localizations.historizedSymbolEditor.noText,text=>{this.__localizedCells.no.text=text;for(const cell of this.__localizedCells.no.elements)cell.textContent=text})}}})();export{HistorizedSymbolEditorPane};TcHmi.Controls.Helpers??={},TcHmi.Controls.Helpers.HistorizedSymbolEditorPane=HistorizedSymbolEditorPane;