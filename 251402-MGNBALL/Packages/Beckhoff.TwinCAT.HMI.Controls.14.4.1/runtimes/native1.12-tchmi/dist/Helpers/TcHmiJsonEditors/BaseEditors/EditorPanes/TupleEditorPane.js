import{ChoiceEditor}from"../ChoiceEditor.js";import{ArrayBasedEditorPane}from"./ArrayBasedEditorPane.js";export class TupleEditorPane extends ArrayBasedEditorPane{constructor(element,editorInfo,factory){super(element,editorInfo,factory)}__processEditorInfo(){const value=this.getRawValue();this.__editorTable.innerHTML="";for(const entry of this.__editors)this.__removeEditorRow(entry);for(const item of this.__editorInfo.items){const editorEntry=this.__createEditorRow(item,!1);this.__editorTable.appendChild(editorEntry.row),this.__editors.push(editorEntry)}this.setValue(value),this.__addItemButton.setVisibility(this.__editorInfo.additionalItems.allowed&&this.__editorInfo.additionalItems.editorInfo?"Visible":"Hidden")}setValue(value){this.__pauseChangeHandlers=!0,value||(value=[]);let index=0;for(let length=value.length;index<length;index++){let editorEntry=this.__editors[index];if(!editorEntry){let info;info=this.__editorInfo.additionalItems.allowed?this.__editorInfo.additionalItems.editorInfo??ChoiceEditor.createAnyEditorInfo():{type:"invalid",schema:{},name:"Invalid"},editorEntry=this.__createEditorRow(info),this.__editorTable.appendChild(editorEntry.row),this.__editors.push(editorEntry)}editorEntry.editor.setValue(value[index])}for(;index<this.__editorInfo.items.length;)this.__editors[index].editor.setValue(void 0),index++;if(index<this.__editors.length){const deletedEditors=this.__editors.splice(index);for(const entry of deletedEditors)this.__removeEditorRow(entry)}this.__pauseChangeHandlers=!1;const state=this.getState();this.__onChangeManager.trigger(this,state),this.__updateValidationStatus(state)}__markRequired(){this.__pauseChangeHandlers=!0;let triggerChangeHandlers=!1,shouldBeRequired=this.__editors.length>this.__editorInfo.items.length;for(let i=this.__editorInfo.items.length-1;i>=0;i--){const editor=this.__editors[i].editor;let editorInfo=this.__editors[i].editor.getEditorInfo();if("optional"!==editorInfo.type)break;editorInfo.temporarilyRequired!==shouldBeRequired&&(editorInfo=tchmi_clone_object(editorInfo),editorInfo.temporarilyRequired=shouldBeRequired,editor.setEditorInfo(editorInfo),triggerChangeHandlers=!0),shouldBeRequired||void 0===editor.getRawValue()||(shouldBeRequired=!0)}this.__pauseChangeHandlers=!1,triggerChangeHandlers&&this.__onChangeManager.trigger(this,this.getState())}__handleOnEditorChanged(editor){super.__handleOnEditorChanged(editor),this.__markRequired()}__addItem(){if(!this.__editorInfo.additionalItems.allowed)return;const info=this.__editorInfo.additionalItems.editorInfo??ChoiceEditor.createAnyEditorInfo(),editorEntry=this.__createEditorRow(info);this.__editorTable.appendChild(editorEntry.row),this.__editors.push(editorEntry),this.__pauseChangeHandlers||this.__onChangeManager.trigger(this,this.getState()),this.__markRequired(),this.__selectItem(editorEntry)}__removeEditorRow(editorEntry){super.__removeEditorRow(editorEntry),this.__markRequired()}__updateMoveButtons(selectedIndex){this.__upButton.setIsEnabled(-1!==selectedIndex&&selectedIndex>this.__editorInfo.items.length),this.__downButton.setIsEnabled(-1!==selectedIndex&&selectedIndex>=this.__editorInfo.items.length&&selectedIndex<this.__editors.length-1)}}TcHmi.Controls.Helpers??={},TcHmi.Controls.Helpers.TupleEditorPane=TupleEditorPane;