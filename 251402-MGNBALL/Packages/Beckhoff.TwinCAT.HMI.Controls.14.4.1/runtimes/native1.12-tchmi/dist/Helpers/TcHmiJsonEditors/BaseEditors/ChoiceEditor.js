var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{Editor}from"./Editor.js";let ChoiceEditor=(()=>{var _a,_b,_c;let ___onSelectionChanged_decorators,___onEditorChanged_decorators,___onEditorConfirmed_decorators,_classSuper=Editor,_instanceExtraInitializers=[];return class ChoiceEditor extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onSelectionChanged_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],___onEditorChanged_decorators=[(_b=TcHmi).CallbackMethod.bind(_b)],___onEditorConfirmed_decorators=[(_c=TcHmi).CallbackMethod.bind(_c)],__esDecorate(this,null,___onSelectionChanged_decorators,{kind:"method",name:"__onSelectionChanged",static:!1,private:!1,access:{has:obj=>"__onSelectionChanged"in obj,get:obj=>obj.__onSelectionChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onEditorChanged_decorators,{kind:"method",name:"__onEditorChanged",static:!1,private:!1,access:{has:obj=>"__onEditorChanged"in obj,get:obj=>obj.__onEditorChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onEditorConfirmed_decorators,{kind:"method",name:"__onEditorConfirmed",static:!1,private:!1,access:{has:obj=>"__onEditorConfirmed"in obj,get:obj=>obj.__onEditorConfirmed},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}__value=__runInitializers(this,_instanceExtraInitializers);__container;__combobox;__editors=new Map;__activeEditor=null;constructor(element,editorInfo,factory){super(element,editorInfo,factory),this.__container=document.createElement("div"),this.__container.classList.add("compound-control-container");const combobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",`${this.__name}.combobox`,{"data-tchmi-content-padding":{top:3,right:3,bottom:3,left:3}},this.__parentControl);if(!combobox)throw new Error("Could not create controls for choice editor.");this.__combobox=combobox,this.__childControls.add(combobox),this.__eventDestroyers.push(TcHmi.EventProvider.register(combobox.getId()+".onSelectionChanged",this.__onSelectionChanged));const comboboxElement=combobox.getElement()[0];comboboxElement.classList.add("type-combobox"),this.__container.appendChild(comboboxElement),this.__processEditorInfo(),element.appendChild(this.__container)}static createAnyEditorInfo(ref){const info=ref??{};return info.type="choice",info.schema={},info.name="Any",info}static getAnyChoices(){return[{type:"boolean",schema:{},name:"Boolean"},{type:"number",schema:{},name:"Number",specialValues:new Set(["NaN","Infinity","-Infinity"]),restrictions:[]},{type:"string",schema:{},name:"String",restrictions:[]},{type:"time",schema:{},name:"Time",formats:new Set(["date-time","timespan"])},{type:"object",schema:{},name:"Object",properties:new Map,additionalProperties:{allowed:!0,editorInfo:ChoiceEditor.createAnyEditorInfo()}},{type:"array",schema:{},name:"Array",items:ChoiceEditor.createAnyEditorInfo(),uniqueItems:!1},{type:"null",schema:{},name:"Null"}]}static validate(editorInfo,value){return!editorInfo.choices||editorInfo.choices.some(info=>Editor.validate(info,value))}static checkForErrors(editorInfo,value,returnEarly=!1){if(!editorInfo.choices)return[];const errors=[];for(const choice of editorInfo.choices){const underlyingErrors=Editor.checkForErrors(choice,value,returnEarly);if(0===underlyingErrors.length)return[];errors.push({error:Editor.Error.DOES_NOT_FIT_THIS_CHOICE,parameters:[value,choice.name],underlying:underlyingErrors})}return[{error:Editor.Error.DOES_NOT_FIT_ANY_CHOICE,parameters:[value],underlying:errors}]}startEditing(){if(!this.__activeEditor)return this.__combobox.focus(),void this.__combobox.open();this.__activeEditor.editor.startEditing?.()}__processEditorInfo(){const choices=this.__editorInfo.choices??ChoiceEditor.getAnyChoices();if(this.__combobox.setSrcData(choices.map(choice=>({text:choice.name}))),this.__activeEditor){const currentlyChosenEditorInfo=this.__activeEditor.editor.getEditorInfo(),unboxedType="optional"===currentlyChosenEditorInfo.type?currentlyChosenEditorInfo.editorInfo.type:currentlyChosenEditorInfo.type;choices.some(choice=>"optional"!==choice.type?choice.type===unboxedType:choice.editorInfo.type===unboxedType&&"optional"===currentlyChosenEditorInfo.type)||(this.__activeEditor.container.remove(),this.__activeEditor.editor.onChange.remove(this.__onEditorChanged),this.__activeEditor.editor.onConfirm.remove(this.__onEditorConfirmed),this.__activeEditor=null,this.__onChangeManager.trigger(this,this.getState()))}for(const[type,editorEntry]of this.__editors){const editorInfo=editorEntry.editor.getEditorInfo(),unboxedType="optional"===editorInfo.type?editorInfo.editorInfo.type:editorInfo.type;choices.some(choice=>"optional"!==choice.type?choice.type===unboxedType:choice.editorInfo.type===unboxedType&&"optional"===editorInfo.type)||this.__editors.delete(type)}}__onSelectionChanged(){const choices=this.__editorInfo.choices??ChoiceEditor.getAnyChoices(),index=this.__combobox.getSelectedIndex();if(null==index||index<0||index>=choices.length)this.__activeEditor?.container.remove(),this.__activeEditor?.editor.onChange.remove(this.__onEditorChanged),this.__activeEditor?.editor.onConfirm.remove(this.__onEditorConfirmed),this.__activeEditor=null;else{const editorInfo=choices[index];let editorEntry=this.__editors.get(editorInfo.type);if(!editorEntry){const container=document.createElement("div");container.classList.add("choice-sub-editor"),editorEntry={editor:this.__factory.fromEditorInfo(editorInfo,container,this),container},this.__editors.set(editorInfo.type,editorEntry)}editorEntry.editor.setEditorInfo(editorInfo),editorEntry.editor.setIsReadOnly(this.__isReadOnly),editorEntry.editor.setSettings(this.__settings),editorEntry.editor.setValue(this.__value),this.__activeEditor?(this.__activeEditor.container.replaceWith(editorEntry.container),this.__activeEditor.editor.onChange.remove(this.__onEditorChanged),this.__activeEditor.editor.onConfirm.remove(this.__onEditorConfirmed)):this.__container.prepend(editorEntry.container),editorEntry.editor.onChange.add(this.__onEditorChanged),editorEntry.editor.onConfirm.add(this.__onEditorConfirmed),this.__activeEditor=editorEntry;const state=this.getState();this.__onChangeManager.trigger(this,state),state.isValid&&"null"===editorInfo.type&&this.__onConfirmManager.trigger(this,state)}}__onEditorChanged(editor,state){this.__value=editor.getRawValue(),this.__onChangeManager.trigger(this,state)}__onEditorConfirmed(_editor,state){this.__onConfirmManager.trigger(this,state)}setValue(value){if(this.__value=value,this.__activeEditor&&Editor.validate(this.__activeEditor.editor.getEditorInfo(),value))return void this.__activeEditor.editor.setValue(value);const currentComboboxIndex=this.__combobox.getSelectedIndex(),availableTypes=[],choices=this.__editorInfo.choices??ChoiceEditor.getAnyChoices();for(const[index,choice]of choices.entries()){if(Editor.validate(choice,value))return void this.__combobox.setSelectedIndex(index);availableTypes.push("optional"!==choice.type?choice.type:choice.editorInfo.type)}const currentlyChosenEditorInfo=this.__activeEditor?.editor.getEditorInfo(),currentType="optional"===currentlyChosenEditorInfo?.type?currentlyChosenEditorInfo.editorInfo.type:currentlyChosenEditorInfo?.type??null;let index;switch(typeof value){case"boolean":index=availableTypes.indexOf("boolean"),-1!==index&&currentType!==availableTypes[index]&&this.__combobox.setSelectedIndex(index);break;case"number":index=availableTypes.indexOf("number"),-1!==index&&currentType!==availableTypes[index]&&this.__combobox.setSelectedIndex(index);break;case"string":index=availableTypes.indexOf("string"),-1===index&&(index=availableTypes.indexOf("time")),-1!==index&&currentType!==availableTypes[index]&&this.__combobox.setSelectedIndex(index);break;case"object":null===value?index=availableTypes.indexOf("null"):Array.isArray(value)?(index=availableTypes.indexOf("array"),-1===index&&(index=availableTypes.indexOf("tuple"))):index=availableTypes.indexOf("object"),-1!==index&&currentType!==availableTypes[index]&&this.__combobox.setSelectedIndex(index)}this.__activeEditor&&this.__combobox.getSelectedIndex()===currentComboboxIndex&&this.__activeEditor.editor.setValue(value)}getState(){return this.__activeEditor?this.__activeEditor.editor.getState():{isValid:!1}}getRawValue(){return this.__activeEditor?this.__activeEditor.editor.getRawValue():this.__value}__processIsReadOnly(){this.__combobox.setIsReadOnly(this.__isReadOnly);for(const editorEntry of this.__editors.values())editorEntry.editor.setIsReadOnly(this.__isReadOnly)}setSettings(settings){super.setSettings(settings);for(const editorEntry of this.__editors.values())editorEntry.editor.setSettings(this.__settings)}setLocalizations(texts){if(super.setLocalizations(texts),this.__localizations){this.__localizations.choiceEditor?.comboboxText&&("string"==typeof this.__localizations.choiceEditor.comboboxText?(this.__unwatchLocalization("comboboxText"),TcHmi.Binding.createEx2(this.__localizations.choiceEditor.comboboxText,"comboboxText",this.__combobox)):(TcHmi.Binding.removeEx2(null,"comboboxText",this.__combobox),this.__watchLocalization("comboboxText",this.__localizations.choiceEditor.comboboxText,text=>this.__combobox.setComboboxText(text))));for(const editorEntry of this.__editors.values())editorEntry.editor.setLocalizations(this.__localizations)}}}})();export{ChoiceEditor};TcHmi.Controls.Helpers??={},TcHmi.Controls.Helpers.ChoiceEditor=ChoiceEditor;