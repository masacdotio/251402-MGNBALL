import{ButtonBasedEditor}from"../BaseEditors/ButtonBasedEditor.js";import{StringEditor}from"../BaseEditors/StringEditor.js";import{EditorPrompt}from"../Popups/EditorPrompt.js";import{HistorizedSymbolEditorPane}from"./EditorPanes/HistorizedSymbolEditorPane.js";export class HistorizedSymbolEditor extends ButtonBasedEditor{static#tchmiFQN="TcHmi.Controls.Helpers."+this.name;__value="";__stringEditor;__popupHeader="";constructor(element,editorInfo,factory){super(element,editorInfo,factory),this.__textSpan.classList.remove("value-description"),this.__textSpan.classList.add("value-editor"),this.__stringEditor=new StringEditor(this.__textSpan,editorInfo,factory),this.__stringEditor.onChange.add(()=>{const stringState=this.__stringEditor.getState(),value=stringState.isValid?stringState.value:this.__stringEditor.getRawValue();this.__value=value,this.__popup?.setValue(value);const historizedSymbolState=this.getState();this.__container.classList.toggle("invalid",!historizedSymbolState.isValid),this.__onChangeManager.trigger(this,historizedSymbolState)}),this.__stringEditor.onConfirm.add(()=>{const state=this.getState();state.isValid&&this.__onConfirmManager.trigger(this,state)}),this.__processEditorInfo(),this.__localizations={...this.__localizations,historizedSymbolEditor:{promptHeader:"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Helpers_JsonEditors_Prompt_Header_HistorizedSymbol%/l%",nameColumnHeader:"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Helpers_JsonEditors_Column_Header_Name%/l%",dataTypeColumnHeader:"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Helpers_JsonEditors_Column_Header_DataType%/l%",recordingColumnHeader:"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Helpers_JsonEditors_Column_Header_Recording%/l%",intervalColumnHeader:"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Helpers_JsonEditors_Column_Header_Interval%/l%",maxEntriesColumnHeader:"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Helpers_JsonEditors_Column_Header_MaxEntries%/l%",yesText:"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Helpers_JsonEditors_Text_Yes%/l%",noText:"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Helpers_JsonEditors_Text_No%/l%"}}}destroy(){super.destroy(),this.__popup?.destroy(!0)}async openPopup(){this.__popup||(this.__popup=new EditorPrompt(this.__editorInfo,HistorizedSymbolEditorPane,this.__factory),this.__popup.setBackgroundAction({close:!0,action:"cancel"}),this.__popup.setIsReadOnly(this.__isReadOnly),this.__popup.setSettings(this.__settings),this.__popup.setLocalizations({buttonTextOk:this.__localizations?.editorPrompt?.buttonTextOk,buttonTooltipOk:this.__localizations?.editorPrompt?.buttonTooltipOk,buttonTextCancel:this.__localizations?.editorPrompt?.buttonTextCancel,buttonTooltipCancel:this.__localizations?.editorPrompt?.buttonTooltipCancel,editorLocalizations:this.__localizations}),this.__popupHeader&&this.__popup.setHeaderText(this.__popupHeader));try{this.__popup.setValue(this.__value);const result=await this.__popup.prompt();if(result.isOk){this.__value=result.value,this.__stringEditor.setValue(result.value);const state=this.getState();this.__container.classList.toggle("invalid",!state.isValid),this.__onChangeManager.trigger(this,state),state.isValid&&this.__onConfirmManager.trigger(this,state)}}catch(ex){}}setValue(value){this.__value=value??"",this.__stringEditor.setValue(value),this.__popup?.setValue(value);const state=this.getState();this.__container.classList.toggle("invalid",!state.isValid),this.__onChangeManager.trigger(this,state)}getRawValue(){return this.__value}__processEditorInfo(){this.__popup?.setEditorInfo(this.__editorInfo),this.__container.classList.toggle("invalid",!this.getState().isValid)}setSettings(settings){super.setSettings(settings)}setLocalizations(texts){super.setLocalizations(texts),this.__localizations?.historizedSymbolEditor?.promptHeader&&this.__watchLocalization("promptHeader","string"==typeof this.__localizations.historizedSymbolEditor.promptHeader?{symbolExpression:this.__localizations.historizedSymbolEditor.promptHeader,formatValues:[]}:this.__localizations.historizedSymbolEditor.promptHeader,text=>{this.__popupHeader=text,this.__popup?.setHeaderText(text)})}}TcHmi.Controls.Helpers??={},TcHmi.Controls.Helpers.HistorizedSymbolEditor=HistorizedSymbolEditor;