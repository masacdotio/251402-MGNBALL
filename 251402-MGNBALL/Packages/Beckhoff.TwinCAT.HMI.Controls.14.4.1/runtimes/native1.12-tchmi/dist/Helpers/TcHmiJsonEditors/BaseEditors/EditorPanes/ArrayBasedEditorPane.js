var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{Editor}from"../Editor.js";let ArrayBasedEditorPane=(()=>{var _a,_b,_c,_d,_e,_f;let ___onEditorChanged_decorators,___onClick_decorators,___onAddItemPressed_decorators,___onUpPressed_decorators,___onDownPressed_decorators,___onLocaleChanged_decorators,_classSuper=Editor,_instanceExtraInitializers=[];return class extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onEditorChanged_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],___onClick_decorators=[(_b=TcHmi).CallbackMethod.bind(_b)],___onAddItemPressed_decorators=[(_c=TcHmi).CallbackMethod.bind(_c)],___onUpPressed_decorators=[(_d=TcHmi).CallbackMethod.bind(_d)],___onDownPressed_decorators=[(_e=TcHmi).CallbackMethod.bind(_e)],___onLocaleChanged_decorators=[(_f=TcHmi).CallbackMethod.bind(_f)],__esDecorate(this,null,___onEditorChanged_decorators,{kind:"method",name:"__onEditorChanged",static:!1,private:!1,access:{has:obj=>"__onEditorChanged"in obj,get:obj=>obj.__onEditorChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onClick_decorators,{kind:"method",name:"__onClick",static:!1,private:!1,access:{has:obj=>"__onClick"in obj,get:obj=>obj.__onClick},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onAddItemPressed_decorators,{kind:"method",name:"__onAddItemPressed",static:!1,private:!1,access:{has:obj=>"__onAddItemPressed"in obj,get:obj=>obj.__onAddItemPressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onUpPressed_decorators,{kind:"method",name:"__onUpPressed",static:!1,private:!1,access:{has:obj=>"__onUpPressed"in obj,get:obj=>obj.__onUpPressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onDownPressed_decorators,{kind:"method",name:"__onDownPressed",static:!1,private:!1,access:{has:obj=>"__onDownPressed"in obj,get:obj=>obj.__onDownPressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onLocaleChanged_decorators,{kind:"method",name:"__onLocaleChanged",static:!1,private:!1,access:{has:obj=>"__onLocaleChanged"in obj,get:obj=>obj.__onLocaleChanged},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}__editorTable=__runInitializers(this,_instanceExtraInitializers);__addItemButton;__upButton;__downButton;__removeButtonTooltip="";__errorContainer;__editors=[];__selectedEditorEntry=null;__pauseChangeHandlers=!1;constructor(element,editorInfo,factory){super(element,editorInfo,factory),this.__editorTable=document.createElement("table"),this.__editorTable.classList.add(`${this.__className}-editor-table`),this.__element.appendChild(this.__editorTable);const addItemButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.AddItemButton`,{"data-tchmi-width":30,"data-tchmi-height":30},this.__parentControl),upButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.UpButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1},this.__parentControl),downButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.DownButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1},this.__parentControl);if(!addItemButton||!upButton||!downButton)throw new Error("Could not create controls for array editor.");const buttonContainer=document.createElement("div");buttonContainer.classList.add(`${this.__className}-editor-table-buttons`),this.__addItemButton=addItemButton,this.__childControls.add(addItemButton);addItemButton.getElement()[0].classList.add(`${this.__className}-button-icon-add`),buttonContainer.appendChild(addItemButton.getElement()[0]),this.__upButton=upButton,this.__childControls.add(upButton);upButton.getElement()[0].classList.add(`${this.__className}-button-icon-up`),buttonContainer.appendChild(upButton.getElement()[0]),this.__downButton=downButton,this.__childControls.add(downButton);downButton.getElement()[0].classList.add(`${this.__className}-button-icon-down`),buttonContainer.appendChild(downButton.getElement()[0]),this.__element.appendChild(buttonContainer),this.__errorContainer=document.createElement("div"),this.__errorContainer.classList.add("validation-errors"),this.__element.appendChild(this.__errorContainer),this.__eventDestroyers.push(TcHmi.EventProvider.register(addItemButton.getId()+".onPressed",this.__onAddItemPressed),TcHmi.EventProvider.register(upButton.getId()+".onPressed",this.__onUpPressed),TcHmi.EventProvider.register(downButton.getId()+".onPressed",this.__onDownPressed),TcHmi.EventProvider.registerDomEvent(this.__element,"click",this.__onClick,{passive:!0}),TcHmi.EventProvider.register("onLocaleChanged",this.__onLocaleChanged)),this.__processEditorInfo()}destroy(){TcHmi.Binding.removeEx2(null,"Tooltip",this.__addItemButton),TcHmi.Binding.removeEx2(null,"Tooltip",this.__upButton),TcHmi.Binding.removeEx2(null,"Tooltip",this.__downButton);for(const editorEntry of this.__editors)editorEntry.editor.destroy(),editorEntry.removeButton&&TcHmi.Binding.removeEx2(null,"Tooltip",editorEntry.removeButton);this.__editors=[],super.destroy()}getRawValue(){const value=[];for(const entry of this.__editors){const rawValue=entry.editor.getRawValue();void 0!==rawValue&&value.push(rawValue)}return value}__createEditorRow(editorInfo,removable=!0){const row=document.createElement("tr"),indexCell=document.createElement("td");indexCell.classList.add("name-cell","auto-increment-index"),row.appendChild(indexCell);const editorCell=document.createElement("td");editorCell.classList.add("value-cell"),row.appendChild(editorCell);const editor=this.__factory.fromEditorInfo(editorInfo,editorCell,this);editor.setIsReadOnly(this.__isReadOnly),editor.setSettings(this.__settings),editor.onChange.add(this.__onEditorChanged);const removeCell=document.createElement("td");removeCell.classList.add("remove-cell"),row.appendChild(removeCell);const ret={editor,row,cell:editorCell};if(removable){const removeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.${tchmi_create_guid()}_RemoveButton`,{"data-tchmi-width":30,"data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-tooltip":this.__removeButtonTooltip,"data-tchmi-is-enabled":this.__isEnabled&&!this.__isReadOnly},this.__parentControl);if(!removeButton)throw new Error("Could not create controls for array editor.");this.__childControls.add(removeButton);const destroyEvent=TcHmi.EventProvider.register(removeButton.getId()+".onPressed",this.__getRemoveButtonPressedHandler(ret));this.__eventDestroyers.push(destroyEvent),ret.removeButton=removeButton,ret.removeDestroyer=()=>{this.__childControls.delete(removeButton);const index=this.__eventDestroyers.indexOf(destroyEvent);-1!==index&&this.__eventDestroyers.splice(index,1),destroyEvent(),this.__parentControl&&this.__parentControl.__removeChild(removeButton),removeButton.destroy()};const removeButtonElement=removeButton.getElement()[0];removeButtonElement.classList.add(`${this.__className}-button-icon-remove`),removeCell.appendChild(removeButtonElement)}return ret}__onEditorChanged(editor){this.__handleOnEditorChanged(editor)}__handleOnEditorChanged(_editor){this.__pauseChangeHandlers||(this.__onChangeManager.trigger(this,this.getState()),this.__updateValidationStatus())}__getRemoveButtonPressedHandler(entry){return()=>{if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}this.__removeEditorRow(entry)}}__removeEditorRow(editorEntry){this.__selectedEditorEntry===editorEntry&&this.__selectItem(null),editorEntry.editor.destroy(),editorEntry.row.remove(),editorEntry.removeDestroyer?.();const index=this.__editors.indexOf(editorEntry);if(-1!==index&&this.__editors.splice(index,1),!this.__pauseChangeHandlers){const state=this.getState();this.__onChangeManager.trigger(this,state),this.__updateValidationStatus(state)}}__selectItem(editorEntry){this.__selectedEditorEntry!==editorEntry&&(this.__selectedEditorEntry?.row.classList.remove("selected"),this.__selectedEditorEntry=editorEntry,this.__selectedEditorEntry?.row.classList.add("selected")),this.__updateMoveButtons(editorEntry?this.__editors.indexOf(editorEntry):-1)}__updateMoveButtons(selectedIndex){this.__isEnabled&&!this.__isReadOnly&&(this.__upButton.setIsEnabled(-1!==selectedIndex&&selectedIndex>0),this.__downButton.setIsEnabled(-1!==selectedIndex&&selectedIndex<this.__editors.length-1))}__onClick(event){if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}if(!(event.target instanceof Element)||event.target.closest('div[data-tchmi-type="TcHmi.Controls.Beckhoff.TcHmiButton"]'))return;const row=event.target.closest("tr"),editorEntry=this.__editors.find(entry=>entry.row===row);this.__selectItem(editorEntry??null)}__onAddItemPressed(){if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}this.__addItem(),this.__updateValidationStatus()}__onUpPressed(){if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}if(!this.__selectedEditorEntry||!this.__selectedEditorEntry.row.previousElementSibling)return;const currentIndex=this.__editors.indexOf(this.__selectedEditorEntry);if(-1===currentIndex||0===currentIndex)return;this.__selectedEditorEntry.row.previousElementSibling.insertAdjacentElement("beforebegin",this.__selectedEditorEntry.row),this.__editors.splice(currentIndex-1,0,...this.__editors.splice(currentIndex,1));const state=this.getState();this.__onChangeManager.trigger(this,state),this.__updateValidationStatus(state),this.__selectItem(this.__selectedEditorEntry)}__onDownPressed(){if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}if(!this.__selectedEditorEntry||!this.__selectedEditorEntry.row.nextElementSibling)return;const currentIndex=this.__editors.indexOf(this.__selectedEditorEntry);if(-1===currentIndex||currentIndex===this.__editors.length-1)return;this.__selectedEditorEntry.row.nextElementSibling.insertAdjacentElement("afterend",this.__selectedEditorEntry.row),this.__editors.splice(currentIndex+1,0,...this.__editors.splice(currentIndex,1));const state=this.getState();this.__onChangeManager.trigger(this,state),this.__updateValidationStatus(state),this.__selectItem(this.__selectedEditorEntry)}__onLocaleChanged(){this.__updateValidationStatus()}__updateValidationStatus(state=this.getState()){return this.__errorContainer.textContent=this.__buildValidationMessage(state),state.isValid}setIsEnabled(isEnabled){super.setIsEnabled(isEnabled),this.__selectItem(this.__selectedEditorEntry)}__processIsReadOnly(){for(const control of this.__childControls)control.setIsEnabled(this.__isEnabled&&!this.__isReadOnly);this.__selectItem(this.__selectedEditorEntry);for(const editorEntry of this.__editors)editorEntry.editor.setIsReadOnly(this.__isReadOnly)}setSettings(settings){super.setSettings(settings);for(const editorEntry of this.__editors)editorEntry.editor.setSettings(this.__settings)}setLocalizations(texts){if(super.setLocalizations(texts),this.__localizations){if(this.__localizations.arrayBasedEditorPane?.addButtonTooltip&&("string"==typeof this.__localizations.arrayBasedEditorPane.addButtonTooltip?(this.__unwatchLocalization("addButtonTooltip"),TcHmi.Binding.createEx2(this.__localizations.arrayBasedEditorPane.addButtonTooltip,"Tooltip",this.__addItemButton)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__addItemButton),this.__watchLocalization("addButtonTooltip",this.__localizations.arrayBasedEditorPane.addButtonTooltip,text=>this.__addItemButton.setTooltip(text)))),this.__localizations.arrayBasedEditorPane?.upButtonTooltip&&("string"==typeof this.__localizations.arrayBasedEditorPane.upButtonTooltip?(this.__unwatchLocalization("upButtonTooltip"),TcHmi.Binding.createEx2(this.__localizations.arrayBasedEditorPane.upButtonTooltip,"Tooltip",this.__upButton)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__upButton),this.__watchLocalization("upButtonTooltip",this.__localizations.arrayBasedEditorPane.upButtonTooltip,text=>this.__upButton.setTooltip(text)))),this.__localizations.arrayBasedEditorPane?.downButtonTooltip&&("string"==typeof this.__localizations.arrayBasedEditorPane.downButtonTooltip?(this.__unwatchLocalization("downButtonTooltip"),TcHmi.Binding.createEx2(this.__localizations.arrayBasedEditorPane.downButtonTooltip,"Tooltip",this.__downButton)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__downButton),this.__watchLocalization("downButtonTooltip",this.__localizations.arrayBasedEditorPane.downButtonTooltip,text=>this.__downButton.setTooltip(text)))),this.__localizations.arrayBasedEditorPane?.removeButtonTooltip)if("string"==typeof this.__localizations.arrayBasedEditorPane.removeButtonTooltip){this.__unwatchLocalization("removeButtonTooltip"),this.__removeButtonTooltip=this.__localizations.arrayBasedEditorPane.removeButtonTooltip;for(const editorEntry of this.__editors)editorEntry.removeButton&&TcHmi.Binding.createEx2(this.__localizations.arrayBasedEditorPane.removeButtonTooltip,"Tooltip",editorEntry.removeButton)}else{for(const editorEntry of this.__editors)editorEntry.removeButton&&TcHmi.Binding.removeEx2(null,"Tooltip",editorEntry.removeButton);this.__watchLocalization("removeButtonTooltip",this.__localizations.arrayBasedEditorPane.removeButtonTooltip,text=>{this.__removeButtonTooltip=text;for(const editorEntry of this.__editors)editorEntry.removeButton?.setTooltip(text)})}for(const editorEntry of this.__editors)editorEntry.editor.setLocalizations(this.__localizations)}}}})();export{ArrayBasedEditorPane};TcHmi.Controls.Helpers??={},TcHmi.Controls.Helpers.ArrayBasedEditorPane=ArrayBasedEditorPane;