var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{ObjectEditor}from"../ObjectEditor.js";import{OptionalEditor}from"../OptionalEditor.js";import{Editor}from"../Editor.js";import*as SchemaParser from"../../SchemaParser.js";let ObjectEditorPane=(()=>{var _a,_b,_c,_d,_e,_f;let ___onEditorChanged_decorators,___onAddPropertyPressed_decorators,___onNewPropertyTextChanged_decorators,___onAcceptNewPropertyPressed_decorators,___onCancelNewPropertyPressed_decorators,___onLocaleChanged_decorators,_classSuper=Editor,_instanceExtraInitializers=[];return class extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onEditorChanged_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],___onAddPropertyPressed_decorators=[(_b=TcHmi).CallbackMethod.bind(_b)],___onNewPropertyTextChanged_decorators=[(_c=TcHmi).CallbackMethod.bind(_c)],___onAcceptNewPropertyPressed_decorators=[(_d=TcHmi).CallbackMethod.bind(_d)],___onCancelNewPropertyPressed_decorators=[(_e=TcHmi).CallbackMethod.bind(_e)],___onLocaleChanged_decorators=[(_f=TcHmi).CallbackMethod.bind(_f)],__esDecorate(this,null,___onEditorChanged_decorators,{kind:"method",name:"__onEditorChanged",static:!1,private:!1,access:{has:obj=>"__onEditorChanged"in obj,get:obj=>obj.__onEditorChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onAddPropertyPressed_decorators,{kind:"method",name:"__onAddPropertyPressed",static:!1,private:!1,access:{has:obj=>"__onAddPropertyPressed"in obj,get:obj=>obj.__onAddPropertyPressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onNewPropertyTextChanged_decorators,{kind:"method",name:"__onNewPropertyTextChanged",static:!1,private:!1,access:{has:obj=>"__onNewPropertyTextChanged"in obj,get:obj=>obj.__onNewPropertyTextChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onAcceptNewPropertyPressed_decorators,{kind:"method",name:"__onAcceptNewPropertyPressed",static:!1,private:!1,access:{has:obj=>"__onAcceptNewPropertyPressed"in obj,get:obj=>obj.__onAcceptNewPropertyPressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onCancelNewPropertyPressed_decorators,{kind:"method",name:"__onCancelNewPropertyPressed",static:!1,private:!1,access:{has:obj=>"__onCancelNewPropertyPressed"in obj,get:obj=>obj.__onCancelNewPropertyPressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onLocaleChanged_decorators,{kind:"method",name:"__onLocaleChanged",static:!1,private:!1,access:{has:obj=>"__onLocaleChanged"in obj,get:obj=>obj.__onLocaleChanged},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}__editorTable=__runInitializers(this,_instanceExtraInitializers);__newPropertyContainer;__newPropertyTextbox;__acceptNewPropertyButton;__cancelNewPropertyButton;__addPropertyButton;__removeButtonTooltip="";__errorContainer;__editors=new Map;__dependencyOverride;__pauseChangeHandlers=!1;constructor(element,editorInfo,factory){super(element,editorInfo,factory),this.__dependencyOverride=editorInfo,this.__editorTable=document.createElement("table"),this.__editorTable.classList.add(`${this.__className}-editor-table`),this.__element.appendChild(this.__editorTable);const newPropertyTextbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiInput",`${this.__name}.NewPropertyTextbox`,{"data-tchmi-content-padding":{top:3,right:3,bottom:3,left:3}},this.__parentControl),acceptNewPropertyButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.AcceptNewPropertyButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1},this.__parentControl),cancelNewPropertyButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.CancelNewPropertyButton`,{"data-tchmi-width":30,"data-tchmi-height":30},this.__parentControl),addPropertyButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.AddPropertyButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-visibility":"Collapsed"},this.__parentControl);if(!(newPropertyTextbox&&acceptNewPropertyButton&&cancelNewPropertyButton&&addPropertyButton))throw new Error("Could not create controls for object editor.");this.__newPropertyTextbox=newPropertyTextbox,this.__acceptNewPropertyButton=acceptNewPropertyButton,this.__cancelNewPropertyButton=cancelNewPropertyButton,this.__addPropertyButton=addPropertyButton,this.__childControls.add(newPropertyTextbox),this.__childControls.add(acceptNewPropertyButton),this.__childControls.add(cancelNewPropertyButton),this.__childControls.add(addPropertyButton),this.__newPropertyContainer=document.createElement("div"),this.__newPropertyContainer.classList.add("new-property-container");const newPropertyTextboxElement=newPropertyTextbox.getElement()[0];newPropertyTextboxElement.classList.add("with-validation");const cancelNewPropertyButtonElement=cancelNewPropertyButton.getElement()[0];cancelNewPropertyButtonElement.classList.add(`${this.__className}-button-icon-remove`),this.__newPropertyContainer.appendChild(newPropertyTextboxElement),this.__newPropertyContainer.appendChild(acceptNewPropertyButton.getElement()[0]),this.__newPropertyContainer.appendChild(cancelNewPropertyButtonElement),this.__element.appendChild(this.__newPropertyContainer);addPropertyButton.getElement()[0].classList.add(`${this.__className}-button-icon-add`),this.__element.appendChild(addPropertyButton.getElement()[0]),this.__errorContainer=document.createElement("div"),this.__errorContainer.classList.add("validation-errors"),this.__element.appendChild(this.__errorContainer),this.__eventDestroyers.push(TcHmi.EventProvider.register(newPropertyTextbox.getId()+".onTextChanged",this.__onNewPropertyTextChanged),TcHmi.EventProvider.register(acceptNewPropertyButton.getId()+".onPressed",this.__onAcceptNewPropertyPressed),TcHmi.EventProvider.register(cancelNewPropertyButton.getId()+".onPressed",this.__onCancelNewPropertyPressed),TcHmi.EventProvider.register(addPropertyButton.getId()+".onPressed",this.__onAddPropertyPressed),TcHmi.EventProvider.register("onLocaleChanged",this.__onLocaleChanged)),this.__processEditorInfo()}destroy(){TcHmi.Binding.removeEx2(null,"Tooltip",this.__addPropertyButton),TcHmi.Binding.removeEx2(null,"Text",this.__acceptNewPropertyButton),TcHmi.Binding.removeEx2(null,"Tooltip",this.__acceptNewPropertyButton),TcHmi.Binding.removeEx2(null,"Tooltip",this.__cancelNewPropertyButton);for(const editorEntry of this.__editors.values())editorEntry.editor.destroy(),editorEntry.removeButton&&TcHmi.Binding.removeEx2(null,"Tooltip",editorEntry.removeButton);this.__editors.clear(),super.destroy()}__processEditorInfo(){this.__pauseChangeHandlers=!0;const value=this.getRawValue();this.__editorTable.innerHTML="";for(const name of this.__editors.keys())this.__removeEditorRow(name);for(const[name,info]of this.__editorInfo.properties){const editorEntry=this.__createEditorRow(name,info,!1);this.__editorTable.appendChild(editorEntry.row),this.__editors.set(name,editorEntry)}this.__addPropertyButton.setVisibility(this.__editorInfo.additionalProperties.editorInfo||this.__editorInfo.patternProperties?"Visible":"Collapsed"),this.setValue(value),this.__pauseChangeHandlers=!1}setValue(value){this.__pauseChangeHandlers=!0;const missingProperties=new Set(this.__editors.keys());if(value)for(const key in value){let editorEntry=this.__editors.get(key);if(editorEntry)editorEntry.editor.setValue(value[key]),missingProperties.delete(key);else{const editorInfo=ObjectEditor.getEditorInfoForProperty(this.__editorInfo,key);editorEntry=this.__createEditorRow(key,editorInfo,!0),this.__editorTable.appendChild(editorEntry.row),this.__editors.set(key,editorEntry),editorEntry.editor.setValue(value[key])}}for(const name of missingProperties){const editorEntry=this.__editors.get(name);editorEntry&&(editorEntry.additionalDestroyer?this.__removeEditorRow(name):editorEntry.editor.setValue(void 0))}this.__pauseChangeHandlers=!1;const state=this.getState();this.__onChangeManager.trigger(this,state),this.__applyDependencies(),this.__updateValidationStatus(state)}getRawValue(){const value={};for(const[name,entry]of this.__editors){const rawValue=entry.editor.getRawValue();void 0!==rawValue&&(value[name]=rawValue)}return value}__applyDependencies(){this.__pauseChangeHandlers=!0;const knownProperties=new Set;for(const[name,entry]of this.__editors)void 0!==entry.editor.getRawValue()&&knownProperties.add(name);let resolvedInfo,knownPropertiesCount;do{if(resolvedInfo=ObjectEditor.resolveDependencies(this.__editorInfo,knownProperties),knownPropertiesCount=knownProperties.size,"invalid"===resolvedInfo.type)break;for(const[property,info]of resolvedInfo.properties)("optional"!==info.type||info.temporarilyRequired)&&knownProperties.add(property)}while(knownProperties.size!==knownPropertiesCount);if("invalid"===resolvedInfo.type)return void(this.__pauseChangeHandlers=!1);if(SchemaParser.editorInfoEquivalent(resolvedInfo,this.__dependencyOverride))return void(this.__pauseChangeHandlers=!1);this.__dependencyOverride=resolvedInfo;const updateEditor=(editorEntry,editorInfo)=>{if(!SchemaParser.editorInfoEquivalent(editorEntry.editor.getEditorInfo(),editorInfo))if(editorEntry.editor.getEditorInfo().type===editorInfo.type)editorEntry.editor.setEditorInfo(editorInfo);else{const value=editorEntry.editor.getRawValue();editorEntry.cell.innerHTML="",editorEntry.editor.destroy(),editorEntry.editor=this.__factory.fromEditorInfo(editorInfo,editorEntry.cell,this),editorEntry.editor.setIsReadOnly(this.__isReadOnly),editorEntry.editor.setSettings(this.__settings),editorEntry.editor.setValue(value)}},missingProperties=new Set(this.__editors.keys());for(const[name,editorInfo]of resolvedInfo.properties){missingProperties.delete(name);let entry=this.__editors.get(name);entry?updateEditor(entry,editorInfo):(entry=this.__createEditorRow(name,editorInfo,!0),this.__editorTable.appendChild(entry.row),this.__editors.set(name,entry))}for(const name of missingProperties){const entry=this.__editors.get(name);if(!entry)continue;updateEditor(entry,ObjectEditor.getEditorInfoForProperty(resolvedInfo,name))}this.__addPropertyButton.setVisibility(!resolvedInfo.additionalProperties.editorInfo&&!resolvedInfo.patternProperties||this.__newPropertyContainer.classList.contains("show")?"Collapsed":"Visible"),this.__pauseChangeHandlers=!1,this.__onChangeManager.trigger(this,this.getState())}__createEditorRow(name,editorInfo,isAdditional){const row=document.createElement("tr"),nameCell=document.createElement("td");nameCell.classList.add("name-cell"),nameCell.textContent=name,row.appendChild(nameCell);const editorCell=document.createElement("td");editorCell.classList.add("value-cell"),row.appendChild(editorCell);const editor=this.__factory.fromEditorInfo(editorInfo,editorCell,this);editor.setIsReadOnly(this.__isReadOnly),editor.setSettings(this.__settings),editor.onChange.add(this.__onEditorChanged);const removeCell=document.createElement("td");removeCell.classList.add("remove-cell"),row.appendChild(removeCell);const ret={editor,row,cell:editorCell};if(isAdditional){const removeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.${name}RemoveButton`,{"data-tchmi-width":30,"data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-tooltip":this.__removeButtonTooltip,"data-tchmi-is-enabled":this.__isEnabled&&!this.__isReadOnly},this.__parentControl);if(!removeButton)throw new Error("Could not create controls for object editor.");this.__childControls.add(removeButton);const destroyEvent=TcHmi.EventProvider.register(removeButton.getId()+".onPressed",this.__getRemoveButtonPressedHandler(name));this.__eventDestroyers.push(destroyEvent),ret.removeButton=removeButton,ret.additionalDestroyer=()=>{this.__childControls.delete(removeButton);const index=this.__eventDestroyers.indexOf(destroyEvent);-1!==index&&this.__eventDestroyers.splice(index,1),destroyEvent(),this.__parentControl&&this.__parentControl.__removeChild(removeButton),removeButton.destroy()};const removeButtonElement=removeButton.getElement()[0];removeButtonElement.classList.add(`${this.__className}-button-icon-remove`),removeCell.appendChild(removeButtonElement)}return ret}__onEditorChanged(editor){if(this.__pauseChangeHandlers)return;const state=this.getState();this.__onChangeManager.trigger(this,state),editor instanceof OptionalEditor&&this.__applyDependencies(),this.__updateValidationStatus(state)}__getRemoveButtonPressedHandler(name){return()=>{if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}this.__removeEditorRow(name)}}__removeEditorRow(name){const editorEntry=this.__editors.get(name);if(editorEntry&&(editorEntry.editor.destroy(),editorEntry.row.remove(),editorEntry.additionalDestroyer?.(),this.__editors.delete(name),!this.__pauseChangeHandlers)){const state=this.getState();this.__onChangeManager.trigger(this,state),this.__applyDependencies(),this.__updateValidationStatus(state)}}__onAddPropertyPressed(){if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}this.__newPropertyContainer.classList.add("show"),this.__addPropertyButton.setVisibility("Collapsed"),this.__newPropertyTextbox.focus()}__onNewPropertyTextChanged(){if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}const name=this.__newPropertyTextbox.getText();if(!name)return this.__newPropertyTextbox.getElement()[0].classList.remove("invalid"),void this.__acceptNewPropertyButton.setIsEnabled(!1);!this.__editors.has(name)&&(this.__dependencyOverride.additionalProperties.allowed||this.__dependencyOverride.patternProperties&&Array.from(this.__dependencyOverride.patternProperties.keys()).some(pattern=>pattern.test(name)))?(this.__newPropertyTextbox.getElement()[0].classList.remove("invalid"),this.__acceptNewPropertyButton.setIsEnabled(!0)):(this.__newPropertyTextbox.getElement()[0].classList.add("invalid"),this.__acceptNewPropertyButton.setIsEnabled(!1))}__onAcceptNewPropertyPressed(){if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}const name=this.__newPropertyTextbox.getText();if(!name)return;let possibleEditors=[];if(this.__dependencyOverride.patternProperties&&(possibleEditors=Array.from(this.__dependencyOverride.patternProperties).filter(([pattern,_])=>pattern.test(name)).map(([_,info])=>info)),0===possibleEditors.length&&this.__dependencyOverride.additionalProperties.editorInfo&&(possibleEditors=[this.__dependencyOverride.additionalProperties.editorInfo]),0===possibleEditors.length)return;const editorEntry=this.__createEditorRow(name,SchemaParser.mergeEditorInfos(...possibleEditors),!0);if(this.__editorTable.appendChild(editorEntry.row),this.__editors.set(name,editorEntry),this.__newPropertyTextbox.setText(null),this.__newPropertyContainer.classList.remove("show"),this.__addPropertyButton.setVisibility("Visible"),!this.__pauseChangeHandlers){const state=this.getState();this.__onChangeManager.trigger(this,state),this.__applyDependencies(),this.__updateValidationStatus(state)}}__onCancelNewPropertyPressed(){if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}this.__cancelNewProperty()}__cancelNewProperty(){this.__newPropertyTextbox.setText(null),this.__newPropertyContainer.classList.remove("show"),this.__addPropertyButton.setVisibility("Visible")}__onLocaleChanged(){this.__updateValidationStatus()}__updateValidationStatus(state=this.getState()){return this.__errorContainer.textContent=this.__buildValidationMessage(state),state.isValid}setIsEnabled(isEnabled){super.setIsEnabled(isEnabled),!isEnabled&&this.__newPropertyContainer.classList.contains("show")&&this.__cancelNewProperty(),this.__acceptNewPropertyButton.setIsEnabled(!1)}__processIsReadOnly(){for(const control of this.__childControls)control.setIsEnabled(this.__isEnabled&&!this.__isReadOnly);this.__isReadOnly&&this.__newPropertyContainer.classList.contains("show")&&this.__cancelNewProperty();for(const editorEntry of this.__editors.values())editorEntry.editor.setIsReadOnly(this.__isReadOnly)}setSettings(settings){super.setSettings(settings);for(const editorEntry of this.__editors.values())editorEntry.editor.setSettings(this.__settings)}setLocalizations(texts){if(super.setLocalizations(texts),this.__localizations){if(this.__localizations.objectEditorPane?.addButtonTooltip&&("string"==typeof this.__localizations.objectEditorPane.addButtonTooltip?(this.__unwatchLocalization("addButtonTooltip"),TcHmi.Binding.createEx2(this.__localizations.objectEditorPane.addButtonTooltip,"Tooltip",this.__addPropertyButton)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__addPropertyButton),this.__watchLocalization("addButtonTooltip",this.__localizations.objectEditorPane.addButtonTooltip,text=>this.__addPropertyButton.setTooltip(text)))),this.__localizations.objectEditorPane?.acceptButtonText&&("string"==typeof this.__localizations.objectEditorPane.acceptButtonText?(this.__unwatchLocalization("acceptButtonText"),TcHmi.Binding.createEx2(this.__localizations.objectEditorPane.acceptButtonText,"Text",this.__acceptNewPropertyButton)):(TcHmi.Binding.removeEx2(null,"Text",this.__acceptNewPropertyButton),this.__watchLocalization("acceptButtonText",this.__localizations.objectEditorPane.acceptButtonText,text=>this.__acceptNewPropertyButton.setText(text)))),this.__localizations.objectEditorPane?.acceptButtonTooltip&&("string"==typeof this.__localizations.objectEditorPane.acceptButtonTooltip?(this.__unwatchLocalization("acceptButtonTooltip"),TcHmi.Binding.createEx2(this.__localizations.objectEditorPane.acceptButtonTooltip,"Tooltip",this.__acceptNewPropertyButton)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__acceptNewPropertyButton),this.__watchLocalization("acceptButtonTooltip",this.__localizations.objectEditorPane.acceptButtonTooltip,text=>this.__acceptNewPropertyButton.setTooltip(text)))),this.__localizations.objectEditorPane?.cancelButtonTooltip&&("string"==typeof this.__localizations.objectEditorPane.cancelButtonTooltip?(this.__unwatchLocalization("cancelButtonTooltip"),TcHmi.Binding.createEx2(this.__localizations.objectEditorPane.cancelButtonTooltip,"Tooltip",this.__cancelNewPropertyButton)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__cancelNewPropertyButton),this.__watchLocalization("cancelButtonTooltip",this.__localizations.objectEditorPane.cancelButtonTooltip,text=>this.__cancelNewPropertyButton.setTooltip(text)))),this.__localizations.objectEditorPane?.removeButtonTooltip)if(this.__unwatchLocalization("removeButtonTooltip"),"string"==typeof this.__localizations.objectEditorPane.removeButtonTooltip){this.__removeButtonTooltip=this.__localizations.objectEditorPane.removeButtonTooltip;for(const editorEntry of this.__editors.values())editorEntry.removeButton&&TcHmi.Binding.createEx2(this.__localizations.objectEditorPane.removeButtonTooltip,"Tooltip",editorEntry.removeButton)}else{for(const editorEntry of this.__editors.values())editorEntry.removeButton&&TcHmi.Binding.removeEx2(null,"Tooltip",editorEntry.removeButton);this.__watchLocalization("removeButtonTooltip",this.__localizations.objectEditorPane.removeButtonTooltip,text=>{this.__removeButtonTooltip=text;for(const editorEntry of this.__editors.values())editorEntry.removeButton?.setTooltip(text)})}for(const editorEntry of this.__editors.values())editorEntry.editor.setLocalizations(this.__localizations)}}}})();export{ObjectEditorPane};TcHmi.Controls.Helpers??={},TcHmi.Controls.Helpers.ObjectEditorPane=ObjectEditorPane;