import{ButtonBasedEditor}from"./ButtonBasedEditor.js";import{Editor}from"./Editor.js";import{TupleEditorPrompt}from"../Popups/TupleEditorPrompt.js";import{ArrayEditor}from"./ArrayEditor.js";import{ChoiceEditor}from"./ChoiceEditor.js";export class TupleEditor extends ButtonBasedEditor{__value=[];constructor(element,editorInfo,factory){super(element,editorInfo,factory),this.__processEditorInfo()}destroy(){super.destroy(),this.__popup?.destroy(!0)}static validate(editorInfo,value){return 0===TupleEditor.checkForErrors(editorInfo,value,!0).length}static checkForErrors(editorInfo,value,returnEarly=!1){const arrayEditorInfo={type:"array",schema:editorInfo.schema,name:editorInfo.name,items:ChoiceEditor.createAnyEditorInfo(),uniqueItems:editorInfo.uniqueItems};void 0!==editorInfo.minItems&&(arrayEditorInfo.minItems=editorInfo.minItems),void 0!==editorInfo.maxItems&&(arrayEditorInfo.maxItems=editorInfo.maxItems);const errors=ArrayEditor.checkForErrors(arrayEditorInfo,value,returnEarly);if(returnEarly&&errors.length>0)return errors;if(!Array.isArray(value))return errors.length>0?errors:[{error:Editor.Error.NOT_AN_ARRAY,parameters:[value]}];for(const[index,item]of value.entries())if(index<editorInfo.items.length){const underlyingErrors=Editor.checkForErrors(editorInfo.items[index],item,returnEarly);if(underlyingErrors.length>0&&(errors.push({error:Editor.Error.ARRAY_CONTAINS_INVALID_VALUE,parameters:[value,index],underlying:underlyingErrors}),returnEarly))return errors}else if(editorInfo.additionalItems.allowed){if(editorInfo.additionalItems.editorInfo){const underlyingErrors=Editor.checkForErrors(editorInfo.additionalItems.editorInfo,item,returnEarly);if(underlyingErrors.length>0&&(errors.push({error:Editor.Error.OBJECT_CONTAINS_INVALID_VALUE,parameters:[value,index],underlying:underlyingErrors}),returnEarly))return errors}}else if(errors.push({error:Editor.Error.ARRAY_HAS_TOO_MANY_ITEMS,parameters:[value,editorInfo.items.length,value.length]}),returnEarly)return errors;return errors}__processEditorInfo(){this.__popup?.setEditorInfo(this.__editorInfo),this.__textSpan.textContent=this.__editorInfo.name,this.__container.classList.toggle("invalid",!this.getState().isValid)}setValue(value){this.__value=value??[],this.__popup?.setValue(value);const state=this.getState();this.__container.classList.toggle("invalid",!state.isValid),this.__onChangeManager.trigger(this,state)}getRawValue(){return this.__value}async openPopup(){this.__popup||(this.__popup=new TupleEditorPrompt(this.__editorInfo,this.__factory),this.__popup.setBackgroundAction({close:!0,action:"cancel"}),this.__popup.setIsReadOnly(this.__isReadOnly),this.__popup.setSettings(this.__settings),this.__popup.setLocalizations({buttonTextOk:this.__localizations?.tupleEditorPrompt?.buttonTextOk??this.__localizations?.editorPrompt?.buttonTextOk,buttonTooltipOk:this.__localizations?.tupleEditorPrompt?.buttonTooltipOk??this.__localizations?.editorPrompt?.buttonTooltipOk,buttonTextCancel:this.__localizations?.tupleEditorPrompt?.buttonTextCancel??this.__localizations?.editorPrompt?.buttonTextCancel,buttonTooltipCancel:this.__localizations?.tupleEditorPrompt?.buttonTooltipCancel??this.__localizations?.editorPrompt?.buttonTooltipCancel,editorLocalizations:this.__localizations}));try{this.__popup.setValue(this.__value);const result=await this.__popup.prompt();if(result.isOk){this.__value=result.value;const state=this.getState();this.__container.classList.toggle("invalid",!state.isValid),this.__onChangeManager.trigger(this,state),state.isValid&&this.__onConfirmManager.trigger(this,state)}}catch(ex){}}setLocalizations(texts){super.setLocalizations(texts),this.__popup?.setLocalizations({buttonTextOk:this.__localizations?.tupleEditorPrompt?.buttonTextOk??this.__localizations?.editorPrompt?.buttonTextOk,buttonTooltipOk:this.__localizations?.tupleEditorPrompt?.buttonTooltipOk??this.__localizations?.editorPrompt?.buttonTooltipOk,buttonTextCancel:this.__localizations?.tupleEditorPrompt?.buttonTextCancel??this.__localizations?.editorPrompt?.buttonTextCancel,buttonTooltipCancel:this.__localizations?.tupleEditorPrompt?.buttonTooltipCancel??this.__localizations?.editorPrompt?.buttonTooltipCancel,editorLocalizations:this.__localizations})}}TcHmi.Controls.Helpers??={},TcHmi.Controls.Helpers.TupleEditor=TupleEditor;