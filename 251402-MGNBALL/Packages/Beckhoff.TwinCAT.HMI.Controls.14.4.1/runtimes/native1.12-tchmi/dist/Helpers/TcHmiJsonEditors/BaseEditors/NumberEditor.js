import{Editor}from"./Editor.js";import{TextboxBasedEditor}from"./TextboxBasedEditor.js";export class NumberEditor extends TextboxBasedEditor{constructor(element,editorInfo,factory){super(element,editorInfo,factory),this.__textbox.setTextHorizontalAlignment("Right"),this.__textbox.setSystemKeyboardInputMode(editorInfo.restrictions.every(restriction=>restriction.isInteger)?"numeric":"decimal")}static validate(editorInfo,value){return 0===NumberEditor.checkForErrors(editorInfo,value,!0).length}static checkForErrors(editorInfo,value,returnEarly=!1){if("string"==typeof value)return value&&editorInfo.specialValues.has(value)&&editorInfo.restrictions.some(restriction=>!restriction.isInteger)?[]:[{error:Editor.Error.NOT_A_NUMBER,parameters:[value]}];if("number"!=typeof value)return[{error:Editor.Error.NOT_A_NUMBER,parameters:[value]}];if(!Number.isFinite(value)){const text=value.toString();return editorInfo.specialValues.has(text)&&editorInfo.restrictions.some(restriction=>!restriction.isInteger)?[]:[{error:Editor.Error.NUMBER_NOT_FINITE,parameters:[value]}]}if(0===editorInfo.restrictions.length)return[];const restrictionErrors=[];for(const restriction of editorInfo.restrictions){const errors=[];if(restrictionErrors.push(errors),(!restriction.isInteger||Number.isInteger(value)||(errors.push({error:Editor.Error.NUMBER_NOT_INTEGER,parameters:[value]}),!returnEarly))&&(!restriction.minimum||this.__testMinimum(value,restriction.minimum)||(errors.push({error:Editor.Error.NUMBER_TOO_SMALL,parameters:[value,restriction.minimum.value,restriction.minimum.exclusive?">":">="]}),!returnEarly))&&(!restriction.maximum||this.__testMaximum(value,restriction.maximum)||(errors.push({error:Editor.Error.NUMBER_TOO_BIG,parameters:[value,restriction.maximum.value,restriction.maximum.exclusive?"<":"<="]}),!returnEarly))&&(void 0===restriction.multipleOf||value%restriction.multipleOf===0||(errors.push({error:Editor.Error.NUMBER_NOT_MULTIPLE_OF,parameters:[value,restriction.multipleOf]}),!returnEarly))&&0===errors.length)return[]}return 1===restrictionErrors.length?restrictionErrors[0]:[{error:Editor.Error.FAILS_ALL_RESTRICTIONS,parameters:[value],underlying:restrictionErrors.map(errors=>({error:Editor.Error.FAILS_THIS_RESTRICTION,underlying:errors}))}]}getState(){const value=this.getRawValue(),errors=NumberEditor.checkForErrors(this.__editorInfo,value);return 0===errors.length?{isValid:!0,value}:{isValid:!1,errors}}__processEditorInfo(){this.__updateValidationStatus()}static __testMinimum(value,minimum){return minimum.exclusive?value>minimum.value:value>=minimum.value}static __testMaximum(value,maximum){return maximum.exclusive?value<maximum.value:value<=maximum.value}setValue(value){"number"==typeof value?this.__textbox.setText(value.toString(10)):this.__textbox.setText(value)}getRawValue(){const text=this.__textbox.getText()??"";return/^[+-]?\d*\.?\d+(?:[eE][+-]?\d+)?$/.test(text)?parseFloat(text):text}}TcHmi.Controls.Helpers??={},TcHmi.Controls.Helpers.NumberEditor=NumberEditor;