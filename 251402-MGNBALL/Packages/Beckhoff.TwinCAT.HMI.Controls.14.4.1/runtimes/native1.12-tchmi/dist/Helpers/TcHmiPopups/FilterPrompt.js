var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{Control as TcHmiCombobox}from"../../TcHmiCombobox/TcHmiCombobox.esm.js";import{Popup}from"./Popup.js";let FilterPrompt=(()=>{var _a,_b,_c,_d,_e,_f,_g,_h;let ___onScroll_decorators,___onLocaleChanged_decorators,___onOkPressed_decorators,___onCancelPressed_decorators,___reset_decorators,___add_decorators,___remove_decorators,___group_decorators,_classSuper=Popup,_instanceExtraInitializers=[];return class extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onScroll_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],___onLocaleChanged_decorators=[(_b=TcHmi).CallbackMethod.bind(_b)],___onOkPressed_decorators=[(_c=TcHmi).CallbackMethod.bind(_c)],___onCancelPressed_decorators=[(_d=TcHmi).CallbackMethod.bind(_d)],___reset_decorators=[(_e=TcHmi).CallbackMethod.bind(_e)],___add_decorators=[(_f=TcHmi).CallbackMethod.bind(_f)],___remove_decorators=[(_g=TcHmi).CallbackMethod.bind(_g)],___group_decorators=[(_h=TcHmi).CallbackMethod.bind(_h)],__esDecorate(this,null,___onScroll_decorators,{kind:"method",name:"__onScroll",static:!1,private:!1,access:{has:obj=>"__onScroll"in obj,get:obj=>obj.__onScroll},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onLocaleChanged_decorators,{kind:"method",name:"__onLocaleChanged",static:!1,private:!1,access:{has:obj=>"__onLocaleChanged"in obj,get:obj=>obj.__onLocaleChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onOkPressed_decorators,{kind:"method",name:"__onOkPressed",static:!1,private:!1,access:{has:obj=>"__onOkPressed"in obj,get:obj=>obj.__onOkPressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onCancelPressed_decorators,{kind:"method",name:"__onCancelPressed",static:!1,private:!1,access:{has:obj=>"__onCancelPressed"in obj,get:obj=>obj.__onCancelPressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___reset_decorators,{kind:"method",name:"__reset",static:!1,private:!1,access:{has:obj=>"__reset"in obj,get:obj=>obj.__reset},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___add_decorators,{kind:"method",name:"__add",static:!1,private:!1,access:{has:obj=>"__add"in obj,get:obj=>obj.__add},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___remove_decorators,{kind:"method",name:"__remove",static:!1,private:!1,access:{has:obj=>"__remove"in obj,get:obj=>obj.__remove},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___group_decorators,{kind:"method",name:"__group",static:!1,private:!1,access:{has:obj=>"__group"in obj,get:obj=>obj.__group},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}__okButton=__runInitializers(this,_instanceExtraInitializers);__cancelButton;__resetButton;__removeButton;__groupButton;__ungroupButton;__elementMenuBar;__elementFilterTableHeader;__elementIndentationHeader;__elementFilterTable;__elementFilterTableBody;__filter=[];__currentFilter=[];__originalFilter=[];__schemaInfo;__localizableEnums=[];__domainPaths=new Map;__rows=[];__selectedRows=[];__updateRequired=!0;__groupInfo=null;__ungroupInfo=null;__onScroll(_event){this.__elementFilterTableHeader.scrollLeft=this.__elementFilterTable.scrollLeft}__onLocaleChangedDestroyer=null;__onLocaleChanged(){this.__localizeEnumLabels()}__localizeRequestId=null;__localization;__localizedElements=new Map;__localizationReader=void 0;__listDomainsSubscriptionId=null;__backgroundAction={close:!0,action:"cancel"};__closeButton={show:!1};constructor(schema,originalFilter,parentControl){super(parentControl),this.__originalFilter=originalFilter,this.__element.classList.add("TcHmi_Controls_Helpers_FilterPrompt-popup"),this.__elementHeader.setAttribute("data-tchmi-localized-content-key","Popup_FilterPrompt_Header_Text_Filter"),this.__elementMenuBar=document.createElement("div"),this.__elementMenuBar.classList.add("TcHmi_Controls_Helpers_FilterPrompt-menubar"),this.__elementContent.appendChild(this.__elementMenuBar),this.__elementFilterTableHeader=document.createElement("table"),this.__elementFilterTableHeader.classList.add("TcHmi_Controls_Helpers_FilterPrompt-table-header"),this.__elementContent.appendChild(this.__elementFilterTableHeader);let thead=document.createElement("thead");this.__elementFilterTableHeader.appendChild(thead);let tr=document.createElement("tr");thead.appendChild(tr);let selectColumn=document.createElement("th");selectColumn.classList.add("TcHmi_Controls_Helpers_FilterPrompt-selection-column"),tr.appendChild(selectColumn),this.__elementIndentationHeader=document.createElement("th"),this.__elementIndentationHeader.classList.add("TcHmi_Controls_Helpers_FilterPrompt-indentation-column"),tr.appendChild(this.__elementIndentationHeader);let logicColumn=document.createElement("th");logicColumn.classList.add("TcHmi_Controls_Helpers_FilterPrompt-logic-column"),logicColumn.setAttribute("data-tchmi-localized-content-key","Popup_FilterPrompt_Column_Header_Filter_Logic"),tr.appendChild(logicColumn);let pathColumn=document.createElement("th");pathColumn.classList.add("TcHmi_Controls_Helpers_FilterPrompt-path-column"),pathColumn.setAttribute("data-tchmi-localized-content-key","Popup_FilterPrompt_Column_Header_Filter_Path"),tr.appendChild(pathColumn);let comparatorColumn=document.createElement("th");comparatorColumn.classList.add("TcHmi_Controls_Helpers_FilterPrompt-comparator-column"),comparatorColumn.setAttribute("data-tchmi-localized-content-key","Popup_FilterPrompt_Column_Header_Filter_Operator"),tr.appendChild(comparatorColumn);let valueColumn=document.createElement("th");valueColumn.classList.add("TcHmi_Controls_Helpers_FilterPrompt-value-column"),valueColumn.setAttribute("data-tchmi-localized-content-key","Popup_FilterPrompt_Column_Header_Filter_Value"),tr.appendChild(valueColumn);let scrollPlaceholder=document.createElement("th");scrollPlaceholder.classList.add("TcHmi_Controls_Helpers_FilterPrompt-scroll-placeholder"),tr.appendChild(scrollPlaceholder),this.__elementFilterTable=document.createElement("table"),this.__elementFilterTable.classList.add("TcHmi_Controls_Helpers_FilterPrompt-table"),this.__elementContent.appendChild(this.__elementFilterTable),this.__elementFilterTableBody=document.createElement("tbody"),this.__elementFilterTable.appendChild(this.__elementFilterTableBody);const resetButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.resetButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-text":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Text_Reset_Config%/l%","data-tchmi-tooltip":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Tooltip_Reset_Config%/l%","data-tchmi-is-enabled":!1},this.__parentControl),okButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.okButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-is-enabled":!0,"data-tchmi-ignore-escape-sequences":!0,"data-tchmi-text":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Text_Ok%/l%","data-tchmi-tooltip":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Tooltip_Ok%/l%"},this.__parentControl),cancelButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.cancelButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-ignore-escape-sequences":!0,"data-tchmi-text":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Text_Cancel%/l%","data-tchmi-tooltip":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Tooltip_Cancel%/l%"},this.__parentControl),addButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.addButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Tooltip_Filter_Add%/l%"},this.__parentControl),removeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.removeButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Tooltip_Filter_Remove%/l%"},this.__parentControl),groupButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.groupButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Tooltip_Filter_Group%/l%"},this.__parentControl),ungroupButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.ungroupButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Tooltip_Filter_Ungroup%/l%"},this.__parentControl);if(!(resetButton&&okButton&&cancelButton&&addButton&&removeButton&&groupButton&&ungroupButton))throw new Error("Could not create controls for FilterPrompt.");const resetButtonElement=resetButton.getElement()[0];resetButtonElement.classList.add("align-left"),this.__elementFooter.appendChild(resetButtonElement),this.__elementFooter.appendChild(okButton.getElement()[0]),this.__elementFooter.appendChild(cancelButton.getElement()[0]);const addButtonElement=addButton.getElement()[0];addButtonElement.classList.add("TcHmi_Controls_Helpers_FilterPrompt-add-button"),this.__elementMenuBar.appendChild(addButtonElement);const removeButtonElement=removeButton.getElement()[0];removeButtonElement.classList.add("TcHmi_Controls_Helpers_FilterPrompt-remove-button"),this.__elementMenuBar.appendChild(removeButtonElement);const groupButtonElement=groupButton.getElement()[0];groupButtonElement.classList.add("TcHmi_Controls_Helpers_FilterPrompt-group-button"),this.__elementMenuBar.appendChild(groupButtonElement);const ungroupButtonElement=ungroupButton.getElement()[0];ungroupButtonElement.classList.add("TcHmi_Controls_Helpers_FilterPrompt-ungroup-button"),this.__elementMenuBar.appendChild(ungroupButtonElement),this.__destroyers.push(TcHmi.EventProvider.register(okButton.getId()+".onPressed",this.__onOkPressed),TcHmi.EventProvider.register(cancelButton.getId()+".onPressed",this.__onCancelPressed),TcHmi.EventProvider.register(resetButton.getId()+".onPressed",this.__reset),TcHmi.EventProvider.register(addButton.getId()+".onPressed",this.__add),TcHmi.EventProvider.register(removeButton.getId()+".onPressed",this.__remove),TcHmi.EventProvider.register(groupButton.getId()+".onPressed",this.__group),TcHmi.EventProvider.register(ungroupButton.getId()+".onPressed",()=>{this.__ungroupInfo&&this.__ungroup(this.__ungroupInfo,this.__selectedRows)})),this.__okButton=okButton,this.__cancelButton=cancelButton,this.__resetButton=resetButton,this.__removeButton=removeButton,this.__groupButton=groupButton,this.__ungroupButton=ungroupButton,this.__childControls.push(okButton,cancelButton);let parsedSchema=this.__parseSchema(schema);this.__schemaInfo=parsedSchema.schemaInfo,this.__localizableEnums=parsedSchema.localizationInfo;for(const path of parsedSchema.domainPaths){let info=this.__schemaInfo.availablePaths.get(path);info&&this.__domainPaths.set(path,info)}this.__localizeEnumLabels(),this.__subscribeListDomains();let localizedElements=this.__element.querySelectorAll("[data-tchmi-localized-content-key]");for(let i=0,ii=localizedElements.length;i<ii;i++){let element=localizedElements[i],localizeKey=element.dataset.tchmiLocalizedContentKey;localizeKey&&this.__localizedElements.set(element,{key:localizeKey})}this.__localization=new TcHmi.Locale.PackageLocalization("Beckhoff.TwinCAT.HMI.Controls"),this.__destroyers.push(this.__localization.watch(data=>{if(data.error===TcHmi.Errors.NONE&&data.reader){this.__localizationReader=data.reader;for(const[element,info]of this.__localizedElements){let localizedText=data.reader.get(info.key);info.parameters&&(localizedText=tchmi_format_string(localizedText,...info.parameters)),element.textContent=tchmi_decode_control_characters(localizedText)}}})),this.__onLocaleChangedDestroyer=TcHmi.EventProvider.register("onLocaleChanged",this.__onLocaleChanged)}destroy(force=!1){super.destroy(force),this.__elementFilterTable.removeEventListener("scroll",this.__onScroll),this.__onLocaleChangedDestroyer&&(this.__onLocaleChangedDestroyer(),this.__onLocaleChangedDestroyer=null),null!==this.__localizeRequestId&&(TcHmi.Server.releaseRequest(this.__localizeRequestId),this.__localizeRequestId=null),null!==this.__listDomainsSubscriptionId&&(TcHmi.Server.unsubscribe(this.__listDomainsSubscriptionId),this.__listDomainsSubscriptionId=null),this.__clear()}abort(action){super.abort(action)}__onOkPressed(){if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}this.__ok()}__onCancelPressed(){if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}this.__cancel()}__ok(){this.__prompt?.answer(this.__filter)}__cancel(){this.__prompt?.answer(this.__currentFilter)}__reset(){this.__clear(),this.__filter=this.__originalFilter,this.__resetButton.setIsEnabled(!1),this.__update()}getOriginalFilter(){return tchmi_clone_object(this.__originalFilter)}setBackgroundAction(action){super.setBackgroundAction(action)}setCloseButton(buttonOrShow){super.setCloseButton(buttonOrShow)}__performPromptAction(toPerform){if(toPerform.action)switch(toPerform.action){case"ok":this.__ok();break;case"cancel":this.__cancel()}}update(filter,_resetable){this.__currentFilter=tchmi_clone_object(filter),this.__filter=tchmi_clone_object(filter),this.__resetButton.setIsEnabled(!tchmi_equal(this.__originalFilter,this.__filter)),this.__update()}__update(){this.__selectedRows=[];let fragment=document.createDocumentFragment(),indentation=[],maxIndentDepth=0,nesting={filter:this.__filter,parent:null},createRows=(filter,logic,endsPreviousIndentations=0)=>{for(let i=0,ii=filter.length;i<ii;i++){const item=filter[i],isLast=i===ii-1;if(TcHmi.isLogicOperator(item))logic=item;else if(Array.isArray(item)){indentation.push({opens:!0,closes:1===item.length}),maxIndentDepth=Math.max(maxIndentDepth,indentation.length),nesting={filter:item,parent:nesting},isLast?createRows(item,logic,endsPreviousIndentations+1):createRows(item,logic),nesting.parent&&(nesting=nesting.parent)}else if(TcHmi.isComparison(item)){const indentationsToEnd=Math.min(endsPreviousIndentations+1,indentation.length);if(isLast)for(let j=1;j<=indentationsToEnd;j++)indentation[indentation.length-j].closes=!0;if(fragment.appendChild(this.__createRow(indentation,nesting,item,logic)),isLast)indentation=indentation.slice(0,-indentationsToEnd);else for(let j=0,jj=indentation.length;j<jj;j++)indentation[j].opens=!1}}};createRows(this.__filter),this.__elementFilterTableBody.innerHTML="",this.__elementFilterTableBody.appendChild(fragment),this.__elementIndentationHeader.style.minWidth=maxIndentDepth?6*maxIndentDepth+5+"px":"1px",this.__processSelection()}show(){super.show(),this.__subscribeListDomains()}hide(){super.hide(),this.__updateRequired&&this.__clear(),null!==this.__listDomainsSubscriptionId&&(TcHmi.Server.unsubscribe(this.__listDomainsSubscriptionId),this.__listDomainsSubscriptionId=null)}__clear(){this.__elementFilterTableBody.innerHTML="";for(let i=0,ii=this.__rows.length;i<ii;i++){let row=this.__rows[i];row.selection.destroyer(),row.selection.control.destroy(),row.logic&&(row.logic.destroyer(),row.logic.control.destroy()),row.path.destroyer&&row.path.destroyer(),row.path.control&&row.path.control.destroy(),row.comparator.destroyer&&row.comparator.destroyer(),row.comparator.control&&row.comparator.control.destroy(),row.value.destroyer&&row.value.destroyer(),row.value.control&&row.value.control.destroy()}this.__rows=[]}__createRow(indentation,parent,comparison,logic){let row=document.createElement("tr"),selectionCell=document.createElement("td");selectionCell.classList.add("TcHmi_Controls_Helpers_FilterPrompt-selection-column");let selectionCheckbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__newControlId(),null,this.__parentControl);if(!selectionCheckbox)throw new Error("Could not create controls for FilterPopup.");let parentClone=this.__cloneNesting(parent),selectionCheckboxEventDestroyer=TcHmi.EventProvider.register(selectionCheckbox.getId()+".onStateChanged",(_event,data)=>{let selection={rowElement:row,comparison,parent:parentClone};data.state?this.__selectRow(selection):this.__deselectRow(selection)});selectionCell.appendChild(selectionCheckbox.getElement()[0]);let indentationCell=document.createElement("td");indentationCell.classList.add("TcHmi_Controls_Helpers_FilterPrompt-indentation-column");for(let i=0,ii=indentation.length;i<ii;i++){let indentationMarker=document.createElement("div");indentationMarker.classList.add("TcHmi_Controls_Helpers_FilterPrompt-indentation-marker"),indentationMarker.classList.toggle("first",indentation[i].opens),indentationMarker.classList.toggle("last",indentation[i].closes),indentationMarker.classList.toggle("middle",!indentation[i].opens&&!indentation[i].closes),indentationCell.appendChild(indentationMarker)}let logicCell=document.createElement("td");logicCell.classList.add("TcHmi_Controls_Helpers_FilterPrompt-logic-column");let pathCell=document.createElement("td");pathCell.classList.add("TcHmi_Controls_Helpers_FilterPrompt-path-column");let comparatorCell=document.createElement("td");comparatorCell.classList.add("TcHmi_Controls_Helpers_FilterPrompt-comparator-column");let valueCell=document.createElement("td");valueCell.classList.add("TcHmi_Controls_Helpers_FilterPrompt-value-column");let rowData={row,comparison,parent:parentClone,selection:{control:selectionCheckbox,destroyer:selectionCheckboxEventDestroyer},path:{control:null,destroyer:null},comparator:{cell:comparatorCell,control:null,destroyer:null},value:{cell:valueCell,control:null,destroyer:null}};if(logic){const constlogic=logic;rowData.logicOperator=logic;let logicLocalizationMap={AND:"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_And%/l%",OR:"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_Or%/l%"},logicCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__newControlId(),{"data-tchmi-src-data":this.__schemaInfo.availableLogic.map(value=>({value,text:logicLocalizationMap[value]??value})),"data-tchmi-selected-index":this.__schemaInfo.availableLogic.indexOf(logic.logic),"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl);if(!logicCombobox)throw new Error("Could not create controls for FilterPopup.");rowData.logic={control:logicCombobox,destroyer:TcHmi.EventProvider.register(logicCombobox.getId()+".onSelectionChanged",(_event,data)=>{constlogic.logic=data.value})},logicCell.appendChild(logicCombobox.getElement()[0])}let availablePathNames=Array.from(this.__schemaInfo.availablePaths.keys());if(availablePathNames.length>0){let pathCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__newControlId(),{"data-tchmi-src-data":availablePathNames,"data-tchmi-allow-text-input":null!==this.__schemaInfo.freePath,"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-max-list-height":500},this.__parentControl);if(!pathCombobox)throw new Error("Could not create controls for FilterPopup.");rowData.path.control=pathCombobox;let selectedIndex=availablePathNames.indexOf(comparison.path||"");availablePathNames.includes(comparison.path||"")?pathCombobox.setSelectedIndex(selectedIndex):pathCombobox.setText(comparison.path),rowData.path.destroyer=TcHmi.EventProvider.register(pathCombobox.getId()+".onUserInteractionFinished",()=>{let path=pathCombobox.getText();comparison.path!==path&&(null==path||""===path?delete comparison.path:comparison.path=path,comparison.value="",this.__updateControls(rowData))}),pathCell.appendChild(pathCombobox.getElement()[0])}else{let pathTextbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",this.__newControlId(),{"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl);if(!pathTextbox)throw new Error("Could not create controls for FilterPopup.");rowData.path.control=pathTextbox,rowData.path.destroyer=TcHmi.EventProvider.register(pathTextbox.getId()+".onUserInteractionFinished",()=>{let path=pathTextbox.getText();null==path||""===path?delete comparison.path:comparison.path=path}),pathCell.appendChild(pathTextbox.getElement()[0])}return this.__updateControls(rowData),row.appendChild(selectionCell),row.appendChild(indentationCell),row.appendChild(logicCell),row.appendChild(pathCell),row.appendChild(comparatorCell),row.appendChild(valueCell),this.__rows.push(rowData),row}__updateControls(row){let pathInfo=this.__getPathInfo(row.comparison.path);if(row.path.control instanceof TcHmiCombobox&&(pathInfo?.isSuggestion?(row.path.control.setAllowTextInput(!0),row.path.control.focus()):row.path.control.setAllowTextInput(!1)),!row.comparator.control){if(row.comparator.control=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__newControlId(),{"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-max-list-height":250},this.__parentControl)||null,!row.comparator.control)throw new Error("Could not create controls for FilterPopup.");row.comparator.destroyer=TcHmi.EventProvider.register(row.comparator.control.getId()+".onUserInteractionFinished",()=>{let comparator=row.comparator.control.getAllowTextInput()?row.comparator.control.getText():row.comparator.control.getSelectedValue();"string"==typeof comparator&&""!==comparator&&(row.comparison.comparator=comparator)}),row.comparator.cell.appendChild(row.comparator.control.getElement()[0])}let comparatorControl=row.comparator.control;if(pathInfo){let comparatorLocalizationMap={contains:"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_Contains%/l%","contains not":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_ContainsNot%/l%","== [ignore case]":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_EqualsIgnoreCase%/l%","!= [ignore case]":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_EqualsNotIgnoreCase%/l%","contains [ignore case]":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_ContainsIgnoreCase%/l%","contains not [ignore case]":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_ContainsNotIgnoreCase%/l%"};comparatorControl.setAllowTextInput(!1),comparatorControl.setSrcData(pathInfo.comparators.map(comparator=>({value:comparator,text:comparatorLocalizationMap[comparator]??comparator}))),comparatorControl.setSelectedIndex(pathInfo.comparators.indexOf(row.comparison.comparator))}else comparatorControl.setAllowTextInput(!0);let valueControlType="TcHmi.Controls.Beckhoff.TcHmiTextbox";pathInfo&&pathInfo.values.length>0&&(valueControlType="TcHmi.Controls.Beckhoff.TcHmiCombobox"),pathInfo&&pathInfo.valueIsDate&&(valueControlType="TcHmi.Controls.Beckhoff.TcHmiDateTimeInput"),row.value.control&&row.value.control.getType()!==valueControlType&&(row.value.destroyer&&(row.value.destroyer(),row.value.destroyer=null),row.value.cell.removeChild(row.value.control.getElement()[0]),row.value.control.destroy(),row.value.control=null);let eventRegistrationNeeded=!1;if(!row.value.control){if(row.value.control=TcHmi.ControlFactory.createEx(valueControlType,this.__newControlId(),"TcHmi.Controls.Beckhoff.TcHmiCombobox"===valueControlType?{"data-tchmi-max-list-height":250}:{"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl)||null,!row.value.control)throw new Error("Could not create controls for FilterPopup.");eventRegistrationNeeded=!0,row.value.cell.appendChild(row.value.control.getElement()[0])}switch(valueControlType){case"TcHmi.Controls.Beckhoff.TcHmiTextbox":let text,textbox=row.value.control;text=row.comparison.value instanceof Date?row.comparison.value.toISOString():null===row.comparison.value?"null":row.comparison.value.toString(),textbox.setText(text),eventRegistrationNeeded&&(row.value.destroyer=TcHmi.EventProvider.register(textbox.getId()+".onUserInteractionFinished",()=>{let value=textbox.getText();if(null==value)return;let pathInfo=this.__getPathInfo(row.comparison.path);if(pathInfo?.nullable&&"null"===value.toLowerCase())row.comparison.value=null;else{switch(pathInfo?pathInfo.valueType:"any"){case"string":row.comparison.value=TcHmi.ValueConverter.toString(value,"");break;case"number":case"integer":row.comparison.value=TcHmi.ValueConverter.toNumber(value,0);break;case"boolean":row.comparison.value=TcHmi.ValueConverter.toBoolean(value,!1);break;default:row.comparison.value=value}}}));break;case"TcHmi.Controls.Beckhoff.TcHmiCombobox":let combobox=row.value.control;if(!pathInfo)break;let srcData=[];for(let i=0,ii=pathInfo.values.length;i<ii;i++){let value=pathInfo.values[i];srcData.push({value,text:pathInfo.localizedLabels.get(value)??pathInfo.labels.get(value)??value})}if(combobox.setSrcData(srcData),combobox.setAllowTextInput(pathInfo.allowFreeValue),combobox.setSelectedIndex(pathInfo.values.indexOf(row.comparison.value)),pathInfo.allowFreeValue&&!pathInfo.values.includes(row.comparison.value)){let text;text=row.comparison.value instanceof Date?row.comparison.value.toISOString():null===row.comparison.value?"null":row.comparison.value.toString(),combobox.setText(text)}eventRegistrationNeeded&&(row.value.destroyer=TcHmi.EventProvider.register(combobox.getId()+".onUserInteractionFinished",()=>{let value=combobox.getSelectedValue(),pathInfo=this.__getPathInfo(row.comparison.path);if(null==value&&pathInfo.allowFreeValue&&(value=combobox.getText()),null!=value)if(pathInfo?.nullable&&"null"===value.toLowerCase())row.comparison.value=null;else{switch(pathInfo?pathInfo.valueType:"any"){case"string":row.comparison.value=TcHmi.ValueConverter.toString(value,"");break;case"number":case"integer":row.comparison.value=TcHmi.ValueConverter.toNumber(value,0);break;case"boolean":row.comparison.value=TcHmi.ValueConverter.toBoolean(value,!1);break;default:row.comparison.value=value}}}));break;case"TcHmi.Controls.Beckhoff.TcHmiDateTimeInput":let value,dateTimeInput=row.value.control;value=row.comparison.value instanceof Date?row.comparison.value.toISOString():null===row.comparison.value?"null":row.comparison.value.toString(),dateTimeInput.setValue(value),eventRegistrationNeeded&&(row.value.destroyer=TcHmi.EventProvider.register(dateTimeInput.getId()+".onUserInteractionFinished",()=>{let value=dateTimeInput.getValue();if(null==value)return;let pathInfo=this.__getPathInfo(row.comparison.path);pathInfo?.nullable&&"null"===value.toLowerCase()?row.comparison.value=null:row.comparison.value=value}))}}__getPathInfo(path=""){let pathInfo=this.__schemaInfo.availablePaths.get(path);if(!pathInfo)for(const[key,value]of this.__schemaInfo.availablePaths)if(value.isSuggestion&&path.startsWith(key)){pathInfo=value;break}return!pathInfo&&this.__schemaInfo.freePath&&(pathInfo=this.__schemaInfo.freePath),pathInfo??null}__selectRow(row){this.__selectedRows.push(row),this.__processSelection()}__deselectRow(row){for(let i=0,ii=this.__selectedRows.length;i<ii;i++)if(this.__selectedRows[i].comparison===row.comparison){this.__selectedRows.splice(i,1);break}this.__processSelection()}__add(){let[path,pathInfo]=this.__schemaInfo.freePath?["",this.__schemaInfo.freePath]:this.__schemaInfo.availablePaths.entries().next().value,logic={logic:this.__schemaInfo.availableLogic[0]},comparison={path,comparator:pathInfo.comparators[0],value:pathInfo.allowFreeValue?"":pathInfo.values[0]};if(this.__selectedRows.length>0){this.__selectedRows.sort((a,b)=>b.rowElement.rowIndex-a.rowElement.rowIndex);let lastRow=this.__selectedRows[0];lastRow.parent.filter.splice(lastRow.parent.filter.indexOf(lastRow.comparison)+1,0,logic,comparison);let indentation=[],indentationElements=lastRow.rowElement.getElementsByClassName("TcHmi_Controls_Helpers_FilterPrompt-indentation-marker");for(let i=0,ii=indentationElements.length;i<ii;i++)indentationElements[i].classList.contains("last")?(indentationElements[i].classList.remove("last"),indentationElements[i].classList.add("middle"),indentation.push({opens:!1,closes:!0})):indentation.push({opens:!1,closes:!1});lastRow.rowElement.insertAdjacentElement("afterend",this.__createRow(indentation,lastRow.parent,comparison,logic))}else this.__elementFilterTableBody.appendChild(this.__createRow([],{filter:this.__filter,parent:null},comparison,this.__filter.length>0?logic:void 0)),this.__filter.length>0&&this.__filter.push(logic),this.__filter.push(comparison);this.__processSelection()}__remove(){for(const selectedRow of this.__selectedRows){let index=selectedRow.parent.filter.indexOf(selectedRow.comparison);if(-1===index)continue;let indentationElements=selectedRow.rowElement.getElementsByClassName("TcHmi_Controls_Helpers_FilterPrompt-indentation-marker"),siblingIndentation=null;for(let i=0,ii=indentationElements.length;i<ii;i++){const containsFirst=indentationElements[i].classList.contains("first"),containsLast=indentationElements[i].classList.contains("last");if(containsFirst&&!containsLast){if(!siblingIndentation){const siblingRow=selectedRow.rowElement.nextElementSibling;if(!siblingRow)break;siblingIndentation=siblingRow.getElementsByClassName("TcHmi_Controls_Helpers_FilterPrompt-indentation-marker")}siblingIndentation[i].classList.remove("middle"),siblingIndentation[i].classList.add("first")}else if(containsLast&&!containsFirst){if(!siblingIndentation){const siblingRow=selectedRow.rowElement.previousElementSibling;if(!siblingRow)break;siblingIndentation=siblingRow.getElementsByClassName("TcHmi_Controls_Helpers_FilterPrompt-indentation-marker")}siblingIndentation[i].classList.remove("middle"),siblingIndentation[i].classList.add("last")}}const rowDataIndex=this.__rows.findIndex(rowData=>rowData.row===selectedRow.rowElement);if(-1!==rowDataIndex){const rowData=this.__rows[rowDataIndex];rowData.selection.destroyer(),rowData.selection.control.destroy(),rowData.logic&&(rowData.logic.destroyer(),rowData.logic.control.destroy()),rowData.path.destroyer&&rowData.path.destroyer(),rowData.path.control&&rowData.path.control.destroy(),rowData.comparator.destroyer&&rowData.comparator.destroyer(),rowData.comparator.control&&rowData.comparator.control.destroy(),rowData.value.destroyer&&rowData.value.destroyer(),rowData.value.control&&rowData.value.control.destroy(),this.__rows.splice(rowDataIndex,1)}if(this.__elementFilterTableBody.removeChild(selectedRow.rowElement),selectedRow.parent.filter.splice(index,1),index>0)selectedRow.parent.filter.splice(index-1,1);else{let parent=selectedRow.parent,parentIndex=0;for(;parent.parent&&0!==parentIndex;){if(parentIndex=parent.parent.filter.indexOf(parent.filter),-1===parentIndex)throw new Error("Filter in invalid state. Parent filter does not contain child filter.");parent=parent.parent}if(0===parentIndex){selectedRow.parent.filter.length>0&&selectedRow.parent.filter.splice(0,1);let firstRow=this.__elementFilterTableBody.firstElementChild;if(firstRow){for(let j=0,jj=this.__rows.length;j<jj;j++)if(this.__rows[j].row===selectedRow.rowElement){this.__rows[j].logic&&(this.__rows[j].logic.destroyer(),this.__rows[j].logic.control.destroy(),delete this.__rows[j].logic);break}let comboboxElement=firstRow.querySelector(".TcHmi_Controls_Helpers_FilterPrompt-logic-column .TcHmi_Controls_Beckhoff_TcHmiCombobox");comboboxElement&&comboboxElement.remove()}}else parent.filter.splice(parentIndex-1,1,selectedRow.parent.filter.splice(0,1)[0])}if(1===selectedRow.parent.filter.length&&selectedRow.parent.parent){let ungroupRows=[];for(let j=0,jj=this.__rows.length;j<jj;j++){let parent=this.__rows[j].parent;for(;parent&&parent.filter!==selectedRow.parent.filter;)parent=parent.parent;parent&&ungroupRows.push({rowElement:this.__rows[j].row,comparison:this.__rows[j].comparison,parent:this.__rows[j].parent})}ungroupRows.length>0&&this.__ungroup({parent:selectedRow.parent.parent,toUngroup:selectedRow.parent},ungroupRows)}}this.__selectedRows=[],this.__processSelection()}__group(){if(!this.__groupInfo)return;let start=this.__groupInfo.parent.filter.length,end=-1;for(let i=0,ii=this.__groupInfo.toGroup.length;i<ii;i++){let index=this.__groupInfo.parent.filter.indexOf(this.__groupInfo.toGroup[i]);if(-1===index)return;start=index<start?index:start,end=index>end?index:end}let newNested=this.__groupInfo.parent.filter.splice(start,end-start+1);this.__groupInfo.parent.filter.splice(start,0,newNested),this.__selectedRows.sort((a,b)=>a.rowElement.rowIndex-b.rowElement.rowIndex);let newParent={filter:this.__groupInfo.parent.filter,parent:this.__groupInfo.parent.parent},groupInfoParentFilter=this.__groupInfo.parent.filter;for(let i=0,ii=this.__selectedRows.length;i<ii;i++){let parentToModify=this.__selectedRows[i].parent,indentationMarkerPosition=0;for(;parentToModify.parent&&parentToModify.filter!==groupInfoParentFilter;)parentToModify=parentToModify.parent,indentationMarkerPosition++;parentToModify.filter=newNested,parentToModify.parent=this.__cloneNesting(newParent);let indentationCell=this.__selectedRows[i].rowElement.getElementsByClassName("TcHmi_Controls_Helpers_FilterPrompt-indentation-column")[0];if(indentationCell){let elementToAdd=document.createElement("div");elementToAdd.classList.add("TcHmi_Controls_Helpers_FilterPrompt-indentation-marker"),0===i?elementToAdd.classList.add("first"):i+1===ii?elementToAdd.classList.add("last"):elementToAdd.classList.add("middle"),indentationCell.insertBefore(elementToAdd,indentationCell.childNodes[indentationCell.childElementCount-indentationMarkerPosition]||null)}}this.__processSelection(),this.__resizeIndentationHeader()}__ungroup(ungroupInfo,rows){let index=ungroupInfo.parent.filter.indexOf(ungroupInfo.toUngroup.filter);if(-1!==index){ungroupInfo.parent.filter.splice(index,1,...ungroupInfo.toUngroup.filter),rows.sort((a,b)=>a.rowElement.rowIndex-b.rowElement.rowIndex);for(let i=0,ii=rows.length;i<ii;i++){let elementToRemove,parentToModify=rows[i].parent;for(;parentToModify.parent&&parentToModify.parent.filter!==ungroupInfo.parent.filter;)parentToModify=parentToModify.parent;parentToModify.filter=ungroupInfo.parent.filter,parentToModify.parent=ungroupInfo.parent.parent?this.__cloneNesting(ungroupInfo.parent.parent):null,elementToRemove=0===i?rows[i].rowElement.querySelector(".TcHmi_Controls_Helpers_FilterPrompt-indentation-marker.first"):i+1===ii?rows[i].rowElement.querySelector(".TcHmi_Controls_Helpers_FilterPrompt-indentation-marker.last"):rows[i].rowElement.querySelector(".TcHmi_Controls_Helpers_FilterPrompt-indentation-marker.middle"),elementToRemove&&elementToRemove.parentElement.removeChild(elementToRemove)}this.__processSelection(),this.__resizeIndentationHeader()}}__processSelection(){if(this.__removeButton.setIsEnabled(this.__selectedRows.length>0),this.__groupInfo=null,this.__ungroupInfo=null,this.__selectedRows.length<2)return this.__groupButton.setIsEnabled(!1),void this.__ungroupButton.setIsEnabled(!1);let selectedParents=[],continuityTest=[];for(let i=0,ii=this.__selectedRows.length;i<ii;i++){let row=this.__selectedRows[i];continuityTest[row.rowElement.rowIndex]=!0;let selectedParent=selectedParents.find(sp=>sp.nesting.filter===row.parent.filter);for(selectedParent||(selectedParent={nesting:row.parent,itemCount:Math.ceil(row.parent.filter.length/2),selectedItems:[]},selectedParents.push(selectedParent)),selectedParent.selectedItems.push(row.comparison);selectedParent.selectedItems.length>=selectedParent.itemCount&&(i+1<ii||selectedParents.length>1);){if(!selectedParent.nesting.parent)return this.__groupButton.setIsEnabled(!1),void this.__ungroupButton.setIsEnabled(!1);let grandparent=selectedParents.find(sp=>sp.nesting.filter===selectedParent.nesting.parent.filter);grandparent||(grandparent={nesting:selectedParent.nesting.parent,itemCount:Math.ceil(selectedParent.nesting.parent.filter.length/2),selectedItems:[]},selectedParents.push(grandparent)),grandparent.selectedItems.push(selectedParent.nesting.filter),selectedParents.splice(selectedParents.indexOf(selectedParent),1),selectedParent=grandparent}}if(1===selectedParents.length){let groupingBase=selectedParents[0],isContinuous=!0;for(let i=continuityTest.indexOf(!0),ii=continuityTest.length;i<ii;i++)if(!continuityTest[i]){isContinuous=!1;break}groupingBase.selectedItems.length<groupingBase.itemCount&&isContinuous?this.__groupInfo={parent:groupingBase.nesting,toGroup:groupingBase.selectedItems}:groupingBase.selectedItems.length===groupingBase.itemCount&&groupingBase.nesting.parent&&(this.__ungroupInfo={parent:groupingBase.nesting.parent,toUngroup:groupingBase.nesting})}this.__groupButton.setIsEnabled(null!==this.__groupInfo),this.__ungroupButton.setIsEnabled(null!==this.__ungroupInfo)}__resizeIndentationHeader(){let indentationCell=this.__elementFilterTableBody.getElementsByClassName("TcHmi_Controls_Helpers_FilterPrompt-indentation-column")[0];this.__elementIndentationHeader.style.minWidth=(indentationCell?indentationCell.offsetWidth:0)+"px"}__newControlId(){return`${this.__name}.${tchmi_create_guid()}`}__cloneNesting(nesting){return{filter:nesting.filter,parent:nesting.parent?this.__cloneNesting(nesting.parent):null}}__parseSchema(schema){if(schema&&"array"===schema.type&&schema.items){let items=null;if(Array.isArray(schema.items)?items=schema.items:"object"===schema.items.type?items=[schema.items]:schema.items.anyOf?items=schema.items.anyOf:schema.items.oneOf&&(items=schema.items.oneOf),items){let info={availablePaths:new Map,freePath:null,availableLogic:[]},localizables=[],domainPaths=[];for(let i=0,ii=items.length;i<ii;i++){let item=items[i];if("object"===item.type&&item.properties&&item.properties.logic&&item.properties.logic.enum){for(let j=0,jj=item.properties.logic.enum.length;j<jj;j++)info.availableLogic.includes(item.properties.logic.enum[j])||info.availableLogic.push(item.properties.logic.enum[j]);continue}if(!("object"===item.type&&item.properties&&item.properties.comparator&&item.properties.comparator.enum&&item.properties.value))continue;let pathValues=null,isSuggestion=!1;if(item.properties.path){if(item.properties.path.enum)pathValues=item.properties.path.enum;else if(item.properties.path.pattern){let pattern=item.properties.path.pattern;if(pattern.startsWith("^")){let escaped=pattern.substring(1).replace(/\\(.)/g,"$1");new RegExp(pattern).test(escaped)&&(pathValues=[escaped],isSuggestion=!0)}}}else pathValues=[""];let pathInfos=[];if(pathValues)for(let j=0,jj=pathValues.length;j<jj;j++)info.availablePaths.has(pathValues[j])||info.availablePaths.set(pathValues[j],{comparators:[],values:[],labels:new Map,localizedLabels:new Map,allowFreeValue:!1,valueIsDate:!1,valueType:"any",nullable:!1,isSuggestion}),pathInfos.push(info.availablePaths.get(pathValues[j]));else info.freePath||(info.freePath={comparators:[],values:[],labels:new Map,localizedLabels:new Map,allowFreeValue:!1,valueIsDate:!1,valueType:"any",nullable:!1,isSuggestion:!1}),pathInfos.push(info.freePath);for(let j=0,jj=pathInfos.length;j<jj;j++){for(let k=0,kk=item.properties.comparator.enum.length;k<kk;k++)pathInfos[j].comparators.includes(item.properties.comparator.enum[k])||pathInfos[j].comparators.push(item.properties.comparator.enum[k]);let valueItems=item.properties.value.oneOf??item.properties.value.anyOf??[item.properties.value],typeFound=!1;valueItems.forEach(valueItem=>{if("string"===valueItem.type||"number"===valueItem.type||"integer"===valueItem.type||"boolean"===valueItem.type?typeFound?pathInfos[j].valueType="any":(pathInfos[j].valueType=valueItem.type,typeFound=!0):"null"===valueItem.type&&(pathInfos[j].nullable=!0),valueItem.enum)for(let k=0,kk=valueItem.enum.length;k<kk;k++)pathInfos[j].values.includes(valueItem.enum[k])||pathInfos[j].values.push(valueItem.enum[k]);else pathValues&&pathValues[j].toLowerCase().includes("domain")?(pathInfos[j].values=[""],pathInfos[j].allowFreeValue=!0,domainPaths.push(pathValues[j])):"boolean"===valueItem.type?pathInfos[j].values=[!1,!0]:pathInfos[j].allowFreeValue=!0;if(valueItem.options){let options=valueItem.options;for(let k=0,kk=options.length;k<kk;k++)pathInfos[j].labels.set(options[k].value,options[k].label);localizables.includes(pathInfos[j])||localizables.push(pathInfos[j])}"date-time"===valueItem.format&&(pathInfos[j].valueIsDate=!0)})}}return{schemaInfo:info,localizationInfo:localizables,domainPaths}}}return{schemaInfo:{availablePaths:new Map,freePath:{comparators:["==","!=","<",">","<=",">=","contains","contains not","== [ignore case]","!= [ignore case]","contains [ignore case]","contains not [ignore case]"],values:[],labels:new Map,localizedLabels:new Map,allowFreeValue:!0,valueIsDate:!1,valueType:"any",nullable:!1,isSuggestion:!1},availableLogic:["AND","OR"]},localizationInfo:[],domainPaths:[]}}__localizeEnumLabels(){if(0===this.__localizableEnums.length)return;let request={requestType:"ReadWrite",commands:[]},map={};for(let i=0,ii=this.__localizableEnums.length;i<ii;i++)for(const[key,label]of this.__localizableEnums[i].labels)map[label]={pathInfo:this.__localizableEnums[i],key},request.commands.push({symbol:"LocalizeText",writeValue:{domain:"TcHmiSrv",name:label},commandOptions:["SendWriteValue","SendErrorMessage"]});this.__localizeRequestId=TcHmi.Server.requestEx(request,null,data=>{if(this.__localizeRequestId=null,data.error===TcHmi.Errors.NONE)if(data.response)if(data.response.error)TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%LocalizeText%/s%] ${TcHmi.Log.buildMessage(data.response.error)}`);else if(data.response.commands&&0!==data.response.commands.length){for(let i=0,ii=data.response.commands.length;i<ii;i++){if(data.response.commands[i].error){TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%LocalizeText%/s%] ${TcHmi.Log.buildMessage(data.response.commands[i].error)}`);continue}if(!data.response.commands[i].readValue){TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%LocalizeText%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_READVALUE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_READVALUE_MISSING],reason:`Missing readValue for symbol '${data.response.commands[i].symbol}' in response from server with id: '${data.response.id}'.`,domain:this.__name}));continue}let writeValue=data.response.commands[i].writeValue;"object"==typeof writeValue&&writeValue.name&&map[writeValue.name]&&map[writeValue.name].pathInfo.localizedLabels.set(map[writeValue.name].key,data.response.commands[i].readValue)}for(let i=0,ii=this.__rows.length;i<ii;i++){let combobox=this.__rows[i].value.control;if(combobox instanceof TcHmiCombobox){let pathInfo=this.__getPathInfo(this.__rows[i].comparison.path);if(!pathInfo||0===pathInfo.localizedLabels.size)continue;let srcData=[];for(let i=0,ii=pathInfo.values.length;i<ii;i++){let value=pathInfo.values[i];srcData.push({value,text:pathInfo.localizedLabels.get(value)??pathInfo.labels.get(value)??value})}let selectedIndex=combobox.getSelectedIndex();combobox.setSrcData(srcData),combobox.setSelectedIndex(void 0===selectedIndex?null:selectedIndex)}}}else TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%LocalizeText%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_COMMANDS_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_COMMANDS_MISSING],reason:`Missing commands in response from server with id: '${data.response.id}'.`,domain:this.__name}));else TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name},\n                            ControlId=$(this.__name), Symbol=%s%LocalizeText%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_RESPONSE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_RESPONSE_MISSING],reason:"Missing response from server.",domain:this.__name}));else TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%LocalizeText%/s%] ${TcHmi.Log.buildMessage(data.details)}`)})}__subscribeListDomains(){0!==this.__domainPaths.size&&null===this.__listDomainsSubscriptionId&&(this.__listDomainsSubscriptionId=TcHmi.Server.subscribeEx([{symbol:"ListDomains"}],1e3,null,data=>{if(data.error!==TcHmi.Errors.NONE)return void TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%ListDomains%/s%] ${TcHmi.Log.buildMessage(data.details)}`);if(!data.response)return void TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%ListDomains%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_RESPONSE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_RESPONSE_MISSING],reason:"Missing response from server.",domain:this.__name}));if(data.response.error)return void TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%ListDomains%/s%] ${TcHmi.Log.buildMessage(data.response.error)}`);if(!data.response.commands||0===data.response.commands.length)return void TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%ListDomains%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_COMMANDS_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_COMMANDS_MISSING],reason:`Missing commands in response from server with id: '${data.response.id}'.`,domain:this.__name}));if(data.response.commands[0].error)return void TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%ListDomains%/s%] ${TcHmi.Log.buildMessage(data.response.commands[0].error)}`);if(!data.response.commands[0].readValue)return void TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%ListDomains%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_READVALUE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_READVALUE_MISSING],reason:`Missing readValue for symbol '${data.response.commands[0].symbol}' in response from server with id: '${data.response.id}'.`,domain:this.__name}));let domains=Object.keys(data.response.commands[0].readValue);for(const pathInfo of this.__domainPaths.values())pathInfo.values=domains;this.__rows.filter(row=>row.comparison.path&&this.__domainPaths.has(row.comparison.path)).forEach(row=>{let combobox=row.value.control;if(combobox instanceof TcHmiCombobox){let pathInfo=this.__getPathInfo(row.comparison.path);if(!pathInfo)return;let srcData=[];for(let i=0,ii=pathInfo.values.length;i<ii;i++){let value=pathInfo.values[i];srcData.push({value,text:pathInfo.localizedLabels.get(value)??pathInfo.labels.get(value)??value})}let selectedValue=combobox.getSelectedValue()??combobox.getText(),selectedIndex=srcData.findIndex(item=>item.value===selectedValue);combobox.setSrcData(srcData),-1!==selectedIndex?(combobox.getAllowTextInput()&&combobox.setText(null),combobox.setSelectedIndex(selectedIndex)):(combobox.setSelectedIndex(null),combobox.getAllowTextInput()&&combobox.setText(selectedValue))}})}))}}})();export{FilterPrompt};TcHmi.Controls.Helpers??={},TcHmi.Controls.Helpers.FilterPrompt=FilterPrompt;