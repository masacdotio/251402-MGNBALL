export class PasswordRequirements extends HTMLElement{static#tchmiFQN="TcHmi.Controls.Beckhoff.TcHmiUserManagementPopups"+this.name;__elementHeader;__passwordComplexityRules;__passwordComplexityCheckboxes=new Map;__customRules=new Map;__parentControl;__initCallback;__eventDestroyers=[];__localizedTexts=null;__localizationSymbols=new Map;constructor(parentControl,customRules,initCallback){super(),this.__parentControl=parentControl,customRules&&(this.__customRules=customRules),this.__elementHeader=document.createElement("h3"),this.__initCallback=initCallback}connectedCallback(){"TcHmiUserManagement"===TcHmi.Server.getCurrentUserConfig().domain?TcHmi.Server.readSymbol("TcHmiUserManagement.GetComplexityRules",data=>{data.error===TcHmi.Errors.NONE&&data.response?.commands[0]?.readValue?this.__passwordComplexityRules=data.response?.commands[0]?.readValue:(this.__passwordComplexityRules=void 0,TcHmi.Log.Controls.error(this.__parentControl,PasswordRequirements.#tchmiFQN,{Symbol:"TcHmiUserManagement.GetComplexityRules"},TcHmi.Log.buildMessage(data.details))),this.__createElement(),this.__initCallback?.()}):(this.__createElement(),this.__initCallback?.())}disconnectedCallback(){for(const[_rule,checkbox]of Object.entries(this.__passwordComplexityCheckboxes))checkbox.destroy();this.__passwordComplexityCheckboxes.clear();for(let event of this.__eventDestroyers)event();this.__eventDestroyers=[],this.__passwordComplexityRules=void 0}__createElement(){this.textContent="",this.append(this.__elementHeader);for(const[rule,text]of this.__customRules)if(!this.__passwordComplexityCheckboxes.has(rule)){const checkbox=TcHmi.Controls.get(this.__parentControl.getId()+"."+rule)??TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__parentControl.getId()+"."+rule,{"data-tchmi-is-read-only":!0},this.__parentControl);if(!checkbox){TcHmi.Log.Controls.error(this.__parentControl,PasswordRequirements.#tchmiFQN,"Could not create password requirement checkboxes.");continue}text&&("string"==typeof text?(this.__unwatchLocalization(rule),TcHmi.Symbol.isSymbolExpression(text)?TcHmi.Binding.createEx2(text,"Text",checkbox):checkbox.setText(text)):(TcHmi.Binding.removeEx2(null,"Text",checkbox),this.__watchLocalization(rule,text,text=>checkbox.setText(text)))),this.append(checkbox.getElement()[0]),this.__passwordComplexityCheckboxes.set(rule,checkbox)}if(this.__passwordComplexityRules)for(const[rulename,rule]of Object.entries(this.__passwordComplexityRules))if(!this.__passwordComplexityCheckboxes.has(rulename)){const checkbox=TcHmi.Controls.get(this.__parentControl.getId()+"."+rulename)??TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__parentControl.getId()+"."+rulename,null,this.__parentControl);if(!checkbox){TcHmi.Log.Controls.error(this.__parentControl,PasswordRequirements.#tchmiFQN,"Could not create password requirement checkboxes.");continue}checkbox.setIsReadOnly(!0);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:"LocalizeText",writeValue:{domain:"TcHmiUserManagement",name:rulename,params:rule.localizationParameters??void 0}}]};TcHmi.Server.request(request,data=>{data.error===TcHmi.Errors.NONE&&checkbox.setText(data.response?.commands[0].readValue??null)}),this.append(checkbox.getElement()[0]),this.__passwordComplexityCheckboxes.set(rulename,checkbox)}}validate(password,customRules){let validPassword=!0;for(const[rulename,_text]of this.__customRules){const value=customRules?.get(rulename)??!1;this.__passwordComplexityCheckboxes.get(rulename)?.setToggleState(value?"Active":"Normal"),value||(validPassword=!1)}if(this.__passwordComplexityRules)for(const[rulename,rule]of Object.entries(this.__passwordComplexityRules)){if(!rule.regex)continue;const value=new RegExp(rule.regex,"u").test(password);this.__passwordComplexityCheckboxes.get(rulename)?.setToggleState(value?"Active":"Normal"),value||(validPassword=!1)}return validPassword}__watchLocalization(name,localization,onChange){const existing=this.__localizationSymbols.get(name);existing?.destroyWatch(),existing?.symbol.destroy();const symbol=new TcHmi.Symbol(localization.symbolExpression),destroyWatch=symbol.watch(data=>{if(data.error!==TcHmi.Errors.NONE)return void TcHmi.Log.errorEx(`[Source=ControlHelpers, Module=${this.__parentControl.getType()}, , Id=${this.__parentControl.getId()},\n                    TcHmi.SymbolExpression=${localization.symbolExpression}] `+TcHmi.Log.buildMessage(data.details));let text=data.value??"";localization.formatValues.length>0&&(text=tchmi_format_string(text,...localization.formatValues)),onChange(text)});this.__localizationSymbols.set(name,{symbol,destroyWatch})}__unwatchLocalization(name){const existing=this.__localizationSymbols.get(name);existing&&(existing.destroyWatch(),existing.symbol.destroy(),this.__localizationSymbols.delete(name))}setTexts(texts){this.__localizedTexts=texts,this.__applyTextToElement("headerText",texts.headerText,this.__elementHeader)}__applyTextToElement(name,text,element){null!=text&&("object"==typeof text||TcHmi.Symbol.isSymbolExpression(text)?this.__watchLocalization(name,"string"==typeof text?{symbolExpression:text,formatValues:[]}:text,text=>{element.textContent=text}):(this.__unwatchLocalization(name),element.textContent=text))}}customElements.define("tchmi-password-requirements",PasswordRequirements);