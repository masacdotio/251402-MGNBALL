var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{Callback}from"Beckhoff.TwinCAT.HMI.Framework/index.esm.js";import{UserManagementPopup}from"./UserManagementPopup.js";import{PasswordRequirements}from"./PasswordRequirements.js";let EditUserPopup=(()=>{var _a,_b,_c,_d,_e;let ___onGroupScroll_decorators,___onRadioStateLocaleChanged_decorators,___onSaveUp_decorators,___onAdvanced_decorators,___onCancelUp_decorators,_classSuper=UserManagementPopup,_instanceExtraInitializers=[];return class extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onGroupScroll_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],___onRadioStateLocaleChanged_decorators=[(_b=TcHmi).CallbackMethod.bind(_b)],___onSaveUp_decorators=[(_c=TcHmi).CallbackMethod.bind(_c)],___onAdvanced_decorators=[(_d=TcHmi).CallbackMethod.bind(_d)],___onCancelUp_decorators=[(_e=TcHmi).CallbackMethod.bind(_e)],__esDecorate(this,null,___onGroupScroll_decorators,{kind:"method",name:"__onGroupScroll",static:!1,private:!1,access:{has:obj=>"__onGroupScroll"in obj,get:obj=>obj.__onGroupScroll},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onRadioStateLocaleChanged_decorators,{kind:"method",name:"__onRadioStateLocaleChanged",static:!1,private:!1,access:{has:obj=>"__onRadioStateLocaleChanged"in obj,get:obj=>obj.__onRadioStateLocaleChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onSaveUp_decorators,{kind:"method",name:"__onSaveUp",static:!1,private:!1,access:{has:obj=>"__onSaveUp"in obj,get:obj=>obj.__onSaveUp},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onAdvanced_decorators,{kind:"method",name:"__onAdvanced",static:!1,private:!1,access:{has:obj=>"__onAdvanced"in obj,get:obj=>obj.__onAdvanced},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onCancelUp_decorators,{kind:"method",name:"__onCancelUp",static:!1,private:!1,access:{has:obj=>"__onCancelUp"in obj,get:obj=>obj.__onCancelUp},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}constructor(parentControl){super(parentControl),this.__elementPassword=document.createElement("div"),this.__elementPassword.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementPasswordHeader=document.createElement("h2"),this.__elementPassword.append(this.__elementPasswordHeader),this.__elementLocale=document.createElement("div"),this.__elementLocale.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content-radiobuttons","TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementLocaleHeader=document.createElement("h2"),this.__elementLocale.append(this.__elementLocaleHeader),this.__elementGroups=document.createElement("div"),this.__elementGroups.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementGroupList=document.createElement("div"),this.__elementGroupList.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-groups"),this.__destroyers.push(TcHmi.EventProvider.registerDomEvent(this.__elementGroupList,"scroll",this.__onGroupScroll)),this.__elementGroupListInfo=document.createElement("div"),this.__elementGroupsHeader=document.createElement("h2"),this.__elementGroups.append(this.__elementGroupsHeader,this.__elementGroupList),this.__elementContent.append(this.__elementPassword,this.__elementGroups,this.__elementLocale);const saveButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.saveButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7,top:6,bottom:6},"data-tchmi-is-enabled":!0,"data-tchmi-ignore-escape-sequences":!0},this.__parentControl),cancelButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.cancelButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7,top:6,bottom:6},"data-tchmi-ignore-escape-sequences":!0},this.__parentControl),advancedSwitch=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleSwitch",`${this.__name}.advancedSwitch`,{"data-tchmi-width":30,"data-tchmi-height":30},this.__parentControl),oldPasswordInput=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput",`${this.__name}.oldPasswordInput`,null,this.__parentControl),newPasswordInput=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput",`${this.__name}.newPasswordInput`,null,this.__parentControl),newPasswordInput2=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput",`${this.__name}.newPasswordInput2`,null,this.__parentControl),localeCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",`${this.__name}.localeCombobox`,{"data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl),clientLocaleRadioButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",`${this.__name}.clientLocaleRadioButton`,{"data-tchmi-radio-group":`${this.__name}.ToggleGroup_Locale_EditUserPopup`,"data-tchmi-radio-state":"Active"},this.__parentControl),projectLocaleRadioButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",`${this.__name}.projectLocaleRadioButton`,{"data-tchmi-radio-group":`${this.__name}.ToggleGroup_Locale_EditUserPopup`},this.__parentControl),selectionLocaleRadioButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",`${this.__name}.selectionLocaleRadioButton`,{"data-tchmi-radio-group":`${this.__name}.ToggleGroup_Locale_EditUserPopup`},this.__parentControl);if(!(saveButton&&cancelButton&&advancedSwitch&&oldPasswordInput&&newPasswordInput&&newPasswordInput2&&clientLocaleRadioButton&&projectLocaleRadioButton&&selectionLocaleRadioButton&&localeCombobox))throw new Error("Could not create controls for EditUserPopup.");this.__advancedSwitch=advancedSwitch;const advancedSwitchElement=this.__advancedSwitch.getElement()[0];advancedSwitchElement.classList.add("advanced-switch"),this.__elementFooter.append(advancedSwitchElement),this.__saveButton=saveButton;const saveButtonElement=this.__saveButton.getElement()[0];saveButtonElement.classList.add("confirmbutton"),this.__elementFooter.append(saveButtonElement),this.__cancelButton=cancelButton;const cancelButtonElement=this.__cancelButton.getElement()[0];cancelButtonElement.classList.add("cancelbutton"),this.__elementFooter.append(cancelButtonElement),this.__oldPasswordInput=oldPasswordInput;const oldPasswordInputElement=this.__oldPasswordInput.getElement()[0];oldPasswordInputElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content-margin"),this.__elementPassword.append(oldPasswordInputElement),this.__newPasswordInput=newPasswordInput,this.__elementPassword.append(this.__newPasswordInput.getElement()[0]),this.__newPasswordInput_2=newPasswordInput2,this.__elementPassword.append(this.__newPasswordInput_2.getElement()[0]),this.__projectLocaleRadioButton=projectLocaleRadioButton,this.__elementLocale.append(this.__projectLocaleRadioButton.getElement()[0]),this.__clientLocaleRadioButton=clientLocaleRadioButton,this.__elementLocale.append(this.__clientLocaleRadioButton.getElement()[0]);let localeItem_Selection=document.createElement("div");localeItem_Selection.classList.add("combobox-selection"),this.__selectionLocaleRadioButton=selectionLocaleRadioButton,localeItem_Selection.append(this.__selectionLocaleRadioButton.getElement()[0]),localeItem_Selection.append(this.__selectionLocaleRadioButton.getElement()[0]),this.__localeCombobox=localeCombobox,localeItem_Selection.append(this.__localeCombobox.getElement()[0]),this.__elementLocale.append(localeItem_Selection),this.__createLocalizationSelection(),this.__destroyers.push(TcHmi.EventProvider.register(this.__advancedSwitch.getId()+".onToggleStateChanged",this.__onAdvanced),TcHmi.EventProvider.register(this.__saveButton.getId()+".onPressed",this.__onSaveUp),TcHmi.EventProvider.register(this.__cancelButton.getId()+".onPressed",this.__onCancelUp),TcHmi.EventProvider.register(this.__oldPasswordInput.getId()+".onTextChanged",()=>{this.__updatePasswordRequirements()}),TcHmi.EventProvider.register(this.__newPasswordInput.getId()+".onTextChanged",()=>{this.__updatePasswordRequirements()}),TcHmi.EventProvider.register(this.__newPasswordInput_2.getId()+".onTextChanged",()=>{this.__updatePasswordRequirements()}),TcHmi.EventProvider.register(this.__selectionLocaleRadioButton.getId()+".onRadioStateChanged",this.__onRadioStateLocaleChanged))}__elementPassword=__runInitializers(this,_instanceExtraInitializers);__elementPasswordHeader;__elementGroups;__elementGroupsHeader;__elementGroupList;__elementGroupListInfo;__elementLocale;__elementLocaleHeader;__elementPasswordRequirements;__saveButton;__cancelButton;__advancedSwitch;__oldPasswordInput;__newPasswordInput;__newPasswordInput_2;__localeCombobox;__clientLocaleRadioButton;__projectLocaleRadioButton;__selectionLocaleRadioButton;__groupList=[];__groupCheckboxes=new Map;__groupConfigurations=[];__groupCheckboxEventDestroyer=[];__apiAccessResult;__advanced=!1;__advancedChangeCallbacks=new Callback.Collection;onAdvancedChanged=this.__advancedChangeCallbacks.getManipulators();__localizedTexts=null;show(){super.show(),this.__groupConfigurations=TcHmi.Server.getCurrentUserConfig().userIsInGroups,this.__showControlsBasedOnApiAccess(),this.__setLocaleRadioButtonsByUserConfig(),this.__setGroupCheckboxesByUserConfig(),this.__updatePasswordRequirements(),setTimeout(()=>{this.__setGroupScrollData()},50)}destroy(){this.__groupCheckboxes.forEach(checkbox=>{checkbox.destroy()}),this.__groupCheckboxes.clear(),this.__groupCheckboxEventDestroyer.forEach(destroyer=>{destroyer()}),this.__groupCheckboxEventDestroyer=[],super.destroy()}__showControlsBasedOnApiAccess(){let domain=TcHmi.Server.getCurrentUserConfig().domain;TcHmi.Server.UserManagement.getApiAccess({domain:domain??void 0},data=>{this.__apiAccessResult=data,data.error===TcHmi.Errors.NONE&&data.result&&(data.result.updateUser.changeOwnPassword?(data.result.updateUser.changePassword?this.__oldPasswordInput.setVisibility("Collapsed"):this.__oldPasswordInput.setVisibility("Visible"),this.__elementPassword.classList.remove("not-displayed")):this.__elementPassword.classList.add("not-displayed"),data.result.updateUser.addGroups&&data.result.updateUser.removeGroups&&data.result.listUserGroupNames.general?(this.__elementGroups.classList.remove("not-displayed"),this.__createUserGroupSelection()):this.__elementGroups.classList.add("not-displayed"),data.result.updateUser.locale?this.__elementLocale.classList.remove("not-displayed"):this.__elementLocale.classList.add("not-displayed"),data.result.listUserGroupNames.general?this.__advancedSwitch?.setVisibility("Visible"):this.__advancedSwitch?.setVisibility("Collapsed")),this.__createPasswordRequirementsElement()})}__performPromptAction(toPerform){this.__onHideManager.trigger()}__updatePasswordRequirements(){const oldPassword=this.__oldPasswordInput.getText(),newPassword=this.__newPasswordInput.getText(),newPassword2=this.__newPasswordInput_2.getText();if(!this.__elementPasswordRequirements)return void this.__saveButton.setIsEnabled(!0);let customRuleValues=new Map;customRuleValues.set("RepeatPassword",newPassword===newPassword2&&(newPassword??"").length>0),"Visible"===this.__oldPasswordInput.getVisibility()&&customRuleValues.set("EnterCurrentPassword",(oldPassword??"").length>0),this.__elementPasswordRequirements.validate(newPassword??"",customRuleValues)||!newPassword&&!newPassword2&&!oldPassword?this.__saveButton.setIsEnabled(!0):this.__saveButton.setIsEnabled(!1)}__createPasswordRequirementsElement(){if(this.__elementPasswordRequirements?.remove(),!this.__parentControl)return;let customRules=new Map;"Visible"===this.__oldPasswordInput.getVisibility()&&customRules.set("EnterCurrentPassword",this.__localizedTexts?.passwordRequirementsCurrentPassword??""),customRules.set("RepeatPassword",this.__localizedTexts?.passwordRequirementsRepitition??""),this.__elementPasswordRequirements=new PasswordRequirements(this.__parentControl,customRules,()=>{this.__updatePasswordRequirements()}),this.__elementPasswordRequirements.setTexts({headerText:this.__localizedTexts?.passwordRequirementsHeadline}),this.__elementPassword.append(this.__elementPasswordRequirements)}__createUserGroupSelection(){this.__isShowing&&TcHmi.Server.UserManagement.listUserGroupNames(data=>{(async()=>{if(data.error===TcHmi.Errors.NONE)data.groupNames&&(this.__advanced||(data.groupNames=data.groupNames.filter(group=>!group.startsWith("__"))),tchmi_equal(this.__groupList,data.groupNames)&&0!==data.groupNames.length||(this.__groupCheckboxes.forEach(checkbox=>{checkbox.destroy()}),this.__groupCheckboxes.clear(),this.__groupCheckboxEventDestroyer.forEach(destroyer=>{destroyer()}),this.__groupCheckboxEventDestroyer=[],this.__elementGroupList.textContent="",this.__groupList=data.groupNames,this.__groupList.length>0?(this.__elementGroupListInfo.remove(),this.__groupList.forEach(group=>{this.__createGroupCheckbox(group)}),this.__setGroupCheckboxesByUserConfig()):this.__elementGroupList.append(this.__elementGroupListInfo)));else{let error=data.error,message="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptListUserGroupError?this.__localizedTexts?.feedbackPromptListUserGroupError.symbolExpression:this.__localizedTexts?.feedbackPromptListUserGroupError??"",formatValues:[error,message]}}),await this.__feedbackPrompt.prompt(),this.hide(),this.__elementGroups.classList.add("not-displayed")}})()})}__createGroupCheckbox(name){if(void 0===TcHmi.Controls.get(this.__name+".UserGroupCheckbox_EditUser_Popup"+name)){let checkbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__name+".UserGroupCheckbox_EditUser_Popup"+name,{"data-tchmi-text":name,"data-tchmi-toggle-state":"Normal"},this.__parentControl);checkbox&&(this.__groupCheckboxes.set(name,checkbox),this.__elementGroupList.append(checkbox.getElement()[0]),this.__groupCheckboxEventDestroyer.push(TcHmi.EventProvider.register(checkbox.getId()+".onToggleStateChanged",this.__onGroupCheckbox(checkbox,name))))}}__onGroupCheckbox(checkbox,groupName){return()=>{"Normal"===checkbox.getToggleState()?this.__groupConfigurations=this.__groupConfigurations.filter(group=>group!==groupName):this.__groupConfigurations.includes(groupName)||this.__groupConfigurations.push(groupName)}}__setGroupCheckboxesByUserConfig(){let currentUserConfigurations=TcHmi.Server.getCurrentUserConfig();this.__groupCheckboxes.forEach((checkbox,group)=>{"__SystemGuest"===currentUserConfigurations.name&&"__SystemGuests"===group||"__SystemUser"===currentUserConfigurations.name&&"__SystemUsers"===group||"__SystemAdministrator"===currentUserConfigurations.name&&"__SystemAdministrators"===group?checkbox.setIsEnabled(!1):checkbox.setIsEnabled(!0),this.__groupConfigurations.includes(group)?checkbox.setToggleState("Active"):checkbox.setToggleState("Normal")}),this.__setGroupScrollData()}__createLocalizationSelection(){this.__localeCombobox.setIsEnabled(!1);let locales=TcHmi.Locale.getRegisteredLocales(),currentLocale=TcHmi.Locale.get();locales.sort(),this.__localeCombobox.setSrcData(locales);for(let i=0;i<locales.length;i++){let currentUserConfigurations=TcHmi.Server.getCurrentUserConfig();currentUserConfigurations&&currentUserConfigurations.locale?locales[i].includes(currentUserConfigurations.locale)&&this.__localeCombobox.setSelectedIndex(i):locales[i]===currentLocale&&this.__localeCombobox.setSelectedIndex(i)}this.__setLocaleRadioButtonsByUserConfig()}__setLocaleRadioButtonsByUserConfig(){let currentUserConfig=TcHmi.Server.getCurrentUserConfig();if(currentUserConfig.configLocale&&"client"!==currentUserConfig.configLocale){if("project"===currentUserConfig.configLocale)this.__projectLocaleRadioButton&&this.__projectLocaleRadioButton.setRadioState("Active");else if(this.__localeCombobox&&this.__selectionLocaleRadioButton){let registeredLocales=TcHmi.Locale.getRegisteredLocales();if(registeredLocales)for(let i=0,ii=registeredLocales.length;i<ii;i++)registeredLocales[i]===currentUserConfig.configLocale&&(this.__selectionLocaleRadioButton.setRadioState("Active"),this.__localeCombobox.setSelectedIndex(i))}}else this.__clientLocaleRadioButton&&this.__clientLocaleRadioButton.setRadioState("Active")}__checkLocaleRadioButtons(){let locale;return locale=this.__clientLocaleRadioButton&&"Active"===this.__clientLocaleRadioButton.getRadioState()?"client":this.__projectLocaleRadioButton&&"Active"===this.__projectLocaleRadioButton.getRadioState()?"project":this.__selectionLocaleRadioButton&&"Active"===this.__selectionLocaleRadioButton.getRadioState()&&this.__localeCombobox?this.__localeCombobox.getSelectedValue():void 0,locale}__onGroupScroll(_event){this.__setGroupScrollData()}__setGroupScrollData(){this.__elementGroupList.clientHeight+this.__elementGroupList.scrollTop===this.__elementGroupList.scrollHeight?this.__elementGroupList.dataset.scroll=0===this.__elementGroupList.scrollTop?"none":"bottom":this.__elementGroupList.dataset.scroll=0===this.__elementGroupList.scrollTop?"top":"center"}__onRadioStateLocaleChanged(){"Active"===this.__selectionLocaleRadioButton.getRadioState()?this.__localeCombobox.setIsEnabled(!0):this.__localeCombobox.setIsEnabled(!1)}__onSaveUp(){let currentUserConfigurations=TcHmi.Server.getCurrentUserConfig();if(this.__oldPasswordInput&&this.__newPasswordInput&&this.__newPasswordInput_2){let passwordOld=this.__oldPasswordInput.getText(),passwordNew=this.__newPasswordInput.getText(),passwordNew2=this.__newPasswordInput_2.getText();if(passwordOld||passwordNew||passwordNew2){if(!passwordOld&&(passwordNew||passwordNew2)&&!this.__apiAccessResult?.result?.updateUser.changePassword)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:this.__localizedTexts?.feedbackPromptPasswordOld}),void this.__feedbackPrompt.prompt();if(passwordOld||this.__apiAccessResult?.result?.updateUser.changePassword){if(!passwordNew||!passwordNew2)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:this.__localizedTexts?.feedbackPromptBothPasswords}),void this.__feedbackPrompt.prompt();if(passwordNew!==passwordNew2)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:this.__localizedTexts?.feedbackPromptPasswordMatch}),void this.__feedbackPrompt.prompt()}}else passwordOld=void 0,passwordNew=void 0,passwordNew2=void 0;let timeZone,groupsToAdd=[],groupsToRemove=[],locale=this.__checkLocaleRadioButtons();this.__groupCheckboxes&&this.__groupList&&currentUserConfigurations&&this.__apiAccessResult?.result?.updateUser.addGroups&&this.__apiAccessResult?.result?.updateUser.removeGroups&&(groupsToRemove=currentUserConfigurations.userIsInGroups.filter(group=>"Normal"===this.__groupCheckboxes.get(group)?.getToggleState()),groupsToAdd=this.__groupList.filter(group=>"Active"===this.__groupCheckboxes.get(group)?.getToggleState()&&!currentUserConfigurations.userIsInGroups.includes(group))),currentUserConfigurations&&currentUserConfigurations.name&&this.__updateUser(currentUserConfigurations.name,passwordOld,passwordNew,groupsToAdd,groupsToRemove,locale,timeZone)}}__updateUser(username,oldPassword,newPassword,groupsToAdd,groupsToRemove,locale,timeZone){let updateData={};oldPassword&&(updateData.currentPassword=oldPassword),newPassword&&(updateData.password=newPassword),groupsToAdd&&groupsToAdd.length>0&&(updateData.addGroups=groupsToAdd),groupsToRemove&&groupsToRemove.length>0&&(updateData.removeGroups=groupsToRemove),locale&&(updateData.locale=locale),timeZone&&(updateData.timeZone=timeZone),updateData.domain=TcHmi.Server.getCurrentUserConfig().domain??TcHmi.Server.getCurrentUserConfig().defaultAuthExtension,username&&updateData&&TcHmi.Server.UserManagement.updateUser(username,updateData,data=>{if(data.error===TcHmi.Errors.NONE)this.__showControlsBasedOnApiAccess(),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineSuccess,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptUserInformationUpdated?this.__localizedTexts?.feedbackPromptUserInformationUpdated.symbolExpression:this.__localizedTexts?.feedbackPromptUserInformationUpdated??"",formatValues:[TcHmi.Server.getCurrentUser()??"the current user"]}}),this.__feedbackPrompt.prompt();else{let error=data.error,message="",reason="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")"),data.details.errors[0].reason&&(reason=data.details.errors[0].reason)),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptUserInfoNotUpdated?this.__localizedTexts?.feedbackPromptUserInfoNotUpdated.symbolExpression:this.__localizedTexts?.feedbackPromptUserInfoNotUpdated??"",formatValues:[error,message,reason,username]}}),this.__feedbackPrompt.prompt()}})}__onAdvanced(){this.__advanced="Active"===this.__advancedSwitch.getToggleState(),this.__advancedChangeCallbacks.trigger(this.__advanced),this.__createUserGroupSelection()}setAdvanced(advanced){advanced!==this.__advanced&&(this.__advanced=advanced,this.__advancedSwitch.setToggleState(this.__advanced?"Active":"Normal"))}__resetControls(){this.__oldPasswordInput.setText(""),this.__newPasswordInput.setText(""),this.__newPasswordInput_2.setText(""),this.__clientLocaleRadioButton.setRadioState("Active")}__onCancelUp(){this.__resetControls(),this.hide()}__updateFontSizes(){super.__updateFontSizes(),this.__localeCombobox.setTextFontSize(this.__textFontSize),this.__localeCombobox.setTextFontSizeUnit(this.__textFontSizeUnit),"px"===this.__textFontSizeUnit&&this.__textFontSize?this.__localeCombobox.setHeight(this.__textFontSize+10):this.__localeCombobox.setHeight(null),this.__localeCombobox.setDropDownFontSize(this.__dropDownFontSize),this.__localeCombobox.setDropDownFontSizeUnit(this.__dropDownFontSizeUnit),"px"===this.__dropDownFontSizeUnit&&this.__dropDownFontSize?this.__localeCombobox.setDataHeight(1.5*this.__dropDownFontSize):this.__localeCombobox.setDataHeight(null)}setTexts(texts){super.setTexts(texts),this.__applyTextToElement("passwordHeaderText",texts.passwordHeaderText,this.__elementPasswordHeader),this.__applyTextToElement("localizationHeaderText",texts.localizationHeaderText,this.__elementLocaleHeader),this.__applyTextToElement("userGroupsHeaderText",texts.userGroupsHeaderText,this.__elementGroupsHeader),this.__applyTextToElement("popupFeedbackNoGroupsToAdjust",texts.popupFeedbackNoGroupsToAdjust,this.__elementGroupListInfo),this.__applyTextToControl("saveButtonText",texts.saveButton?.text,this.__saveButton,"Text"),this.__applyTextToControl("saveButtonTooltip",texts.saveButton?.tooltip,this.__saveButton,"Tooltip"),this.__applyTextToControl("cancelButtonText",texts.cancelButton?.text,this.__cancelButton,"Text"),this.__applyTextToControl("cancelButtonTooltip",texts.cancelButton?.tooltip,this.__cancelButton,"Tooltip"),this.__applyTextToControl("advancedSwitchText",texts.advancedSwitch?.text,this.__advancedSwitch,"Text"),this.__applyTextToControl("advancedSwitchTooltip",texts.advancedSwitch?.tooltip,this.__advancedSwitch,"Tooltip"),this.__applyTextToControl("oldPasswordInputPlaceholder",texts.oldPasswordInputPlaceholder,this.__oldPasswordInput,"Placeholder"),this.__applyTextToControl("newPasswordInputPlaceholder",texts.newPasswordInputPlaceholder,this.__newPasswordInput,"Placeholder"),this.__applyTextToControl("newPasswordInput2Placeholder",texts.newPasswordInput2Placeholder,this.__newPasswordInput_2,"Placeholder"),this.__applyTextToControl("clientLocaleRadioButtonText",texts.clientLocaleRadioButtonText,this.__clientLocaleRadioButton,"Text"),this.__applyTextToControl("projectLocaleRadioButtonText",texts.projectLocaleRadioButtonText,this.__projectLocaleRadioButton,"Text"),this.__elementPasswordRequirements?.setTexts({headerText:this.__localizedTexts?.passwordRequirementsHeadline})}}})();export{EditUserPopup};